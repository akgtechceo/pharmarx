[?9001h[?1004h[?25l[2J[m[H]0;npm[?25h]0;npm run test[K‚†ô[?25l[H[?25h‚†π[K[?25l[H[?25h[K[?25l
> @pharmarx/api@1.0.0 test
> vitest[5;1H[?25h[K‚†∏[K]0;C:\WINDOWS\system32\cmd.exe ]0;node (vitest)[?25l[44m[1m
 DEV [m [34mv3.2.4 [90mC:/Users/akgte/PharmaRx/apps/api[m[?2026h[2m[9;1H Test Files [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m00:00:15
[2m   Duration [22m602ms[K[88C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[?2026l[2m
 Test Files [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m1.91s[?2026h
[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[2m
 Test Files [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m3.05s[?2026l]0;node (vitest 1)[?2026h[?2026l[6;1H[K[2m
 Test Files [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[K[m[2m
   Start at [22m00:00:15[K[2m
   Duration [22m4.08s[K
[K[105C]0;node (vitest 4)]0;node (vitest 3)]0;node (vitest 5)]0;node (vitest 2)[?2026h[K[105C]0;node (vitest 6)[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[2m
 Test Files [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m4.79s[?2026l[?2026h
[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[2m
 Test Files [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m5.41s[?2026l[?2026h
[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[?2026l[2m
 Test Files [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m5.70s[?2026h
[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[?2026l[2m
 Test Files [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m6.47s[?2026h
[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[6;1H[K
[K[105C[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][9;1H Test Files [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m00:00:15
[2m   Duration [22m7.11s[K[88C
[105C[?2026l[?2026h[4;1H[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K
[K[2m
 Test Files [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[K[81C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m7.41s[K[88C[?2026l
[105C[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K
[K[2m
 Test Files [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[K[m[2m
   Start at [22m00:00:15[K[85C
[2m   Duration [22m7.95s[K[88C[?2026l
[105C[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K
[K[2m
 Test Files [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[K[m[2m
   Start at [22m00:00:15[K[85C
[2m   Duration [22m8.59s[K[88C[?2026l
[105C[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[5;1H[K
[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[H[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][9;1H Test Files [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m00:00:15
[2m   Duration [22m8.92s[K[88C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[H[K[105C[H[K[105C[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][9;1H Test Files [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m00:00:15
[2m   Duration [22m9.60s[K[88C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[8;1H[K
[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[3;1H[K
[K[105C[H[K
[K[105C[H[K[105C[H[K[105C[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][9;1H Test Files [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m00:00:15
[2m   Duration [22m10.53s[K[87C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C[H[K
[K[105C[H[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts[m
OCR Service initialized successfully[90m[4;1Hstdout[2m | src/features/ocrIntegration.test.ts[m
OCR Service initialized successfully[90m[7;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m
OCR Service initialized successfully[90m[11;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extra[m
[90m[2m[10;105Haction > should extract text from prescription image[22m[K[54C[m
OCR Service initialized successfully[69C
[105C
[90mstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text f[m
[90m[2m[10;105Hfrom image[22m[K[96C[m
Starting OCR processing for order test-order-123[57C
OCR attempt 1/3 for image: https://example.com/test-image.jpg[44C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m[K[48C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 0/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 0/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[58C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [32m[22m[1m0 passed[90m[22m (36)[K[80C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m11.22s[K[87C
[105C[?2026l[?2026h[6;1H[K
[K
[K
[K
[K
[K[105C[4;1H[K
[K[105C[2;1H[K
[K[105C[H[K[105C[H[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m
OCR attempt 1 failed: (intermediate value) is not iterable[33m[1m[6;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 0/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [32m[22m[1m0 passed[90m[22m (36)[K[80C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m11.22s[K[87C
[105C[?2026l[?2026h[10;1H[K
[K[105C[6;1H[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should extract text from prescription image[m[K
Starting OCR processing for order prescription-order-123[K
OCR attempt 1/3 for image: https://storage.googleapis.com/prescriptions/prescription-001.jpg[K
[K[33m[1m[7;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 0/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [32m[22m[1m0 passed[90m[22m (36)[K[80C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m11.22s[K[87C
[105C[?2026l[?2026h[3;1H[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should extract text from prescription image[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[33m[1m[6;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 0/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [32m[22m[1m0 passed[90m[22m (36)[K[80C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m11.22s[K[87C[?2026l
[105C[?2026h[9;1H[K
[K
[K[105C[H[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m
OCR attempt 2/3 for image: https://example.com/test-image.jpg[33m[1m[6;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 0/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [32m[22m[1m0 passed[90m[22m (36)[K[80C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m11.22s[K[87C
[105C[?2026l[?2026h[10;1H[K
[K[105C[9;1H[K[105C[7;1H[K
[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[2;1H[K
[K[105C[H[K[105C[H[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m
OCR attempt 2 failed: (intermediate value) is not iterable[33m[1m[6;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 0/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [32m[22m[1m0 passed[90m[22m (36)[K[80C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m11.22s[K[87C
[105C[?2026l[?2026h[K[105C[8;1H[K
[K
[K[105C[7;1H[K[105C[5;1H[K
[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[H[K[105C[H[K[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should extract text from prescription image[m
OCR attempt 2/3 for image: https://storage.googleapis.com/prescriptions/prescription-001.jpg[33m[1m[6;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 0/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [32m[22m[1m0 passed[90m[22m (36)[K[80C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m11.22s[K[87C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[4;1H[K
[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[H[K[105C[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should extract text from prescription image[m
OCR attempt 2 failed: (intermediate value) is not iterable[33m[1m[6;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 0/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [32m[22m[1m0 passed[90m[22m (36)[K[80C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m11.22s[K[87C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[5;1H[K
[K
[K
[K[105C[4;1H[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m[K
OCR attempt 3/3 for image: https://example.com/test-image.jpg[K[90m[5;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should extract text from prescription image[m
OCR attempt 3/3 for image: https://storage.googleapis.com/prescriptions/prescription-001.jpg[33m[1m[10;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 0/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 1/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[58C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (36)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m13.34s[K[87C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[7;1H[K
[K
[K[105C[6;1H[K[105C[4;1H[K
[K[105C[H[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m
OCR attempt 3 failed: (intermediate value) is not iterable[90m[5;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should extract text from prescription image[m
OCR attempt 3 failed: (intermediate value) is not iterable[90m[9;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermed
[10;105Hdiate value) is not iterable[78C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:68:22[K[28C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extra[m
[90m[2m[10;105Haction > should extract text from prescription image[22m[K[54C[m
OCR processing failed for order prescription-order-123: Error: OCR failed after 3 attempts. Last error: (
[10;105H(intermediate value) is not iterable[70C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:95:22[K[24C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m[K[48C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 0/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 1/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[58C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (36)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m13.34s[K[87C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[H[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m
OCR Service initialized successfully[90m[5;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle handwritten prescription with lower confidence[m
OCR Service initialized successfully[90m[9;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m
Starting OCR processing for order test-order-123
OCR attempt 1/3 for image: https://example.com/test-image.jpg[44C
[105C
[90mstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extra[m
[90m[2m[10;105Haction > should handle handwritten prescription with lower confidence[22m[K[37C[m
Starting OCR processing for order handwritten-prescription-456[43C
OCR attempt 1/3 for image: https://storage.googleapis.com/prescriptions/handwritten-001.jpg[14C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m[K[48C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 1/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[58C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (36)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m13.82s[K[87C
[105C[?2026l[?2026h[K[105C[8;1H[K
[K
[K[105C[5;1H[K
[K
[K[105C[3;1H[K
[K[105C[2;1H[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m
OCR attempt 1 failed: (intermediate value) is not iterable[90m[5;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle handwritten prescription with lower confidence[m
OCR attempt 1 failed: (intermediate value) is not iterable[33m[1m[10;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 1/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[58C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (36)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m13.82s[K[87C
[105C[?2026l[?2026h[10;1H[K
[K[105C[9;1H[K[105C[8;1H[K[105C[6;1H[K
[K[105C[5;1H[K[105C[4;1H[K[105C[H[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m
OCR attempt 2/3 for image: https://example.com/test-image.jpg[90m[5;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle handwritten prescription with lower confidence[m
OCR attempt 2/3 for image: https://storage.googleapis.com/prescriptions/handwritten-001.jpg[33m[1m[10;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 1/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[58C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (36)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m13.82s[K[87C[?2026l[?2026h
[105C[10;1H[K[105C[8;1H[K
[K[105C[7;1H[K[105C[5;1H[K
[K[105C[2;1H[K
[K
[K[105C[H[K[105C[H[K[105C[H[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m
OCR attempt 2 failed: (intermediate value) is not iterable[90m[5;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle handwritten prescription with lower confidence[m
OCR attempt 2 failed: (intermediate value) is not iterable[33m[1m[10;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 1/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[58C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (36)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m13.82s[K[87C
[105C[?2026l[?2026h[10;1H[K
[K[105C[9;1H[K[105C[7;1H[K
[K[105C[H[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m
OCR attempt 3/3 for image: https://example.com/test-image.jpg[90m[5;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle handwritten prescription with lower confidence[m
OCR attempt 3/3 for image: https://storage.googleapis.com/prescriptions/handwritten-001.jpg[33m[1m[10;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 1/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[58C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (36)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m13.82s[K[87C[?2026l[?2026h
[105C[H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m
OCR attempt 3 failed: (intermediate value) is not iterable[90m[5;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle handwritten prescription with lower confidence[m
OCR attempt 3 failed: (intermediate value) is not iterable[90m[9;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermed
[10;105Hdiate value) is not iterable[78C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:84:22[K[28C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extra[m
[90m[2m[10;105Haction > should handle handwritten prescription with lower confidence[22m[K[37C[m
OCR processing failed for order handwritten-prescription-456: Error: OCR failed after 3 attempts. Last er
[10;105Hrror: (intermediate value) is not iterable[64C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:126:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m[K[48C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 1/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[58C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (36)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m13.82s[K[87C[?2026l
[105C[?2026h[4;1H[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
Starting OCR processing for order test-order-123
OCR attempt 1/3 for image: https://example.com/test-image.jpg[90m[8;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle poor quality image with partial text[m
OCR Service initialized successfully

[90mstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extra[m
[90m[2m[10;105Haction > should handle poor quality image with partial text[22m[K[47C[m
Starting OCR processing for order poor-quality-789[55C
OCR attempt 1/3 for image: https://storage.googleapis.com/prescriptions/poor-quality-001.jpg[13C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][22m[K[48C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 1/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[58C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (36)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m13.82s[K[87C[?2026l[?2026h
[9;1H                                                                                                         
                                                                                                         
[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle poor quality image with partial text[m
OCR attempt 1 failed: (intermediate value) is not iterable[33m[1m[9;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 1/19[22m
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m [queued][22m[K[58C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m [queued][22m[K[58C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (36)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m13.82s[K[87C[?2026l
[105C[?2026h[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR attempt 2/3 for image: https://example.com/test-image.jpg[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle poor quality image with partial text[m[K
OCR attempt 2/3 for image: https://storage.googleapis.com/prescriptions/poor-quality-001.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 3/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m6 failed[m[2m | [32m[22m[1m0 passed[90m[22m (86)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.10s[K[87C[?2026l[?2026h
[4;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle poor quality image with partial text[m
OCR attempt 2 failed: (intermediate value) is not iterable[33m[1m[9;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 3/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m6 failed[m[2m | [32m[22m[1m0 passed[90m[22m (86)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.10s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR attempt 3/3 for image: https://example.com/test-image.jpg[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle poor quality image with partial text[m[K
OCR attempt 3/3 for image: https://storage.googleapis.com/prescriptions/poor-quality-001.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 3/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m6 failed[m[2m | [32m[22m[1m0 passed[90m[22m (86)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.10s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extraction > should handle poor quality image with partial text[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:98:22[K[28C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Real-world prescription text extra[m
[90m[2m[10;105Haction > should handle poor quality image with partial text[22m[K[47C[m
OCR processing failed for order poor-quality-789: Error: OCR failed after 3 attempts. Last error: (interm
[10;105Hmediate value) is not iterable[76C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:153:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 3/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m6 failed[m[2m | [32m[22m[1m0 passed[90m[22m (86)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.10s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle QUOTA_EXCEEDED error[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
Starting OCR processing for order test-order-123[K
OCR attempt 1/3 for image: https://example.com/test-image.jpg[K
[K[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 3/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m6 failed[m[2m | [32m[22m[1m0 passed[90m[22m (86)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.10s[K[87C[?2026l[?2026h
[9;1H                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 3/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m

[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m6 failed[m[2m | [32m[22m[1m0 passed[90m[22m (86)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.10s[K[87C[?2026l[?2026h
[9;1H                                                                                                         
                                                                                                         
[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle QUOTA_EXCEEDED error[m[K
Starting OCR processing for order quota-test[K
OCR attempt 1/3 for image: https://example.com/test.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 3/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m6 failed[m[2m | [32m[22m[1m0 passed[90m[22m (86)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.10s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle QUOTA_EXCEEDED error[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 3/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m6 failed[m[2m | [32m[22m[1m0 passed[90m[22m (86)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.10s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle QUOTA_EXCEEDED error[m[K
OCR attempt 2/3 for image: https://example.com/test.jpg[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR attempt 2/3 for image: https://example.com/test-image.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 3/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m6 failed[m[2m | [32m[22m[1m0 passed[90m[22m (86)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.10s[K[87C[?2026l[?2026h
[6;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle QUOTA_EXCEEDED error[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[33m[1m[9;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 3/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m6 failed[m[2m | [32m[22m[1m0 passed[90m[22m (86)[K[69C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.10s[K[87C[?2026l
[105C[?2026h[2;1H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR attempt 3/3 for image: https://example.com/test-image.jpg[33m[1m[5;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m

[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m7 failed[m[2m | [32m[22m[1m0 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.43s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:11[90m)[K[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:116:22[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m7 failed[m[2m | [32m[22m[1m0 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.43s[K[87C[?2026l[?2026h
[8;1H                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle QUOTA_EXCEEDED error[m[K
OCR attempt 3/3 for image: https://example.com/test.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m7 failed[m[2m | [32m[22m[1m0 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.43s[K[87C
[105C[?2026l[?2026h[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle QUOTA_EXCEEDED error[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle QUOTA_EXCEEDED error[m[K
OCR processing failed for order quota-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:11[90m)[K[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:174:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m7 failed[m[2m | [32m[22m[1m0 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.43s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
Starting OCR processing for order test-order-123[K
OCR attempt 1/3 for image: https://example.com/test-image.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m7 failed[m[2m | [32m[22m[1m0 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.43s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K
[K[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m7 failed[m[2m | [32m[22m[1m0 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.43s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle PERMISSION_DENIED error[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle PERMISSION_DENIED error[m[K
Starting OCR processing for order permission-test[K
OCR attempt 1/3 for image: https://example.com/test.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m7 failed[m[2m | [32m[22m[1m0 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.43s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle PERMISSION_DENIED error[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 3/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 0/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m7 failed[m[2m | [32m[22m[1m0 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.43s[K[87C[?2026l
[105C[?2026h[90m[Hstderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/register > successfully registers a new user with email[m[K
Error in POST /auth/register: TypeError: Cannot read properties of undefined (reading 'uid')[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:85:19[K
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)[K
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[K[m
[K
[K[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 4/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 2/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m8 failed[m[2m | [32m[22m[1m2 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.69s[K[87C[?2026l[?2026h
[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR attempt 2/3 for image: https://example.com/test-image.jpg[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle PERMISSION_DENIED error[m[K
OCR attempt 2/3 for image: https://example.com/test.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 4/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 2/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m8 failed[m[2m | [32m[22m[1m2 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.69s[K[87C[?2026l[?2026h
[10;1H                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle PERMISSION_DENIED error[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 4/19[22m
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 2/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m8 failed[m[2m | [32m[22m[1m2 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.69s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR attempt 3/3 for image: https://example.com/test-image.jpg[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle PERMISSION_DENIED error[m[K
OCR attempt 3/3 for image: https://example.com/test.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 4/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 2/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m8 failed[m[2m | [32m[22m[1m2 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.69s[K[87C[?2026l[?2026h
[8;1H                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle PERMISSION_DENIED error[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:127:22[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scen[m
[90m[2m[10;105Hnarios > should handle PERMISSION_DENIED error[22m[K[60C[m
OCR processing failed for order permission-test: Error: OCR failed after 3 attempts. Last error: (interme
[10;105Hediate value) is not iterable[77C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:192:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 4/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 2/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m8 failed[m[2m | [32m[22m[1m2 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.69s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m[K
Starting OCR processing for order test-order-123[K
OCR attempt 1/3 for image: https://example.com/test-image.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 4/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 2/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m8 failed[m[2m | [32m[22m[1m2 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.69s[K[87C[?2026l[?2026h
[9;1H                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 4/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 2/16[22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m8 failed[m[2m | [32m[22m[1m2 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.69s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle INVALID_ARGUMENT for unsupported image format[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle INVALID_ARGUMENT for unsupported image format[m[K
Starting OCR processing for order invalid-format-test[K
OCR attempt 1/3 for image: https://example.com/document.tiff[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 0/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 4/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 2/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m8 failed[m[2m | [32m[22m[1m2 passed[90m[22m (112)[K[68C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.69s[K[87C[?2026l
[105C[?2026h[K[105C[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle INVALID_ARGUMENT for unsupported image format[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/register > successfully registers a new user with phone number[m[K
Error in POST /auth/register: TypeError: Cannot read properties of undefined (reading 'uid')[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:85:19[K
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)[K
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 3/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 3/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m12 failed[m[2m | [32m[22m[1m4 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.90s[K[87C
[105C[?2026l[?2026h[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m[K
OCR attempt 2/3 for image: https://example.com/test-image.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 3/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 3/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m12 failed[m[2m | [32m[22m[1m4 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.90s[K[87C[?2026l[?2026h
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 3/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 3/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m12 failed[m[2m | [32m[22m[1m4 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.90s[K[87C[?2026l[?2026h
[6;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle INVALID_ARGUMENT for unsupported image format[m[K
OCR attempt 2/3 for image: https://example.com/document.tiff[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 3/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 3/16[22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m12 failed[m[2m | [32m[22m[1m4 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.90s[K[87C[?2026l[?2026h
[105C[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle INVALID_ARGUMENT for unsupported image format[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/register > returns 401 with invalid token[m[K
Error in POST /auth/register: TypeError: Cannot read properties of undefined (reading 'uid')[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:85:19[K
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)[K
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 3/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 3/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m12 failed[m[2m | [32m[22m[1m4 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m16.90s[K[87C[?2026l
[105C[?2026h[3;1H[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle INVALID_ARGUMENT for unsupported image format[m[K
OCR attempt 3/3 for image: https://example.com/document.tiff[33m[1m[6;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m 5/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 5/16[22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m13 failed[m[2m | [32m[22m[1m7 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.11s[K[87C
[105C[?2026l[?2026h[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle INVALID_ARGUMENT for unsupported image format[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle INVALID_ARGUMENT for unsupported image format[m[K
OCR processing failed for order invalid-format-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:11[90m)[K[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:210:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 5/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 5/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m13 failed[m[2m | [32m[22m[1m7 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.11s[K[87C[?2026l[?2026h
[2;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m
OCR attempt 3/3 for image: https://example.com/test-image.jpg[33m[1m[6;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m 5/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 5/16[22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m13 failed[m[2m | [32m[22m[1m7 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.11s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m[K
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:11[90m)[K[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:137:22[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 5/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 5/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m13 failed[m[2m | [32m[22m[1m7 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.11s[K[87C[?2026l
[105C[?2026h[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle network timeout errors[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle network timeout errors[m[K
Starting OCR processing for order timeout-test[K
OCR attempt 1/3 for image: https://example.com/large-image.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 5/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 5/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m13 failed[m[2m | [32m[22m[1m7 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.11s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle network timeout errors[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 5/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 5/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m13 failed[m[2m | [32m[22m[1m7 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.11s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > validateImageForOCR > should validate correct image URLs[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > validateImageForOCR > should reject empty or invalid URLs[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > validateImageForOCR > should reject unsupported file types[m[K
OCR Service initialized successfully[K[69C
[105C
[90mstdout[2m | src/features/ocrService.test.ts > OCRService > validateImageForOCR > should accept supported fil[m
[90m[2m[10;105Hle types[22m[K[98C[m
OCR Service initialized successfully[69C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 5/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 5/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 5/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m13 failed[m[2m | [32m[22m[1m7 passed[90m[22m (112)[K[67C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.11s[K[87C[?2026l
[105C[?2026h[6;1H[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle network timeout errors[m[K
OCR attempt 2/3 for image: https://example.com/large-image.jpg[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > healthCheck > should return true when service is healthy[m
OCR Service initialized successfully[33m[1m[10;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m 8/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 6/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 10/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 6/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m15 failed[m[2m | [32m[22m[1m15 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.38s[K[87C[?2026l[?2026h
[105C[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle network timeout errors[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 8/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 6/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 10/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 6/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m15 failed[m[2m | [32m[22m[1m15 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.38s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > healthCheck > should return false when service is unhealthy[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
Starting OCR processing for order test-order[K[61C
OCR attempt 1/3 for image: https://example.com/image.jpg[49C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 8/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 6/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 10/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 6/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m15 failed[m[2m | [32m[22m[1m15 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.38s[K[87C[?2026l[?2026h
[2;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m
OCR attempt 1 failed: (intermediate value) is not iterable[90m[5;1Hstderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/register > returns 403 when token UID does not match request UID[m
Error in POST /auth/register: TypeError: Cannot read properties of undefined (reading 'uid')
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:85:19
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 8/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 6/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 10/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 6/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m15 failed[m[2m | [32m[22m[1m15 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.38s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle network timeout errors[m[K
OCR attempt 3/3 for image: https://example.com/large-image.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 8/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 6/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 10/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 6/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m15 failed[m[2m | [32m[22m[1m15 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.38s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle network timeout errors[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Google Cloud Vision API error scenarios > should handle network timeout errors[m[K
OCR processing failed for order timeout-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:11[90m)[K[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:228:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 8/26[22m[K[66C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 6/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 10/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 6/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m15 failed[m[2m | [32m[22m[1m15 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.38s[K[87C
[105C[?2026l[?2026h[90m[Hstderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/register > returns 409 when user already exists[m[K
Error in POST /auth/register: TypeError: Cannot read properties of undefined (reading 'uid')[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:85:19[K
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)[K
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[K[m
[K
[K[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 11/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 8/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m16 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.59s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR attempt 2/3 for image: https://example.com/image.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 11/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 8/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m16 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.59s[K[87C[?2026l[?2026h
[6;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 11/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 8/16[22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m16 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.59s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should succeed after transient network error[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should succeed after transient network error[m[K
Starting OCR processing for order retry-success-test[K
OCR attempt 1/3 for image: https://example.com/prescription.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 11/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 8/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m16 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.59s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should succeed after transient network error[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/register > handles user service validation errors[m[K
Error in POST /auth/register: TypeError: Cannot read properties of undefined (reading 'uid')[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:85:19[K
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)[K
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[90mstderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/register > handles user service gener[m
[90m[2m[10;105Hral errors[22m[K[96C[m
Error in POST /auth/register: TypeError: Cannot read properties of undefined (reading 'uid')[13C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:85:19[K[33C
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js
[10;105Hs:95:5)[99C
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 11/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 8/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m16 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.59s[K[87C
[105C[?2026l[?2026h[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should succeed after transient network error[m[K
OCR attempt 2/3 for image: https://example.com/prescription.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 11/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 8/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m16 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.59s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should succeed after transient network error[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/register > continues registration even if custom claims fail[m[K
Error in POST /auth/register: TypeError: Cannot read properties of undefined (reading 'uid')[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:85:19[K
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)[K
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 11/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 8/16[22m[K[62C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m16 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.59s[K[87C[?2026l
[105C[?2026h[90m[Hstderr[2m | src/features/authRoutes.test.ts > Auth Routes > GET /auth/me > returns current user profile[m     
Error in GET /auth/me: TypeError: Cannot read properties of undefined (reading 'uid')[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:152:27[K
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)[K
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[K[m
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 15/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 12/16[22m[K[61C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m20 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.80s[K[87C[?2026l[?2026h
[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR attempt 3/3 for image: https://example.com/image.jpg[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[33m[1m[6;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m 15/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 12/16[22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m20 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.80s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR processing failed for order test-order: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:11[90m)[K[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:227:22[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/authRoutes.test.ts > Auth Routes > GET /auth/me > returns 404 when user profile not[m
[90m[2m[10;105Ht found[22m[K[99C[m
Error in GET /auth/me: TypeError: Cannot read properties of undefined (reading 'uid')[20C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:152:27[K[32C
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js
[10;105Hs:95:5)[99C
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 15/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 12/16[22m[K[61C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m20 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.80s[K[87C[?2026l[?2026h
[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m[K
Starting OCR processing for order test-order[K
OCR attempt 1/3 for image: https://example.com/image.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 15/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 12/16[22m[K[61C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m20 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.80s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/authRoutes.test.ts > Auth Routes > PUT /auth/profile > successfully updates user profile[m[K
Error in PUT /auth/profile: TypeError: Cannot read properties of undefined (reading 'uid')[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:209:27[K
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)[K
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[K[m
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined re[m
[90m[2m[10;105Hesponses[22m[K[98C[m
OCR attempt 1 failed: (intermediate value) is not iterable[47C
[105C
[90mstderr[2m | src/features/authRoutes.test.ts > Auth Routes > PUT /auth/profile > removes uid from update data[m
Error in PUT /auth/profile: TypeError: Cannot read properties of undefined (reading 'uid')[15C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:209:27[K[32C
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js
[10;105Hs:95:5)[99C
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 15/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 12/16[22m[K[61C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m20 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.80s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should succeed after transient network error[m[K
OCR attempt 3/3 for image: https://example.com/prescription.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 15/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 12/16[22m[K[61C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m20 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.80s[K[87C
[105C[?2026l[?2026h[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should succeed after transient network error[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should succeed after transient network error[m[K
OCR processing failed for order retry-success-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:11[90m)[K[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:255:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 15/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 7/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 12/16[22m[K[61C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m20 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m17.80s[K[87C[?2026l
[105C[?2026h[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m[K
OCR attempt 2/3 for image: https://example.com/image.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 19/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 8/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 13/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 15/16[22m[K[61C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m33 failed[m[2m | [32m[22m[1m22 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.02s[K[87C[?2026l[?2026h
[10;1H                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 19/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 8/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 13/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 15/16[22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m33 failed[m[2m | [32m[22m[1m22 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.02s[K[87C[?2026l[?2026h
[8;1H                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should fail after max retries with persistent error[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should fail after max retries with persistent error[m[K
Starting OCR processing for order persistent-error-test[K
OCR attempt 1/3 for image: https://example.com/prescription.jpg[33m[1m[11;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m 19/26[22m
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 8/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 13/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 15/16[22m[K[61C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m33 failed[m[2m | [32m[22m[1m22 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.02s[K[87C
[105C[?2026l[?2026h[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should fail after max retries with persistent error[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/authRoutes.test.ts > Auth Routes > PUT /auth/profile > returns 404 when user not found[m[K
Error in PUT /auth/profile: TypeError: Cannot read properties of undefined (reading 'uid')[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:209:27[K
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)[K
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[90mstderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/login > successfully returns user pro[m
[90m[2m[10;105Hofile for authenticated user[22m[K[78C[m
Error in POST /auth/login: TypeError: Cannot read properties of undefined (reading 'uid')[16C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:180:27[K[32C
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js
[10;105Hs:95:5)[99C
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[90mstderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/login > returns 401 when invalid toke[m
[90m[2m[10;105Hen[22m[K[104C[m
Error in POST /auth/login: TypeError: Cannot read properties of undefined (reading 'uid')[16C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:180:27[K[32C
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js
[10;105Hs:95:5)[99C
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 19/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 8/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 13/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 15/16[22m[K[61C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m33 failed[m[2m | [32m[22m[1m22 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.02s[K[87C[?2026l[?2026h
[6;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should fail after max retries with persistent error[m[K
OCR attempt 2/3 for image: https://example.com/prescription.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 19/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 8/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 13/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 15/16[22m
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m33 failed[m[2m | [32m[22m[1m22 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.02s[K[87C
[105C[?2026l[?2026h[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should fail after max retries with persistent error[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 19/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 8/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 13/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 0/17[22m[K[33m[1m
 ‚ùØ [msrc/features/receiptService.test.ts[2m 15/16[22m[K[61C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (27)[K[80C[m
[2m      Tests [31m[22m[1m33 failed[m[2m | [32m[22m[1m22 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.02s[K[87C[?2026l
[105C[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[6;1H[K
[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[H[K[105C[90m[Hstderr[2m | src/features/paymentService.test.ts > PaymentService > processPayment > should successfully process a Stripe payment[m
Failed to generate receipt for payment: mock-doc-id TypeError: this.receiptsCollection.where(...).where(...).orderBy is not a function
    at ReceiptService.generateReceiptNumber [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\receiptService.ts:146:8[90m)[m
    at ReceiptService.generateReceipt [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\receiptService.ts:78:38[90m)[m
    at PaymentService.processPayment [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\paymentService.ts:118:34[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\paymentService.test.ts:77:22
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 23/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 9/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 1/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 16/16[22m[K[61C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m37 failed[m[2m | [32m[22m[1m26 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.65s[K[87C[?2026l
[105C[?2026h[5;1H[K
[K
[K
[K
[K
[K
[K[105C[H[K
[K
[K
[K[105C[H[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m
OCR attempt 3/3 for image: https://example.com/image.jpg[90m[5;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should fail after max retries with persistent error[m
OCR attempt 3/3 for image: https://example.com/prescription.jpg[33m[1m[10;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m 23/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 9/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 1/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 16/16[22m[K[61C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m37 failed[m[2m | [32m[22m[1m26 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.65s[K[87C
[105C[?2026l[?2026h[9;1H[K
[K
[K[105C[6;1H[K
[K
[K[105C[4;1H[K
[K[105C[3;1H[K[105C[H[K
[K[105C[H[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m
OCR attempt 3 failed: (intermediate value) is not iterable[90m[5;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should fail after max retries with persistent error[m
OCR attempt 3 failed: (intermediate value) is not iterable[90m[9;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m
OCR processing failed for order test-order: Error: OCR failed after 3 attempts. Last error: (intermediate
[10;105He value) is not iterable[82C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:239:22[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 23/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 9/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 1/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 16/16[22m[K[61C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m37 failed[m[2m | [32m[22m[1m26 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.65s[K[87C[?2026l
[105C[?2026h[K[105C[5;1H[K
[K
[K
[K
[K
[K[105C[H[K
[K
[K
[K[105C[H [31m‚ùØ [msrc/features/receiptService.test.ts [2m(16 tests | [31m[22m4 failed[m[2m)[33m[22m 2304[2mms[m
   [33m[2m‚úì[m ReceiptService[2m > [22mgenerateReceipt[2m > [22mshould generate a compliant Benin receipt with all required fields  [33m629[2mms[m
   [32m‚úì [mReceiptService[2m > [22mgenerateReceipt[2m > [22mshould correctly calculate tax for USD payments [32m149[2mms[m
   [32m‚úì [mReceiptService[2m > [22mgenerateReceipt[2m > [22mshould handle XOF currency without exchange rate [32m102[2mms[m
   [32m‚úì [mReceiptService[2m > [22mgenerateReceipt[2m > [22mshould include customer information when provided [32m97[2mms[m
   [32m‚úì [mReceiptService[2m > [22mgenerateReceipt[2m > [22mshould handle orders without detailed medication info [32m113[2mms[m
   [32m‚úì [mReceiptService[2m > [22mgenerateReceipt[2m > [22mshould include French and English legal text [32m108[2mms[31m[22m
   √ó ReceiptService[2m > [22mgenerateReceipt[2m > [22mshould update payment record with receipt details [32m183[2mms[31m[22m
     ‚Üí expected "spy" to be called with arguments: [ ObjectContaining{‚Ä¶} ][m

[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
   [32m‚úì [mReceiptService[2m > [22mgenerateReceiptNumber[2m > [22mshould generate sequential receipt numbers [32m94[2mms[m[K[12C
[31m   √ó ReceiptService[2m > [22mgenerateReceiptNumber[2m > [22mshould increment from existing receipt numbers [32m123[2mms[m       
[31m     ‚Üí expected 'BJ-2025-000001' to be 'BJ-2024-000006' // Object.is equality[28C[m
[31m   √ó ReceiptService[2m > [22mgetReceiptByPaymentId[2m > [22mshould return receipt when found [32m26[2mms[m[K[22C
[31m     ‚Üí expected null to deeply equal { receiptId: 'test-receipt-1', ‚Ä¶(2) }[31C[m
   [32m‚úì [mReceiptService[2m > [22mgetReceiptByPaymentId[2m > [22mshould return null when receipt not found [32m5[2mms[m[K[14C
   [32m‚úì [mReceiptService[2m > [22mgenerateReceiptForPayment[2m > [22mshould generate receipt for existing payment [32m133[2mms[m     
[31m   √ó ReceiptService[2m > [22mgenerateReceiptForPayment[2m > [22mshould throw error when payment not found [32m21[2mms[m[K[9C
[31m     ‚Üí expected [Function] to throw error including 'Payment not found' but got 'Order not found'        [m
   [32m‚úì [mReceiptService[2m > [22mgenerateReceiptForPayment[2m > [22mshould throw error when order not found [32m11[2mms[m[K[11C
   [32m‚úì [mReceiptService[2m > [22mPDF generation[2m > [22mshould generate PDF buffer [32m116[2mms[m[K[34C
   [33m[2m‚úì[m ReceiptService[2m > [22mPDF generation[2m > [22mshould include proper PDF headers for different payment gateways  
[33m[10;105H 369[2mms[22m[K[100C[m
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 23/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 9/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 1/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 16/16[22m[K[61C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m37 failed[m[2m | [32m[22m[1m26 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.65s[K[87C[?2026l
[105C[?2026h[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Retry logic with transient failures > should fail after max retries with persistent error[m[K
OCR processing failed for order persistent-error-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:11[90m)[K[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:276:22[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K
[K[90m
stderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/login > returns 404 when user profile[m
[90m[2m[10;105He not found[22m[K[95C[m
Error in POST /auth/login: TypeError: Cannot read properties of undefined (reading 'uid')[16C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:180:27[K[32C
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js
[10;105Hs:95:5)[99C
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 23/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 9/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 1/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 16/16[22m[K[61C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m37 failed[m[2m | [32m[22m[1m26 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.65s[K[87C[?2026l
[105C[?2026h[9;1H[K
[K
[K[105C[8;1H[K[105C[H[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR Service initialized successfully[90m[4;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process JPEG images successfully[m
OCR Service initialized successfully[90m[8;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m
Starting OCR processing for order test-order
OCR attempt 1/3 for image: https://example.com/image.jpg

[90mstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should pro[m
[90m[2m[10;105Hocess JPEG images successfully[22m[K[76C[m
Starting OCR processing for order jpeg-test[62C
OCR attempt 1/3 for image: https://example.com/prescription.jpg[42C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 23/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 9/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 1/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 16/16[22m[K[61C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m37 failed[m[2m | [32m[22m[1m26 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.65s[K[87C[?2026l[?2026h
[8;1H                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process JPEG images successfully[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/login > handles database errors gracefully[m
Error in POST /auth/login: TypeError: Cannot read properties of undefined (reading 'uid')
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:180:27
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js
[10;105Hs:95:5)[99C
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[90mstderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/login > handles unexpected errors[m    
Error in POST /auth/login: TypeError: Cannot read properties of undefined (reading 'uid')[16C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:180:27[K[32C
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js
[10;105Hs:95:5)[99C
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)[K[20C
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 23/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 0/17[22m[K[52C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 9/19[22m[K[62C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 1/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/receiptService.test.ts[2m 16/16[22m[K[61C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m37 failed[m[2m | [32m[22m[1m26 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m18.65s[K[87C[?2026l
[105C[?2026h[K[105C[10;1H[K[105C[5;1H[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process JPEG images successfully[m[K
OCR attempt 2/3 for image: https://example.com/prescription.jpg[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m
OCR attempt 2/3 for image: https://example.com/image.jpg[33m[1m[9;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m 25/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m57 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m19.81s[K[87C[?2026l
[105C[?2026h[90m[Hstderr[2m | src/features/paymentService.test.ts > PaymentService > processPayment > should successfully process a PayPal payment[m[K
Failed to generate receipt for payment: mock-doc-id TypeError: this.receiptsCollection.where(...).where(...).orderBy is not a function[K
    at ReceiptService.generateReceiptNumber [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\receiptService.ts:146:8[90m)[K[m
    at ReceiptService.generateReceipt [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\receiptService.ts:78:38[90m)[K[m
    at PaymentService.processPayment [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\paymentService.ts:118:34[90m)[K[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\paymentService.test.ts:95:22[K[24C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should pro[m
[90m[2m[10;105Hocess JPEG images successfully[22m[K[76C[m
OCR attempt 2 failed: (intermediate value) is not iterable[47C
[105C
[90mstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR attempt 2 failed: (intermediate value) is not iterable[47C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 25/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m57 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m19.81s[K[87C[?2026l[?2026h
[9;1H                                                                                                         
                                                                                                         
[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process JPEG images successfully[m[K
OCR attempt 3/3 for image: https://example.com/prescription.jpg[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR attempt 3/3 for image: https://example.com/image.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 25/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m57 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m19.81s[K[87C
[105C[?2026l[?2026h[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process JPEG images successfully[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 25/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m57 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m19.81s[K[87C[?2026l[?2026h
[5;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[H [31m‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts [2m(17 tests | [31m[22m17 failed[m[2m)[33m[22m 3067[2mms[m[K[31m
   √ó Doctor Prescription Routes[2m > [22mAuthentication[2m > [22mshould return 401 for missing authorization header [33m2916[2mms[m[K[31m
     ‚Üí vi.mocked(...).mockImplementation is not a function[K
   √ó Doctor Prescription Routes[2m > [22mAuthentication[2m > [22mshould return 401 for invalid token format [32m14[2mms[31m[22m
     ‚Üí vi.mocked(...).mockImplementation is not a function
   √ó Doctor Prescription Routes[2m > [22mAuthentication[2m > [22mshould return 401 for invalid token [32m5[2mms[31m[22m
     ‚Üí vi.mocked(...).mockImplementation is not a function
   √ó Doctor Prescription Routes[2m > [22mAuthentication[2m > [22mshould return 403 for non-doctor role [32m6[2mms[31m[22m
     ‚Üí vi.mocked(...).mockImplementation is not a function
   √ó Doctor Prescription Routes[2m > [22mGET /api/doctor/patients[2m > [22mshould search patients successfully [32m6[2mms[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mGET /api/doctor/patients[2m > [22mshould return 400 for missing query paramete[m
[31m[10;105Her [32m5[2mms[31m[22m[K[100C[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mGET /api/doctor/patients[2m > [22mshould return 400 for invalid search type [32m8[2mm[m
[32m[2m[10;105Hms[22m[K[104C[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mGET /api/doctor/patients[2m > [22mshould handle service errors [32m5[2mms[m[K[12C
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mPOST /api/doctor/prescriptions[2m > [22mshould submit prescription successfull[m
[31m[10;105Hly [32m8[2mms[31m[22m[K[100C[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mPOST /api/doctor/prescriptions[2m > [22mshould return 400 for missing patient [m
[31m[10;105H profile ID [32m5[2mms[31m[22m[K[91C[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mPOST /api/doctor/prescriptions[2m > [22mshould return 400 for missing medicati[m
[31m[10;105Hion details [32m6[2mms[31m[22m[K[91C[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mPOST /api/doctor/prescriptions[2m > [22mshould return 400 for invalid refills [m
[31m[10;105H authorized [32m4[2mms[31m[22m[K[91C[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mPOST /api/doctor/prescriptions[2m > [22mshould return 404 for non-existent pat[m
[31m[10;105Htient profile [32m4[2mms[31m[22m[K[89C[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mGET /api/doctor/prescriptions[2m > [22mshould get prescription history success[m
[31m[10;105Hsfully [32m4[2mms[31m[22m[K[96C[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mGET /api/doctor/prescriptions[2m > [22mshould return 400 for invalid page para[m
[31m[10;105Hameter [32m47[2mms[31m[22m[K[95C[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mGET /api/doctor/prescriptions[2m > [22mshould return 400 for invalid limit par[m
[31m[10;105Hrameter [32m6[2mms[31m[22m[K[95C[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[31m   √ó Doctor Prescription Routes[2m > [22mGET /api/doctor/prescriptions[2m > [22mshould use default pagination values [32m4[2mm[m
[32m[2m[10;105Hms[22m[K[104C[m
[31m     ‚Üí vi.mocked(...).mockImplementation is not a function[47C[m
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 25/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m57 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m19.81s[K[87C[?2026l[?2026h
[4;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/authRoutes.test.ts > Auth Routes > POST /auth/login > verifies Firebase token with correct parameters[m[K
Error in POST /auth/login: TypeError: Cannot read properties of undefined (reading 'uid')[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:180:27
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)
    at verifyFirebaseToken [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\authRoutes.ts:39:5[90m)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[11;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should pro[m
[90m[2m[10;105Hocess JPEG images successfully[22m[K[76C[m
OCR processing failed for order jpeg-test: Error: OCR failed after 3 attempts. Last error: (intermediate 
[10;105H value) is not iterable[83C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:297:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR processing failed for order test-order: Error: OCR failed after 3 attempts. Last error: (intermediate
[10;105He value) is not iterable[82C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:250:22[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 25/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m57 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m19.81s[K[87C[?2026l
[105C[?2026h[H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[H [31m‚ùØ [msrc/features/authRoutes.test.ts [2m(26 tests | [31m[22m18 failed[m[2m)[33m[22m 3665[2mms[31m[22m
   √ó Auth Routes[2m > [22mPOST /auth/register[2m > [22msuccessfully registers a new user with email [33m438[2mms[31m[22m
     ‚Üí expected 500 to be 201 // Object.is equality
   √ó Auth Routes[2m > [22mPOST /auth/register[2m > [22msuccessfully registers a new user with phone number [32m69[2mms[31m[22m
     ‚Üí expected 500 to be 201 // Object.is equality[m
   [32m‚úì [mAuth Routes[2m > [22mPOST /auth/register[2m > [22mreturns 401 without authorization header [32m120[2mms[31m[22m
   √ó Auth Routes[2m > [22mPOST /auth/register[2m > [22mreturns 401 with invalid token [32m53[2mms[31m[22m
     ‚Üí expected 500 to be 401 // Object.is equality[m
   [32m‚úì [mAuth Routes[2m > [22mPOST /auth/register[2m > [22mreturns 400 without uid [32m145[2mms[m
   [32m‚úì [mAuth Routes[2m > [22mPOST /auth/register[2m > [22mreturns 400 with invalid role [32m32[2mms[m
   [32m‚úì [mAuth Routes[2m > [22mPOST /auth/register[2m > [22mreturns 400 without display name [32m36[2mms[m
   [32m‚úì [mAuth Routes[2m > [22mPOST /auth/register[2m > [22mreturns 400 without email or phone number [32m198[2mms[m[K[17C
[31m   √ó Auth Routes[2m > [22mPOST /auth/register[2m > [22mreturns 403 when token UID does not match request UID [32m54[2mms[m      
[31m     ‚Üí expected 500 to be 403 // Object.is equality[54C[m
[31m   √ó Auth Routes[2m > [22mPOST /auth/register[2m > [22mreturns 409 when user already exists [32m48[2mms[m[K[23C
[31m     ‚Üí expected 500 to be 409 // Object.is equality[54C[m
[31m   √ó Auth Routes[2m > [22mPOST /auth/register[2m > [22mhandles user service validation errors [32m115[2mms[m[K[20C
[31m     ‚Üí expected 500 to be 400 // Object.is equality[54C[m
   [32m‚úì [mAuth Routes[2m > [22mPOST /auth/register[2m > [22mhandles user service general errors [32m29[2mms[m[K[24C
[31m   √ó Auth Routes[2m > [22mPOST /auth/register[2m > [22mcontinues registration even if custom claims fail [32m34[2mms[m[K[10C
[31m     ‚Üí expected 500 to be 201 // Object.is equality[54C[m
[31m   √ó Auth Routes[2m > [22mGET /auth/me[2m > [22mreturns current user profile [32m75[2mms[m[K[38C
[31m     ‚Üí expected 500 to be 200 // Object.is equality[54C[m
   [32m‚úì [mAuth Routes[2m > [22mGET /auth/me[2m > [22mreturns 401 without valid token [32m24[2mms[m[K[35C
[31m   √ó Auth Routes[2m > [22mGET /auth/me[2m > [22mreturns 404 when user profile not found [32m32[2mms[m[K[27C
[31m     ‚Üí expected 500 to be 404 // Object.is equality[54C[m
[31m   √ó Auth Routes[2m > [22mPUT /auth/profile[2m > [22msuccessfully updates user profile [32m36[2mms[m[K[28C
[31m     ‚Üí expected 400 to be 200 // Object.is equality[54C[m
[31m   √ó Auth Routes[2m > [22mPUT /auth/profile[2m > [22mremoves uid from update data [32m50[2mms[m[K[33C
[31m     ‚Üí expected "spy" to be called with arguments: [ 'test-uid-123', ‚Ä¶(1) ][30C[m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[31m   √ó Auth Routes[2m > [22mPUT /auth/profile[2m > [22mreturns 404 when user not found [32m109[2mms[m[K[29C
[31m     ‚Üí expected 400 to be 404 // Object.is equality[54C[m
[31m   √ó Auth Routes[2m > [22mPOST /auth/login[2m > [22msuccessfully returns user profile for authenticated user [32m30[2mms[m      
[31m     ‚Üí expected 500 to be 200 // Object.is equality[54C[m
   [32m‚úì [mAuth Routes[2m > [22mPOST /auth/login[2m > [22mreturns 401 when no authorization header [32m26[2mms[m[K[22C
[31m   √ó Auth Routes[2m > [22mPOST /auth/login[2m > [22mreturns 401 when invalid token [32m39[2mms[m[K[32C
[31m     ‚Üí expected 500 to be 401 // Object.is equality[54C[m
[31m   √ó Auth Routes[2m > [22mPOST /auth/login[2m > [22mreturns 404 when user profile not found [33m538[2mms[m[K[22C
[31m     ‚Üí expected 500 to be 404 // Object.is equality[54C[m
[31m   √ó Auth Routes[2m > [22mPOST /auth/login[2m > [22mhandles database errors gracefully [32m50[2mms[m[K[28C
[31m     ‚Üí expected { Object (error) } to deeply equal { error: 'Database connection failed' }[15C[m
[31m   √ó Auth Routes[2m > [22mPOST /auth/login[2m > [22mhandles unexpected errors [32m33[2mms[m[K[37C
[31m     ‚Üí expected { Object (error) } to deeply equal { Object (error) }[36C[m
[31m   √ó Auth Routes[2m > [22mPOST /auth/login[2m > [22mverifies Firebase token with correct parameters [33m1235[2mms[m[K[13C
[31m     ‚Üí expected "spy" to be called with arguments: [ 'mock-firebase-token' ][29C[m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[90mstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should pro[m
[90m[2m[10;105Hocess PNG images successfully[22m[K[77C[m
OCR Service initialized successfully[69C
[105C
[90mstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image[m
[90m[2m[10;105He within reasonable time[22m[K[82C[m
OCR Service initialized successfully[69C
[105C
[90mstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should pro[m
[90m[2m[10;105Hocess PNG images successfully[22m[K[77C[m
Starting OCR processing for order png-test[63C
OCR attempt 1/3 for image: https://example.com/prescription.png[42C
[105C
[90mstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image[m
[90m[2m[10;105He within reasonable time[22m[K[82C[m
Starting OCR processing for order perf-test[62C
OCR attempt 1/3 for image: https://example.com/image.jpg[49C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 16/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m60 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.31s[K[87C[?2026l[?2026h
[105C[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PNG images successfully[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 16/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m60 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.31s[K[87C[?2026l[?2026h
[105C[3;1H[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PNG images successfully[m[K
OCR attempt 2/3 for image: https://example.com/prescription.png[90m[5;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m
OCR attempt 2/3 for image: https://example.com/image.jpg[33m[1m[10;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 16/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m60 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.31s[K[87C[?2026l[?2026h
[H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PNG images successfully[m
OCR attempt 2 failed: (intermediate value) is not iterable[90m[5;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m
OCR attempt 2 failed: (intermediate value) is not iterable[33m[1m[10;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 16/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m60 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.31s[K[87C
[105C[?2026l[?2026h[K[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PNG images successfully[m[K
OCR attempt 3/3 for image: https://example.com/prescription.png[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 16/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C

[2m Test Files [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m60 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.31s[K[87C[?2026l[?2026h
[105C[9;1H[K
[K
[K[105C[5;1H[K
[K
[K
[K[105C[H[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PNG images successfully[m
OCR attempt 3 failed: (intermediate value) is not iterable[33m[1m[6;1H ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[33m[22m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[33m[22m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 16/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m

[2m Test Files [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m60 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.31s[K[87C[?2026l[?2026h
[8;1H                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m[K
OCR attempt 3/3 for image: https://example.com/image.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 16/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m

[2m Test Files [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m60 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.31s[K[87C[?2026l[?2026h
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PNG images successfully[m[K
OCR processing failed for order png-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:11[90m)[K[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:318:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image[m
[90m[2m[10;105He within reasonable time[22m[K[82C[m
OCR processing failed for order perf-test: Error: OCR failed after 3 attempts. Last error: (intermediate 
[10;105H value) is not iterable[83C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:268:22[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 16/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m60 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.31s[K[87C[?2026l[?2026h
[3;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PDF documents successfully[m[K
OCR Service initialized successfully[90m[5;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m
OCR Service initialized successfully[90m[9;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PDF documents successfully[m
Starting OCR processing for order pdf-test
OCR attempt 1/3 for image: https://example.com/prescription.pdf[42C
[105C
[90mstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large [m
[90m[2m[10;105H text extraction[22m[K[90C[m
Starting OCR processing for order large-text-test[56C
OCR attempt 1/3 for image: https://example.com/large-image.jpg[43C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 16/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m60 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.31s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PDF documents successfully[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 10/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 16/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m3 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m60 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.31s[K[87C
[105C[?2026l[?2026h[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR attempt 2/3 for image: https://example.com/large-image.jpg[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PDF documents successfully[m[K
OCR attempt 2/3 for image: https://example.com/prescription.pdf[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 12/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m63 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.75s[K[87C
[105C[?2026l[?2026h[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PDF documents successfully[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 12/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m63 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.75s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR attempt 3/3 for image: https://example.com/large-image.jpg[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PDF documents successfully[m[K
OCR attempt 3/3 for image: https://example.com/prescription.pdf[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 12/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m63 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.75s[K[87C[?2026l[?2026h
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should process PDF documents successfully[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR processing failed for order large-text-test: Error: OCR failed after 3 attempts. Last error: (interme
[10;105Hediate value) is not iterable[77C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:284:22[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Image format handling > should pro[m
[90m[2m[10;105Hocess PDF documents successfully[22m[K[74C[m
OCR processing failed for order pdf-test: Error: OCR failed after 3 attempts. Last error: (intermediate v
[10;105Hvalue) is not iterable[84C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:336:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 12/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m63 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.75s[K[87C[?2026l[?2026h
[H [31m‚ùØ [msrc/features/ocrService.test.ts [2m(17 tests | [31m[22m12 failed[m[2m)[33m[22m 9603[2mms[m[K[31m
   √ó OCRService[2m > [22mprocessImage[2m > [22mshould successfully extract text from image [33m502[2mms[m[K[31m
     ‚Üí expected false to be true // Object.is equality[K
   √ó OCRService[2m > [22mprocessImage[2m > [22mshould handle empty text detection results [33m2281[2mms[m[K[31m
     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to be 'OCR failed after 3 attempts. Last err‚Ä¶' // Object.is equality[K
   √ó OCRService[2m > [22mprocessImage[2m > [22mshould handle empty extracted text [33m421[2mms[m[K[31m
     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to be 'OCR failed after 3 attempts. Last err‚Ä¶' // Object.is equality[K
   √ó OCRService[2m > [22mprocessImage[2m > [22mshould retry on transient failures [33m2126[2mms[m[K[31m
     ‚Üí expected false to be true // Object.is equality[K[51C[m
[31m   √ó OCRService[2m > [22mprocessImage[2m > [22mshould fail after max retries [33m334[2mms[m[K[37C
[31m     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to be 'OCR failed after 3 attempts. Last err‚Ä¶' /[m
[31m[10;105H// Object.is equality[85C[m
[31m   √ó OCRService[2m > [22mprocessImage[2m > [22mshould handle Vision API errors gracefully [33m405[2mms[m[K[24C
[31m     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'QUOTA_EXCEEDED'[21C[m
   [32m‚úì [mOCRService[2m > [22mvalidateImageForOCR[2m > [22mshould validate correct image URLs [32m16[2mms[m[K[26C
   [32m‚úì [mOCRService[2m > [22mvalidateImageForOCR[2m > [22mshould reject empty or invalid URLs [32m11[2mms[m[K[25C
   [32m‚úì [mOCRService[2m > [22mvalidateImageForOCR[2m > [22mshould reject unsupported file types [32m21[2mms[m[K[24C
   [32m‚úì [mOCRService[2m > [22mvalidateImageForOCR[2m > [22mshould accept supported file types [32m10[2mms[m[K[26C
[31m   √ó OCRService[2m > [22mhealthCheck[2m > [22mshould return true when service is healthy [32m159[2mms[m[K[25C
[31m     ‚Üí expected "spy" to be called at least once[57C[m
[31m   √ó OCRService[2m > [22mhealthCheck[2m > [22mshould return false when service is unhealthy [32m9[2mms[m[K[24C
[31m     ‚Üí expected true to be false // Object.is equality[51C[m
[31m   √ó OCRService[2m > [22merror scenarios[2m > [22mshould handle malformed Vision API responses [33m429[2mms[m[K[19C
[31m     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'No text detected in the image'      [m
   [33m[2m‚úì[m OCRService[2m > [22merror scenarios[2m > [22mshould handle null/undefined responses  [33m373[2mms[m[K[24C
[31m   √ó OCRService[2m > [22merror scenarios[2m > [22mshould handle network timeouts [33m860[2mms[m[K[33C
[31m     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'TIMEOUT'[28C[m
[31m   √ó OCRService[2m > [22mperformance considerations[2m > [22mshould process image within reasonable time [33m1270[2mms[m        
[31m     ‚Üí expected false to be true // Object.is equality[51C[m
[31m   √ó OCRService[2m > [22mperformance considerations[2m > [22mshould handle large text extraction [33m354[2mms[m[K[17C
[31m     ‚Üí expected false to be true // Object.is equality[51C[m
[90mstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > shou[m
[90m[2m[10;105Huld handle large prescription images[22m[K[70C[m
OCR Service initialized successfully[69C
[105C
[90mstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > shou[m
[90m[2m[10;105Huld handle large prescription images[22m[K[70C[m
Starting OCR processing for order large-image-test[55C
OCR attempt 1/3 for image: https://example.com/large-prescription.jpg[36C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[65C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[51C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 12/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m63 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.75s[K[87C[?2026l
[105C[?2026h[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle large prescription images[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 12/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K
[K[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m63 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.75s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle large prescription images[m[K
OCR attempt 2/3 for image: https://example.com/large-prescription.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/authRoutes.test.ts[2m 26/26[22m[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionRoutes.test.ts[2m 17/17[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 12/19[22m[K[33m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K
[K[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m63 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m20.75s[K[87C[?2026l
[105C[?2026h[4;1H[K
[K
[K
[K
[K
[K
[K
[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[90m[Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle large prescription images[m
OCR attempt 2 failed: (intermediate value) is not iterable[33m[1m[6;1H ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 13/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[10;1H Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m64 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m21.19s[K[87C[?2026l
[105C[?2026h[K[105C[9;1H[K
[K[105C[7;1H[K
[K[105C[6;1H[K[105C[3;1H[K
[K
[K[105C[2;1H[K[105C[90mstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle large prescription images[m
OCR attempt 3/3 for image: https://example.com/large-prescription.jpg[33m[1m[7;1H ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 13/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[11;1H Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m
[2m      Tests [31m[22m[1m64 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m21.19s[K[87C[?2026l
[105C[?2026h[K[105C[10;1H[K[105C[9;1H[K]0;node (vitest 4)[105C[6;1H[K
[K
[K[105C[4;1H[K
[K[105C[2;1H[K
[K[105C[90m[2;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle large prescription images[m
OCR attempt 3 failed: (intermediate value) is not iterable[90m[6;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle large prescription images[m
OCR processing failed for order large-image-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:11[90m)[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:360:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
]0;node (vitest 5)[105C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 13/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m64 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m21.19s[K[87C[?2026l[?2026h
[105C[9;1H[K
[K[105C[8;1H[K[105C[5;1H[K
[K
[K[105C[2;1H[K
[K
[K[105C[90m[2;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m
OCR Service initialized successfully[33m[1m[7;1H ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 13/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[11;1H Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m
[2m      Tests [31m[22m[1m64 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m21.19s[K[87C[?2026l[?2026h
[105C[9;1H[K
[K
[K[105C[6;1H[K
[K
[K[105C[5;1H[K[105C[2;1H[K
[K
[K[105C[90m[2;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m
OCR attempt 1 failed: (intermediate value) is not iterable
OCR attempt 1 failed: (intermediate value) is not iterable
OCR attempt 1 failed: (intermediate value) is not iterable[33m[1m[9;1H ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 13/19[33m[22m[1m
 ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m64 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m21.19s[K[87C
[105C[?2026l[?2026h[10;1H[K
[K[105C[5;1H[K
[K
[K
[K
[K[105C[90m[2;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m[K
Starting OCR processing for order concurrent-1[K
OCR attempt 1/3 for image: https://example.com/rx1.jpg
Starting OCR processing for order concurrent-2
OCR attempt 1/3 for image: https://example.com/rx2.jpg
Starting OCR processing for order concurrent-3
OCR attempt 1/3 for image: https://example.com/rx3.jpg]0;node (vitest 3)[11;1H
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 13/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/ocrService.test.ts[2m 17/17[22m[K[65C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m64 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m21.19s[K[87C[?2026l
[105C[?2026h[90m[2;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m[K
OCR attempt 2/3 for image: https://example.com/rx1.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K
[K[2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR attempt 2 failed: (intermediate value) is not iterable                                               
                                                                                                         
                                                                                                         [33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m                                                             [33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m                                                              
                                                                                                         [2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l[?2026h
[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR attempt 2/3 for image: https://example.com/rx2.jpg                                                   
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[33m[1m[8;1H ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[11;1H Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR attempt 2 failed: (intermediate value) is not iterable                                               
                                                                                                         
                                                                                                         [33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m                                                             [33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m                                                              
                                                                                                         [2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C
[105C[?2026l[?2026h[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m[K
OCR attempt 2/3 for image: https://example.com/rx3.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K
[K[2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR attempt 2 failed: (intermediate value) is not iterable                                               
                                                                                                         
                                                                                                         [33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m                                                             [33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m                                                              
                                                                                                         [2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l[?2026h
[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR attempt 3/3 for image: https://example.com/rx1.jpg                                                   
                                                                                                         
                                                                                                         [33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m                                                             [33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m                                                              
                                                                                                         [2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR attempt 3 failed: (intermediate value) is not iterable                                               
                                                                                                         [90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR processing failed for order concurrent-1: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable                                                                                
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
[90m    at runNextTicks (node:internal/process/task_queues:65:5)[45C[m
[90m    at listOnTimeout (node:internal/timers:549:9)[56C[m
[90m    at processTimers (node:internal/timers:523:7)[56C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at async Promise.all (index 0)[71C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:387:23[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l
[105C[?2026h[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m[K
OCR attempt 3/3 for image: https://example.com/rx2.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K
[K[2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR attempt 3 failed: (intermediate value) is not iterable                                               
                                                                                                         [90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR processing failed for order concurrent-2: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable                                                                                
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
[90m    at runNextTicks (node:internal/process/task_queues:65:5)[45C[m
[90m    at listOnTimeout (node:internal/timers:549:9)[56C[m
[90m    at processTimers (node:internal/timers:523:7)[56C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at async Promise.all (index 1)[71C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:387:23[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l[?2026h
[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR attempt 3/3 for image: https://example.com/rx3.jpg                                                   
                                                                                                         
                                                                                                         [33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m                                                             [33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m                                                              
                                                                                                         [2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR attempt 3 failed: (intermediate value) is not iterable                                               
                                                                                                         [90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Performance and scalability > should handle concurrent OCR requests[m                                                                        
OCR processing failed for order concurrent-3: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable                                                                                
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at async Promise.all (index 2)[71C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:387:23[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l[?2026h
[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Health check integration > should verify service connectivity[m                                                                              
OCR Service initialized successfully                                                                     
                                                                                                         [90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Health check integration > should detect service unavailability[m                                                                            
OCR Service initialized successfully                                                                     
                                                                                                         [90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions[m
[90m[2m[10;105Hs > should handle images with no text[22m[K[69C[m
OCR Service initialized successfully[69C
[105C
[90mstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions[m
[90m[2m[10;105Hs > should handle images with no text[22m[K[69C[m
Starting OCR processing for order no-text-test[59C
OCR attempt 1/3 for image: https://example.com/blank-image.jpg[43C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle images with no text[m                                                                     
OCR attempt 1 failed: (intermediate value) is not iterable                                               
                                                                                                         
                                                                                                         [33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 15/19[22m                                                             [33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 2/17[22m                                                              
                                                                                                         [2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m66 failed[m[2m | [32m[22m[1m27 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.50s[K[87C
[105C[?2026l[?2026h[10;1H[K
[K[105C[90m[3;1Hstderr[2m | src/features/paymentService.test.ts > PaymentService > processPayment > should successfully process an MTN Mobile Money payment[m[K
Failed to generate receipt for payment: mock-doc-id TypeError: this.receiptsCollection.where(...).where(...).orderBy is not a function[K
    at ReceiptService.generateReceiptNumber [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\receiptService.ts:146:8[90m)[K[m
    at ReceiptService.generateReceipt [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\receiptService.ts:78:38[90m)[m
    at PaymentService.processPayment [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\paymentService.ts:118
[10;105H8:34[90m)[K[101C[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\paymentService.test.ts:115:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 17/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m68 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.87s[K[87C[?2026l[?2026h
[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle images with no text[m                                                                     
OCR attempt 2/3 for image: https://example.com/blank-image.jpg                                           
                                                                                                         
                                                                                                         [33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 17/19[22m                                                             [33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m                                                              
                                                                                                         [2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m68 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.87s[K[87C[?2026l[?2026h
[105C[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle images with no text[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 17/19[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K
[K[2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m68 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.87s[K[87C[?2026l[?2026h
[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle images with no text[m                                                                     
OCR attempt 3/3 for image: https://example.com/blank-image.jpg                                           
                                                                                                         
                                                                                                         [33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 17/19[22m                                                             [33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m                                                              
                                                                                                         [2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m68 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.87s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle images with no text[m                                                                     
OCR attempt 3 failed: (intermediate value) is not iterable                                               
                                                                                                         [90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle images with no text[m                                                                     
OCR processing failed for order no-text-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable                                                                                
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:431:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 17/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m68 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.87s[K[87C
[105C[?2026l[?2026h[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle corrupted image responses[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle corrupted image responses[m[K
Starting OCR processing for order corrupted-test[K
OCR attempt 1/3 for image: https://example.com/corrupted.jpg[K
[K[105C
[105C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 17/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m68 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.87s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle corrupted image responses[m                                                               
OCR attempt 1 failed: (intermediate value) is not iterable                                               
                                                                                                         
                                                                                                         [33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 17/19[22m                                                             [33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m                                                              
                                                                                                         [2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m68 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m22.87s[K[87C[?2026l
[105C[?2026h[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle corrupted image responses[m[K
OCR attempt 2/3 for image: https://example.com/corrupted.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 18/19[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K
[K[2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m23.20s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle corrupted image responses[m                                                               
OCR attempt 2 failed: (intermediate value) is not iterable                                               
                                                                                                         
                                                                                                         [33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 18/19[22m                                                             [33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m                                                              
                                                                                                         [2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m23.20s[K[87C
[105C[?2026l[?2026h[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle corrupted image responses[m[K
OCR attempt 3/3 for image: https://example.com/corrupted.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 18/19[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K
[K[2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m23.20s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle corrupted image responses[m                                                               
OCR attempt 3 failed: (intermediate value) is not iterable                                               
                                                                                                         [90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle corrupted image responses[m                                                               
OCR processing failed for order corrupted-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable                                                                              
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:447:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 18/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m23.20s[K[87C[?2026l[?2026h
[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle malformed API responses[m                                                                 
OCR Service initialized successfully                                                                     
                                                                                                         [90m
stdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle malformed API responses[m                                                                 
Starting OCR processing for order malformed-test                                                         
OCR attempt 1/3 for image: https://example.com/test.jpg                                                  
[105C
[105C
[33m[1m ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 18/19[22m[K[61C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m23.20s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle malformed API responses[m                                                                 
OCR attempt 1 failed: (intermediate value) is not iterable                                               
                                                                                                         
                                                                                                         [33m[1m
 ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 18/19[22m                                                             [33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m                                                              
                                                                                                         [2m
 Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m23.20s[K[87C[?2026l
[105C[?2026h[5;1H[K
[K
[K
[K
[K
[K
[K[105C[4;1H[K[105C[3;1H[K[105C[90mstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle malformed API responses[m
OCR attempt 2/3 for image: https://example.com/test.jpg[33m[1m[8;1H ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 18/19[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[11;1H Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m23.30s[K[87C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[7;1H[K
[K[105C[6;1H[K[105C[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle malformed API responses[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K[33m[1m[8;1H ‚ùØ [msrc/features/ocrIntegration.test.ts[2m 18/19[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[11;1H Test Files [31m[22m[1m4 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m28 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m23.30s[K[87C[?2026l
[105C[?2026h[90m[3;1Hstdout[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle malformed API responses[m[K
OCR attempt 3/3 for image: https://example.com/test.jpg[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K
[K[2m
 Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m29 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m24.02s[K[87C[?2026l[?2026h
[90m[3;1Hstderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle malformed API responses[m                                                                 
OCR attempt 3 failed: (intermediate value) is not iterable                                               
                                                                                                         [90m
stderr[2m | src/features/ocrIntegration.test.ts > OCR Integration Tests > Edge cases and boundary conditions > should handle malformed API responses[m                                                                 
OCR processing failed for order malformed-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable                                                                              
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:103:1
[10;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:32[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrIntegration.test.ts:461:22[K[23C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m29 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m24.02s[K[87C[?2026l[?2026h
[3;1H [31m‚ùØ [msrc/features/ocrIntegration.test.ts [2m(19 tests | [31m[22m18 failed[m[2m)[33m[22m 12464[2mms[m                                    [31m
   √ó OCR Integration Tests[2m > [22mReal-world prescription text extraction[2m > [22mshould extract text from prescription image [33m456[2mms[m                                                                                          [31m
     ‚Üí expected false to be true // Object.is equality                                                   
   √ó OCR Integration Tests[2m > [22mReal-world prescription text extraction[2m > [22mshould handle handwritten prescription with lower confidence [33m2329[2mms[m                                                                        [31m
     ‚Üí expected false to be true // Object.is equality                                                   
   √ó OCR Integration Tests[2m > [22mReal-world prescription text extraction[2m > [22mshould handle poor quality image with partial text [33m439[2mms[m[K[83C
[31m     ‚Üí expected false to be true // Object.is equality[51C[m
[31m   √ó OCR Integration Tests[2m > [22mGoogle Cloud Vision API error scenarios[2m > [22mshould handle QUOTA_EXCEEDED error[m
[31m[10;105Hr[33m 2122[2mms[22m[K[98C[m
[31m     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'Quota exceeded'[21C[m
[31m   √ó OCR Integration Tests[2m > [22mGoogle Cloud Vision API error scenarios[2m > [22mshould handle PERMISSION_DENIED er[m
[31m[10;105Hrror [33m355[2mms[31m[22m[K[96C[m
[31m     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'permission'[25C[m
[31m   √ó OCR Integration Tests[2m > [22mGoogle Cloud Vision API error scenarios[2m > [22mshould handle INVALID_ARGUMENT for[m
[31m[10;105Hr unsupported image format [33m340[2mms[31m[22m[K[74C[m
[31m     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'Invalid image format'[15C[m
[31m   √ó OCR Integration Tests[2m > [22mGoogle Cloud Vision API error scenarios[2m > [22mshould handle network timeout erro[m
[31m[10;105Hors [33m346[2mms[31m[22m[K[97C[m
[31m     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'Deadline exceeded'[18C[m
[31m   √ó OCR Integration Tests[2m > [22mRetry logic with transient failures[2m > [22mshould succeed after transient network[m
[31m[10;105Hk error [33m438[2mms[31m[22m[K[93C[m
[31m     ‚Üí expected false to be true // Object.is equality[51C[m
[31m   √ó OCR Integration Tests[2m > [22mRetry logic with transient failures[2m > [22mshould fail after max retries with per[m
[31m[10;105Hrsistent error [33m442[2mms[31m[22m[K[86C[m
[31m     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'Internal server error'[14C[m
[31m   √ó OCR Integration Tests[2m > [22mImage format handling[2m > [22mshould process JPEG images successfully [33m693[2mms[m       
[31m     ‚Üí expected false to be true // Object.is equality[51C[m
[31m   √ó OCR Integration Tests[2m > [22mImage format handling[2m > [22mshould process PNG images successfully [33m1264[2mms[m       
[31m     ‚Üí expected false to be true // Object.is equality[51C[m
[31m   √ó OCR Integration Tests[2m > [22mImage format handling[2m > [22mshould process PDF documents successfully [33m359[2mms[m     
[31m     ‚Üí expected false to be true // Object.is equality[51C[m
[31m   √ó OCR Integration Tests[2m > [22mPerformance and scalability[2m > [22mshould handle large prescription images [33m443[2mms[m 
[31m     ‚Üí expected false to be true // Object.is equality[51C[m
[31m   √ó OCR Integration Tests[2m > [22mPerformance and scalability[2m > [22mshould handle concurrent OCR requests [33m368[2mms[m   
[31m     ‚Üí expected false to be true // Object.is equality[51C[m
[31m   √ó OCR Integration Tests[2m > [22mHealth check integration[2m > [22mshould verify service connectivity [33m1025[2mms[m        
[31m     ‚Üí expected "spy" to be called at least once[57C[m
[31m   √ó OCR Integration Tests[2m > [22mHealth check integration[2m > [22mshould detect service unavailability [32m9[2mms[m[K[9C
[31m     ‚Üí expected true to be false // Object.is equality[51C[m
[31m   √ó OCR Integration Tests[2m > [22mEdge cases and boundary conditions[2m > [22mshould handle images with no text [33m356[2mms[m
[31m     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'No text detected'[19C[m
[31m   √ó OCR Integration Tests[2m > [22mEdge cases and boundary conditions[2m > [22mshould handle corrupted image responses[m
[31m[10;105Hs[33m 330[2mms[22m[K[99C[m
[31m     ‚Üí expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'Empty text extracted'[15C[m
   [33m[2m‚úì[m OCR Integration Tests[2m > [22mEdge cases and boundary conditions[2m > [22mshould handle malformed API responses  
[33m[10;105H 329[2mms[22m[K[100C[m
[105C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K[62C
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m29 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m24.02s[K[87C[?2026l
[105C[?2026h[3;1H[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m29 passed[90m[22m (112)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m24.52s[K[87C[?2026l
[105C[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 3/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][8;1H Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m29 passed[90m[22m (112)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m24.76s
[105C[?2026l[?2026h[2;1H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 4/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][8;1H Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m30 passed[90m[22m (112)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m25.45s[?2026l
[105C]0;node (vitest 2)[?2026h[K[105C[8;1H[K
[K
[K[105C[5;1H[K
[K
[K[105C[3;1H[K
[K[105C[H[K
[K[105C[H[K[105C[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 4/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][8;1H Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m30 passed[90m[22m (112)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m25.77s
[105C[?2026l[?2026h[2;1H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 4/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][8;1H Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m30 passed[90m[22m (112)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m26.43s[?2026l
[105C[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[7;1H[K
[K[105C[6;1H[K[105C[5;1H[K[105C[2;1H[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 4/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][8;1H Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m30 passed[90m[22m (112)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m26.81s[?2026l
[105C[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 4/17[22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m30 passed[90m[22m (112)[K[m[2m
   Start at [22m00:00:15[K[85C
[2m   Duration [22m27.33s[K[87C[?2026l
[105C[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 4/17[22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m30 passed[90m[22m (112)[K[m[2m
   Start at [22m00:00:15[K[85C
[2m   Duration [22m27.48s[K[87C
[105C[?2026l[?2026h[2;1H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 0/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 4/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m [queued][9;1H Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m30 passed[90m[22m (132)[m[2m
   Start at [22m00:00:15
[2m   Duration [22m27.79s[K[87C[?2026l
[105C[?2026h[10;1H[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 0/20[22m[K[33m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 0/18[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 4/17[22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m30 passed[90m[22m (150)[m[2m
   Start at [22m00:00:15
[2m   Duration [22m27.90s[K[87C[?2026l
[105C[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 0/20[22m[K[33m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 0/18[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m 0/36[22m[K
[K[2m
 Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m33 passed[90m[22m (186)[K[m[2m
   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.01s[K[87C
[105C[?2026l[?2026h[9;1H[K
[K
[K[105C[90m[Hstdout[2m | src/features/smsService.test.ts > SMSService > sendSMS > should send SMS successfully[m[K
SMS sent successfully: SM1234567890abcdef[K
[K[90m
stdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > POST /orders/:orderId/process-ocr > should start OCR processing for valid order[m[K
Received OCR processing request for order: test-order-123[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 3/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 0/18[22m
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 0/36[22m[K[66C
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m69 failed[m[2m | [32m[22m[1m36 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.24s[K[87C[?2026l
[105C[?2026h[6;1H[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrRoutes.test.ts > OCR Routes > POST /orders/:orderId/process-ocr > should start OCR processing for valid order[m[K
Unexpected error during async OCR processing setup for order: test-order-123 TypeError: __vite_ssr_import_1__.ocrService.processImageAndUpdateOrder is not a function[K
    at processOCRAsync [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrRoutes.ts:183:22[90m)[K[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrRoutes.ts:79:5[90m
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[9;1Hstderr[2m | src/features/smsService.test.ts > SMSService > sendSMS > should handle network errors[m
Error sending SMS: Error: Network timeout
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\smsService.test.ts:98:35
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 4/20[22m[K[54C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 1/18[22m[K[67C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 4/36[22m[K[66C
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m73 failed[m[2m | [32m[22m[1m38 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.35s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/smsService.test.ts > SMSService > sendSMS > should clean phone numbers correctly[m   
SMS sent successfully: SM1234567890abcdef[K
[K[90m
stdout[2m | src/features/smsService.test.ts > SMSService > sendSMS > should validate phone numbers[m[K
SMS sent successfully: SM1234567890abcdef[K
[K[90m
stdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > POST /orders/:orderId/process-ocr > should return 404 for non-existent order[m[K
Received OCR processing request for order: test-order-123[K
[K[90m
stdout[2m | src/features/smsService.test.ts > SMSService > sendSMS > should handle empty message text[m       
SMS sent successfully: SM1234567890abcdef[64C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 4/20[22m[K[54C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 1/18[22m[K[67C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 4/36[22m[K[66C
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m73 failed[m[2m | [32m[22m[1m38 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.35s[K[87C[?2026l[?2026h
[2;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/smsService.test.ts > SMSService > sendSMS > should handle rate limiting[m[K
Twilio SMS error: {
  code: [33m20003[m,
  message: [32m'Your account has exceeded the rate limit for this resource.'[m,
  more_info: [32m'https://www.twilio.com/docs/errors/20003'[m,
  status: [33m429[m
}[33m[1m[10;1H ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 4/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 1/18[22m[K[67C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 4/36[22m[K[66C
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m73 failed[m[2m | [32m[22m[1m38 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.35s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > POST /orders/:orderId/process-ocr > should return 400 for order without image URL[m[K
Received OCR processing request for order: test-order-123[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 4/20[22m[K[33m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 1/18[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m 4/36[22m[K[66C
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m73 failed[m[2m | [32m[22m[1m38 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.35s[K[87C[?2026l
[105C[?2026h[90m[Hstdout[2m | src/features/smsService.test.ts > SMSService > sendBulkSMS > should send bulk SMS with rate limiting[m[K
SMS sent successfully: SM1234567890abcdef[K
SMS sent successfully: SM1234567890abcdef[K
SMS sent successfully: SM1234567890abcdef[K
[K[90m
stdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > POST /orders/:orderId/process-ocr > should return 409 if OCR already in progress[m[K
Received OCR processing request for order: test-order-123[K
[K[90m
stdout[2m | src/features/smsService.test.ts > SMSService > sendBulkSMS > should handle partial failures in b[m
[90m[2m[10;105Hbulk SMS[22m[K[98C[m
SMS sent successfully: SM1234567890abcdef[64C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 6/20[22m[K[54C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 5/18[22m[K[67C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 9/36[22m[K[66C
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m78 failed[m[2m | [32m[22m[1m44 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.59s[K[87C[?2026l[?2026h
[5;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/smsService.test.ts > SMSService > sendBulkSMS > should handle partial failures in bulk SMS[m[K
Twilio SMS error: { code: [33m21211[m, message: [32m'Invalid phone number' [m}[K
[K[33m[1m[6;1H ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 6/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 5/18[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m 9/36[22m
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m78 failed[m[2m | [32m[22m[1m44 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.59s[K[87C[?2026l
[105C[?2026h[90m[Hstdout[2m | src/features/smsService.test.ts > SMSService > sendBulkSMS > should respect rate limiting in bulk SMS[m[K
SMS sent successfully: SM1234567890abcdef[K
SMS sent successfully: SM1234567890abcdef[K
[K[90m
stdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > POST /orders/:orderId/process-ocr > should return completed OCR if already processed[m[K
Received OCR processing request for order: test-order-123[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 6/20[22m[K[54C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 5/18[22m[K[67C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 9/36[22m[K[66C
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m78 failed[m[2m | [32m[22m[1m44 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.59s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/smsService.test.ts > SMSService > isConfigured > should return false when account SID is missing[m[K
Twilio SMS credentials not configured. SMS messaging will not work.[K
[K[90m
stderr[2m | src/features/smsService.test.ts > SMSService > isConfigured > should return false when auth token is missing[m[K
Twilio SMS credentials not configured. SMS messaging will not work.[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 6/20[22m[K[33m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 5/18[22m[K[67C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 9/36[22m[K[66C
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m78 failed[m[2m | [32m[22m[1m44 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.59s[K[87C[?2026l[?2026h
[10;1H                                                                                                         
[105C[6;1H[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > POST /orders/:orderId/process-ocr > should return 400 for invalid image URL[m[K
Received OCR processing request for order: test-order-123[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 6/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 5/18[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m 9/36[22m
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m78 failed[m[2m | [32m[22m[1m44 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.59s[K[87C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[8;1H[K
[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[H[K[105C[90m[Hstderr[2m | src/features/smsService.test.ts > SMSService > isConfigured > should return false when phone number is missing[m
Twilio SMS credentials not configured. SMS messaging will not work.[33m[1m[6;1H ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 6/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 5/18[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m 9/36[22m
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m78 failed[m[2m | [32m[22m[1m44 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.59s[K[87C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[H[K
[K
[K
[K[105C[H[K[105C[90m[Hstdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > POST /orders/:orderId/process-ocr > should handle database errors[m
Received OCR processing request for order: test-order-123[33m[1m[6;1H ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 6/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 5/18[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m 9/36[22m
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m78 failed[m[2m | [32m[22m[1m44 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.59s[K[87C[?2026l[?2026h
[2;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrRoutes.test.ts > OCR Routes > POST /orders/:orderId/process-ocr > should handle database errors[m
Error processing OCR request: Error: Database connection failed
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrRoutes.test.ts:209:40
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 6/20[22m[K[54C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 5/18[22m[K[67C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 9/36[22m[K[66C
[105C
[2m Test Files [31m[22m[1m5 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m78 failed[m[2m | [32m[22m[1m44 passed[90m[22m (186)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m28.59s[K[87C[?2026l
[105C[?2026h[9;1H[K
[K
[K[105C[7;1H[K
[K[105C[6;1H[K[105C[90m[Hstdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > GET /orders/:orderId/ocr-status > should return OCR status for existing order[m[K
Checking OCR status for order: test-order-456[K
[K[90m
stdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > GET /orders/:orderId/ocr-status > should return 404 for non-existent order[m
Checking OCR status for order: test-order-456[33m[1m[10;1H ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 20/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 18/18[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 1/27[22m[K[53C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 36/36[22m[K[65C
[105C
[2m Test Files [31m[22m[1m8 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m99 failed[m[2m | [32m[22m[1m78 passed[90m[22m (213)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m29.84s[K[87C[?2026l
[105C[?2026h[6;1H[K
[K
[K
[K
[K
[K[105C[2;1H[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/smsService.test.ts > SMSService > Service Initialization > should handle missing environment variables gracefully[m
Twilio SMS credentials not configured. SMS messaging will not work.[33m[1m[6;1H ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 20/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 18/18[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 1/27[33m[22m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m 36/36[22m
[105C
[2m Test Files [31m[22m[1m8 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m99 failed[m[2m | [32m[22m[1m78 passed[90m[22m (213)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m29.84s[K[87C[?2026l[?2026h
[H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > GET /orders/:orderId/ocr-status > should return pending status for orders without OCR data[m
Checking OCR status for order: test-order-456[90m[5;1Hstdout[2m | src/features/smsService.test.ts > SMSService > Rate Limiting and Performance > should handle concurrent SMS sending[m
SMS sent successfully: SM1234567890abcdef
SMS sent successfully: SM1234567890abcdef
SMS sent successfully: SM1234567890abcdef
SMS sent successfully: SM1234567890abcdef
SMS sent successfully: SM1234567890abcdef
[105C
[90mstdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > GET /orders/:orderId/ocr-status > should return fa[m
[90m[2m[10;105Hailed status with error message[22m[K[75C[m
Checking OCR status for order: test-order-456[60C
[105C
 [31m‚ùØ [msrc/features/smsService.test.ts [2m(36 tests | [31m[22m23 failed[m[2m)[33m[22m 750[2mms[m[K[42C
[31m   √ó SMSService[2m > [22msendSMS[2m > [22mshould send SMS successfully [32m136[2mms[m[K[43C
[31m     ‚Üí expected undefined to deeply equal { ‚Ä¶(4) }[55C[m
[31m   √ó SMSService[2m > [22msendSMS[2m > [22mshould handle Twilio API errors gracefully [32m38[2mms[m[K[30C
[31m     ‚Üí expected 'Invalid phone number format' to be 'The To phone number is not a valid ph‚Ä¶' // Object.is[m
[31m[10;105Hs equality[96C[m
[31m   √ó SMSService[2m > [22msendSMS[2m > [22mshould handle network errors [32m22[2mms[m[K[44C
[31m     ‚Üí expected 'Network error while sending SMS' to be 'Failed to send SMS: Network timeout' // Object.i[m
[31m[10;105His equality[95C[m
[31m   √ó SMSService[2m > [22msendSMS[2m > [22mshould clean phone numbers correctly [32m12[2mms[m[K[36C
[31m     ‚Üí expected 'To=+22912345678&From=+15551234567&Bod‚Ä¶' to contain 'To=%2B22912345678'[18C[m
[31m   √ó SMSService[2m > [22msendSMS[2m > [22mshould validate phone numbers [32m28[2mms[m[K[43C
[31m     ‚Üí expected true to be false // Object.is equality[51C[m
[31m   √ó SMSService[2m > [22msendSMS[2m > [22mshould handle empty message text [32m8[2mms[m[K[41C
[31m     ‚Üí expected true to be false // Object.is equality[51C[m
   [32m‚úì [mSMSService[2m > [22msendSMS[2m > [22mshould handle rate limiting [32m17[2mms[m[K[45C
[31m   √ó SMSService[2m > [22msendSMS[2m > [22mshould handle long messages and calculate segments [32m17[2mms[m[K[22C
[31m     ‚Üí expected 'GSM' to be 'GSM-7' // Object.is equality[48C[m
[31m   √ó SMSService[2m > [22msendBulkSMS[2m > [22mshould send bulk SMS with rate limiting [32m32[2mms[m[K[29C
[31m     ‚Üí expected undefined to deeply equal { totalSent: 3, totalFailed: +0, ‚Ä¶(1) }[24C[m
[31m   √ó SMSService[2m > [22msendBulkSMS[2m > [22mshould handle partial failures in bulk SMS [32m26[2mms[m[K[26C
[31m     ‚Üí expected undefined to deeply equal { totalSent: 2, totalFailed: 1, ‚Ä¶(1) }[25C[m
[31m   √ó SMSService[2m > [22msendBulkSMS[2m > [22mshould respect rate limiting in bulk SMS [32m6[2mms[m[K[29C
[31m     ‚Üí expected 1 to be greater than or equal to 100[53C[m
[31m   √ó SMSService[2m > [22msendBulkSMS[2m > [22mshould handle empty recipient list [32m4[2mms[m[K[35C
[31m     ‚Üí expected undefined to be 'No recipients provided' // Object.is equality[27C[m
[31m   √ó SMSService[2m > [22mgetMessageStatus[2m > [22mshould retrieve message status successfully [32m9[2mms[m[K[21C
[31m     ‚Üí expected undefined to deeply equal { ‚Ä¶(7) }[55C[m
[31m   √ó SMSService[2m > [22mgetMessageStatus[2m > [22mshould handle failed message status [32m10[2mms[m[K[28C
[31m     ‚Üí expected undefined to be 'failed' // Object.is equality[43C[m
   [32m‚úì [mSMSService[2m > [22mgetMessageStatus[2m > [22mshould handle non-existent message ID [32m5[2mms[m[K[27C
[31m   √ó SMSService[2m > [22mgetAccountInfo[2m > [22mshould retrieve account information successfully [32m17[2mms[m[K[17C
[31m     ‚Üí expected { sid: 'test-account-sid', ‚Ä¶(5) } to deeply equal { Object (accountSid, friendlyName, ...[m
[31m[10;105H.) }[102C[m
   [32m‚úì [mSMSService[2m > [22mgetAccountInfo[2m > [22mshould handle account access errors [32m3[2mms[m[K[31C
   [32m‚úì [mSMSService[2m > [22misConfigured[2m > [22mshould return true when all required config is present [32m3[2mms[m[K[14C
   [32m‚úì [mSMSService[2m > [22misConfigured[2m > [22mshould return false when account SID is missing [32m5[2mms[m[K[21C
   [32m‚úì [mSMSService[2m > [22misConfigured[2m > [22mshould return false when auth token is missing [32m3[2mms[m[K[22C
   [32m‚úì [mSMSService[2m > [22misConfigured[2m > [22mshould return false when phone number is missing [32m3[2mms[m[K[20C
[31m   √ó SMSService[2m > [22mformatPaymentMessage[2m > [22mshould format payment message for SMS correctly [32m8[2mms[m[K[13C
[31m     ‚Üí cost.toFixed is not a function[68C[m
[31m   √ó SMSService[2m > [22mformatPaymentMessage[2m > [22mshould handle long medication names by truncating [32m3[2mms[m[K[11C
[31m     ‚Üí cost.toFixed is not a function[68C[m
[31m   √ó SMSService[2m > [22mformatPaymentMessage[2m > [22mshould format currency correctly for different amounts [32m3[2mms[m      
[31m     ‚Üí cost.toFixed is not a function[68C[m
[31m   √ó SMSService[2m > [22mgetMessageInfo[2m > [22mshould calculate message segments correctly [32m5[2mms[m[K[23C
[31m     ‚Üí expected 'GSM' to be 'GSM-7' // Object.is equality[48C[m
[31m   √ó SMSService[2m > [22mgetMessageInfo[2m > [22mshould detect Unicode encoding for special characters [32m96[2mms[m[K[12C
[31m     ‚Üí expected 'UCS2' to be 'UCS-2' // Object.is equality[47C[m
[31m   √ó SMSService[2m > [22mgetMessageInfo[2m > [22mshould estimate costs based on segments and destination [32m5[2mms[m[K[11C
[31m     ‚Üí expected undefined to be close to 0.135, received difference is NaN, but expected 0.0005[10C[m
   [32m‚úì [mSMSService[2m > [22mPhone Number Validation and Cleaning[2m > [22mshould accept valid international phone numbers 
[32m[10;105H 5[2mms[22m[K[102C[m
[31m   √ó SMSService[2m > [22mPhone Number Validation and Cleaning[2m > [22mshould reject invalid phone number formats [32m4[2mms[m  
[31m     ‚Üí smsService.validatePhoneNumber is not a function[50C[m
   [32m‚úì [mSMSService[2m > [22mPhone Number Validation and Cleaning[2m > [22mshould handle West African country codes correct
[10;105Htly [32m4[2mms[m[K[99C
[31m   √ó SMSService[2m > [22mError Message Parsing[2m > [22mshould parse standard Twilio API errors [32m3[2mms[m[K[20C
[31m     ‚Üí smsService.parseErrorMessage is not a function[52C[m
[31m   √ó SMSService[2m > [22mError Message Parsing[2m > [22mshould handle malformed error responses [32m45[2mms[m[K[19C
[31m     ‚Üí smsService.parseErrorMessage is not a function[52C[m
   [32m‚úì [mSMSService[2m > [22mService Initialization[2m > [22mshould initialize with proper configuration [32m2[2mms[m[K[15C
   [32m‚úì [mSMSService[2m > [22mService Initialization[2m > [22mshould handle missing environment variables gracefully [32m10[2mms[m   
   [32m‚úì [mSMSService[2m > [22mRate Limiting and Performance[2m > [22mshould implement delay function correctly [32m106[2mms[m        
   [32m‚úì [mSMSService[2m > [22mRate Limiting and Performance[2m > [22mshould handle concurrent SMS sending [32m23[2mms[m[K[14C
[105C
[33m[1m ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 20/20[22m[K[53C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 18/18[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 1/27[22m[K[53C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 36/36[22m[K[65C
[105C
[2m Test Files [31m[22m[1m8 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m99 failed[m[2m | [32m[22m[1m78 passed[90m[22m (213)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m29.84s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/ocrRoutes.test.ts > OCR Routes > GET /ocr/health > should handle health check errors[m[K
Error checking OCR health: Error: Health check failed[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrRoutes.test.ts:366:52[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)[K
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)[K
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 20/20[22m[K[53C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 18/18[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 1/27[22m[K[53C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 36/36[22m[K[65C
[105C
[2m Test Files [31m[22m[1m8 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m99 failed[m[2m | [32m[22m[1m78 passed[90m[22m (213)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m29.84s[K[87C[?2026l[?2026h
[H [31m‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts [2m(20 tests | [31m[22m5 failed[m[2m)[33m[22m 1651[2mms[m[K
   [32m‚úì [mDelivery Tracking Routes[2m > [22mGET /orders/:orderId/delivery-tracking[2m > [22mshould return delivery tracking info for valid order ID [32m273[2mms[m[K
   [32m‚úì [mDelivery Tracking Routes[2m > [22mGET /orders/:orderId/delivery-tracking[2m > [22mshould return tracking info with valid coordinate format [32m52[2mms[m[K
   [32m‚úì [mDelivery Tracking Routes[2m > [22mGET /orders/:orderId/delivery-tracking[2m > [22mshould return estimated arrival as a valid date [32m55[2mms[m[K
   [32m‚úì [mDelivery Tracking Routes[2m > [22mGET /orders/:orderId/delivery-tracking[2m > [22mshould handle different order IDs correctly [32m92[2mms[m[K[31m
   √ó Delivery Tracking Routes[2m > [22mGET /orders/:orderId/delivery-tracking[2m > [22mshould handle server errors gracefully [32m84[2mms[m[K[94C
[31m     ‚Üí expected undefined to be false // Object.is equality[46C[m
   [32m‚úì [mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-location[2m > [22mshould update delivery location
[10;105Hn with valid coordinates [32m133[2mms[m[K[76C
   [32m‚úì [mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-location[2m > [22mshould reject requests without 
[10;105H latitude [32m82[2mms[m[K[92C
   [32m‚úì [mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-location[2m > [22mshould reject requests without 
[10;105H longitude [32m45[2mms[m[K[91C
[31m   √ó Delivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-location[2m > [22mshould reject requests with inv[m
[31m[10;105Hvalid coordinates [32m51[2mms[31m[22m[K[84C[m
[31m     ‚Üí expected 400 "Bad Request", got 200 "OK"[58C[m
[31m   √ó Delivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-location[2m > [22mshould handle extreme but valid[m
[31m[10;105Hd coordinate values [32m99[2mms[31m[22m[K[82C[m
[31m     ‚Üí expected 200 "OK", got 400 "Bad Request"[58C[m
[31m   √ó Delivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-location[2m > [22mshould handle server errors dur[m
[31m[10;105Hring location update [32m71[2mms[31m[22m[K[81C[m
[31m     ‚Üí expected undefined to be false // Object.is equality[46C[m
   [32m‚úì [mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-notifications[2m > [22mshould update notification
[10;105Hn preferences with valid data [32m37[2mms[m[K[72C
   [32m‚úì [mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-notifications[2m > [22mshould handle different pr
[10;105Hreference combinations [32m212[2mms[m[K[78C
   [32m‚úì [mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-notifications[2m > [22mshould reject invalid bool
[10;105Hlean values for notifications [32m52[2mms[m[K[72C
   [32m‚úì [mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-notifications[2m > [22mshould reject invalid thre
[10;105Heshold values [32m41[2mms[m[K[88C
   [32m‚úì [mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-notifications[2m > [22mshould reject missing requ
[10;105Huired fields [32m78[2mms[m[K[89C
[31m   √ó Delivery Tracking Routes[2m > [22mPOST /orders/:orderId/delivery-notifications[2m > [22mshould handle server error[m
[31m[10;105Hrs during preference update [32m54[2mms[31m[22m[K[74C[m
[31m     ‚Üí expected undefined to be false // Object.is equality[46C[m
   [32m‚úì [mDelivery Tracking Routes[2m > [22mRoute Parameter Validation[2m > [22mshould handle special characters in order ID
[10;105HDs [32m85[2mms[m[K[99C
   [32m‚úì [mDelivery Tracking Routes[2m > [22mRoute Parameter Validation[2m > [22mshould handle URL-encoded order IDs [32m20[2mms[m    
   [32m‚úì [mDelivery Tracking Routes[2m > [22mRoute Parameter Validation[2m > [22mshould handle very long order IDs [32m21[2mms[m      
[90mstdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > async OCR processing > should process OCR and upda[m
[90m[2m[10;105Hate order on success[22m[K[86C[m
Received OCR processing request for order: async-test-order[46C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 20/20[22m[K[53C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 18/18[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 1/27[22m[K[53C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 36/36[22m[K[65C
[105C
[2m Test Files [31m[22m[1m8 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m99 failed[m[2m | [32m[22m[1m78 passed[90m[22m (213)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m29.84s[K[87C
[105C[?2026l[?2026h[5;1H[K
[K
[K
[K
[K
[K
[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[H[K[105C[H[K[105C[90m[Hstderr[2m | src/features/ocrRoutes.test.ts > OCR Routes > async OCR processing > should process OCR and update order on success[m
Unexpected error during async OCR processing setup for order: async-test-order TypeError: __vite_ssr_import_1__.ocrService.processImageAndUpdateOrder is not a function
    at processOCRAsync [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrRoutes.ts:183:22[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrRoutes.ts:79:5[90m
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[33m[1m[10;1H ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 20/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 18/18[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 1/27[22m[K[53C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 36/36[22m[K[65C
[105C
[2m Test Files [31m[22m[1m8 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m99 failed[m[2m | [32m[22m[1m78 passed[90m[22m (213)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m29.84s[K[87C
[105C[?2026l[?2026h[K[105C[10;1H[K[105C[8;1H[K
[K[105C[7;1H[K[105C[5;1H[K
[K[105C[H[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > error handling > should handle invalid JSON in request body[m
Received OCR processing request for order: test[33m[1m[6;1H ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 20/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 18/18[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 1/27[33m[22m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m 36/36[22m
[105C
[2m Test Files [31m[22m[1m8 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m99 failed[m[2m | [32m[22m[1m78 passed[90m[22m (213)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m29.84s[K[87C
[105C[?2026l[?2026h[10;1H[K
[K[105C[8;1H[K
[K[105C[6;1H[K
[K[105C[5;1H[K[105C[4;1H[K[105C[2;1H[K
[K[105C[H[K[105C[90m[Hstderr[2m | src/features/ocrRoutes.test.ts > OCR Routes > error handling > should handle invalid JSON in request body[m
Error processing OCR request: TypeError: Cannot read properties of undefined (reading 'doc')
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrRoutes.ts:19:56
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)
    at Route.dispatch (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:119:3)
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)
    at C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\index.js:284:15
    at param (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\index.js:365:14)[K[19C
    at param (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\index.js:376:14)[K[19C
    at Function.process_params (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\index.js:421:3)  
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\index.js:280:10)[K[20C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 20/20[22m[K[53C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 18/18[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 1/27[22m[K[53C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 36/36[22m[K[65C
[105C
[2m Test Files [31m[22m[1m8 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m99 failed[m[2m | [32m[22m[1m78 passed[90m[22m (213)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m29.84s[K[87C
[105C[?2026l[?2026h[9;1H[K
[K
[K[105C[6;1H[K
[K
[K[105C[5;1H[K[105C[4;1H[K[105C[90m[Hstdout[2m | src/features/ocrRoutes.test.ts > OCR Routes > error handling > should handle database connection failures gracefully[m[K
Received OCR processing request for order: test[K[33m[1m[6;1H ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 20/20[33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 18/18[33m[22m[1m
 ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 1/27[33m[22m[1m
 ‚ùØ [msrc/features/smsService.test.ts[2m 36/36[22m
[105C
[2m Test Files [31m[22m[1m8 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m99 failed[m[2m | [32m[22m[1m78 passed[90m[22m (213)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m29.84s[K[87C
[105C[?2026l[?2026h[9;1H[K
[K
[K[105C[7;1H[K
[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[2;1H[K
[K[105C[H[K[105C[90m[Hstderr[2m | src/features/ocrRoutes.test.ts > OCR Routes > error handling > should handle database connection failures gracefully[m
Error processing OCR request: Error: Database unavailable
    at Object.<anonymous> [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrRoutes.test.ts:435:15[90m)[m
    at Object.mockCall (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/spy/dist/index.js:96:15)
    at Object.spy [as collection] (file:///C:/Users/akgte/PharmaRx/node_modules/[4mtinyspy[24m/dist/index.js:47:103)
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrRoutes.ts:19:25
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js:95:5)
    at next (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:149:13)
    at Route.dispatch (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\route.js:119:3)[K[11C
    at Layer.handle [as handle_request] (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\layer.js
[10;105Hs:95:5)[99C
    at C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\index.js:284:15[K[27C
    at param (C:\Users\akgte\PharmaRx\node_modules\[4mexpress[24m\lib\router\index.js:365:14)[K[19C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 20/20[22m[K[53C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 18/18[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 1/27[22m[K[53C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 36/36[22m[K[65C
[105C
[2m Test Files [31m[22m[1m8 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m99 failed[m[2m | [32m[22m[1m78 passed[90m[22m (213)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m29.84s[K[87C[?2026l
[105C[?2026h[K[105C[5;1H[K
[K
[K
[K
[K
[K[105C[3;1H[K
[K[105C[H [31m‚ùØ [msrc/features/ocrRoutes.test.ts [2m(18 tests | [31m[22m1 failed[m[2m)[33m[22m 1354[2mms[m[K
   [33m[2m‚úì[m OCR Routes[2m > [22mPOST /orders/:orderId/process-ocr[2m > [22mshould start OCR processing for valid order  [33m355[2mms[m 
   [32m‚úì [mOCR Routes[2m > [22mPOST /orders/:orderId/process-ocr[2m > [22mshould return 404 for non-existent order [32m49[2mms[m
   [32m‚úì [mOCR Routes[2m > [22mPOST /orders/:orderId/process-ocr[2m > [22mshould return 400 for order without image URL [32m41[2mms[m
   [32m‚úì [mOCR Routes[2m > [22mPOST /orders/:orderId/process-ocr[2m > [22mshould return 409 if OCR already in progress [32m45[2mms[m
   [32m‚úì [mOCR Routes[2m > [22mPOST /orders/:orderId/process-ocr[2m > [22mshould return completed OCR if already processed [32m57[2mms[m
   [32m‚úì [mOCR Routes[2m > [22mPOST /orders/:orderId/process-ocr[2m > [22mshould return 400 for invalid image URL [32m33[2mms[m
   [32m‚úì [mOCR Routes[2m > [22mPOST /orders/:orderId/process-ocr[2m > [22mshould handle database errors [32m39[2mms[m
   [32m‚úì [mOCR Routes[2m > [22mGET /orders/:orderId/ocr-status[2m > [22mshould return OCR status for existing order [32m74[2mms[m
   [32m‚úì [mOCR Routes[2m > [22mGET /orders/:orderId/ocr-status[2m > [22mshould return 404 for non-existent order [32m116[2mms[m
   [32m‚úì [mOCR Routes[2m > [22mGET /orders/:orderId/ocr-status[2m > [22mshould return pending status for orders without OCR d
[10;105Hdata [32m40[2mms[m[K[97C
   [32m‚úì [mOCR Routes[2m > [22mGET /orders/:orderId/ocr-status[2m > [22mshould return failed status with error message [32m44[2mms[m  
   [32m‚úì [mOCR Routes[2m > [22mGET /ocr/health[2m > [22mshould return healthy status when service is operational [32m36[2mms[m        
   [32m‚úì [mOCR Routes[2m > [22mGET /ocr/health[2m > [22mshould return unhealthy status when service is down [32m34[2mms[m[K[13C
   [32m‚úì [mOCR Routes[2m > [22mGET /ocr/health[2m > [22mshould handle health check errors [32m121[2mms[m[K[30C
   [32m‚úì [mOCR Routes[2m > [22masync OCR processing[2m > [22mshould process OCR and update order on success [32m119[2mms[m[K[12C
   [32m‚úì [mOCR Routes[2m > [22merror handling[2m > [22mshould handle malformed request parameters [32m31[2mms[m[K[23C
[31m   √ó OCR Routes[2m > [22merror handling[2m > [22mshould handle invalid JSON in request body [32m49[2mms[m[K[23C
[31m     ‚Üí expected 400 "Bad Request", got 500 "Internal Server Error"[39C[m
   [32m‚úì [mOCR Routes[2m > [22merror handling[2m > [22mshould handle database connection failures gracefully [32m57[2mms[m[K[12C
[105C
[33m[1m ‚ùØ [msrc/features/deliveryTrackingRoutes.test.ts[2m 20/20[22m[K[53C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/ocrRoutes.test.ts[2m 18/18[22m[K[66C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 7/17[22m[K[62C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 1/27[22m[K[53C
[33m[1m ‚ùØ [msrc/features/smsService.test.ts[2m 36/36[22m[K[65C
[105C
[2m Test Files [31m[22m[1m8 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[69C[m
[2m      Tests [31m[22m[1m99 failed[m[2m | [32m[22m[1m78 passed[90m[22m (213)[K[66C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m29.84s[K[87C
[105C[?2026l]0;node (vitest 4)]0;node (vitest 2)]0;node (vitest 6)[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[H[K[105C[90m[Hstderr[2m | src/features/paymentService.test.ts > PaymentService > processPayment > should validate order exists and is in correct state[m
Failed to generate receipt for payment: mock-doc-id TypeError: this.receiptsCollection.where(...).where(...).orderBy is not a function
    at ReceiptService.generateReceiptNumber [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\receiptService.ts:146:8[90m)[m
    at ReceiptService.generateReceipt [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\receiptService.ts:78:38[90m)[m
    at PaymentService.processPayment [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\paymentService.ts:118:34[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\paymentService.test.ts:211:7
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 17/17[22m[K[61C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 27/27[22m[K[52C
[105C
[2m Test Files [31m[22m[1m10 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m128 failed[m[2m | [32m[22m[1m85 passed[90m[22m (213)[K[65C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m32.38s[K[87C[?2026l
[105C[?2026h[10;1H[K
[K[105C[9;1H[K[105C[8;1H[K[105C[6;1H[K
[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C]0;node (vitest 1)[2;1H [31m‚ùØ [msrc/features/paymentService.test.ts [2m(17 tests | [31m[22m7 failed[m[2m)[33m[22m 14273[2mms[m[K
   [33m[2m‚úì[m PaymentService[2m > [22mprocessPayment[2m > [22mshould successfully process a Stripe payment  [33m2168[2mms[m
   [33m[2m‚úì[m PaymentService[2m > [22mprocessPayment[2m > [22mshould successfully process a PayPal payment  [33m1527[2mms[m
   [33m[2m‚úì[m PaymentService[2m > [22mprocessPayment[2m > [22mshould successfully process an MTN Mobile Money payment  [33m3103[2mms[m
   [33m[2m‚úì[m PaymentService[2m > [22mprocessPayment[2m > [22mshould fail Stripe payment with card ending in 0000  [33m2174[2mms[m
   [33m[2m‚úì[m PaymentService[2m > [22mprocessPayment[2m > [22mshould fail MTN payment with phone number containing 0000  [33m3036[2mms[m
   [32m‚úì [mPaymentService[2m > [22mprocessPayment[2m > [22mshould validate required Stripe payment data [32m5[2mms[m
   [32m‚úì [mPaymentService[2m > [22mprocessPayment[2m > [22mshould validate required MTN payment data [32m6[2mms[31m[22m
   √ó PaymentService[2m > [22mprocessPayment[2m > [22mshould validate order exists and is in correct state [33m2135[2mms[31m[22m
     ‚Üí promise resolved "{ paymentId: 'mock-doc-id', ‚Ä¶(3) }" instead of rejecting[m
   [32m‚úì [mPaymentService[2m > [22mprocessPayment[2m > [22mshould validate payment amount [32m6[2mms[m[K[32C
   [32m‚úì [mPaymentService[2m > [22mprocessPayment[2m > [22mshould reject unsupported payment gateway [32m5[2mms[m[K[21C
[31m   √ó PaymentService[2m > [22mgetPayment[2m > [22mshould return payment when it exists [32m15[2mms[m[K[29C
[31m     ‚Üí expected { orderId: 'test-order-1', ‚Ä¶(2) } to deeply equal { paymentId: 'test-payment-1', ‚Ä¶(3) }  [m
[31m   √ó PaymentService[2m > [22mgetPayment[2m > [22mshould return null when payment does not exist [32m7[2mms[m[K[20C
[31m     ‚Üí expected { orderId: 'test-order-1', ‚Ä¶(2) } to be null[45C[m
[31m   √ó PaymentService[2m > [22mgetPaymentsForOrder[2m > [22mshould return payments for an order [32m14[2mms[m[K[21C
[31m     ‚Üí expected [] to deeply equal [ ‚Ä¶(2) ][62C[m
[31m   √ó PaymentService[2m > [22mprocessWebhook[2m > [22mshould process Stripe webhook successfully [32m13[2mms[m[K[19C
[31m     ‚Üí promise rejected "Error: Payment not found for transaction ‚Ä¶" instead of resolving[16C[m
[31m   √ó PaymentService[2m > [22mprocessWebhook[2m > [22mshould process PayPal webhook successfully [32m8[2mms[m[K[20C
[31m     ‚Üí promise rejected "Error: Payment not found for transaction ‚Ä¶" instead of resolving[16C[m
[31m   √ó PaymentService[2m > [22mprocessWebhook[2m > [22mshould process MTN webhook successfully [32m16[2mms[m[K[22C
[31m     ‚Üí promise rejected "Error: Payment not found for transaction ‚Ä¶" instead of resolving[16C[m
   [32m‚úì [mPaymentService[2m > [22mprocessWebhook[2m > [22mshould reject webhook with invalid signature [32m3[2mms[m[K[18C
 [31m‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts [2m(27 tests | [31m[22m23 failed[m[2m)[33m[22m 922[2mms[m[K[29C
[31m   √ó Prescription Order Routes[2m > [22mPOST /orders[2m > [22mshould create prescription order and trigger OCR processi[m
[31m[10;105Hing [32m73[2mms[31m[22m[K[98C[m
[31m     ‚Üí Cannot find module './ocrService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Prescription Order Routes[2m > [22mPOST /orders[2m > [22mshould return 400 for missing patient profile ID [32m6[2mms[m     
[31m     ‚Üí Cannot find module './ocrService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Prescription Order Routes[2m > [22mPOST /orders[2m > [22mshould return 400 for missing image URL [32m5[2mms[m[K[14C
[31m     ‚Üí Cannot find module './ocrService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Prescription Order Routes[2m > [22mPOST /orders[2m > [22mshould return 400 for invalid image URL [32m14[2mms[m[K[13C
[31m     ‚Üí Cannot find module './ocrService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Prescription Order Routes[2m > [22mPOST /orders[2m > [22mshould handle database errors during order creation [32m5[2mms[m  
[31m     ‚Üí Cannot find module './ocrService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Prescription Order Routes[2m > [22mGET /orders[2m > [22mshould return orders for valid patient [32m10[2mms[m[K[15C
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
   [32m‚úì [mPrescription Order Routes[2m > [22mGET /orders[2m > [22mshould return 400 for missing patient ID [32m208[2mms[m[K[12C
[31m   √ó Prescription Order Routes[2m > [22mGET /orders[2m > [22mshould return empty array for patient with no orders [32m7[2mms[m  
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Prescription Order Routes[2m > [22mGET /orders/:orderId[2m > [22mshould return specific order by ID [32m9[2mms[m[K[11C
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Prescription Order Routes[2m > [22mGET /orders/:orderId[2m > [22mshould return 404 for non-existent order [32m6[2mms[m     
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Prescription Order Routes[2m > [22mPUT /orders/:orderId/status[2m > [22mshould update order status successfully [32m6[2mm[m
[32m[2m[10;105Hms[22m[K[104C[m
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
   [32m‚úì [mPrescription Order Routes[2m > [22mPUT /orders/:orderId/status[2m > [22mshould return 400 for invalid status [32m156[2mms[m
   [32m‚úì [mPrescription Order Routes[2m > [22mPUT /orders/:orderId/status[2m > [22mshould return 400 for missing status [32m62[2mms[m 
[31m   √ó Prescription Order Routes[2m > [22mPUT /orders/:orderId/manual-text[2m > [22mshould accept manual text entry when [m
[31m[10;105H OCR failed [32m18[2mms[31m[22m[K[90C[m
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Prescription Order Routes[2m > [22mPUT /orders/:orderId/manual-text[2m > [22mshould accept manual text entry when [m
[31m[10;105H OCR pending [32m19[2mms[31m[22m[K[89C[m
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Prescription Order Routes[2m > [22mPUT /orders/:orderId/manual-text[2m > [22mshould return 409 if OCR already comp[m
[31m[10;105Hpleted [32m40[2mms[31m[22m[K[95C[m
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
   [32m‚úì [mPrescription Order Routes[2m > [22mPUT /orders/:orderId/manual-text[2m > [22mshould return 400 for empty text [32m70[2mms[m
[31m   √ó Prescription Order Routes[2m > [22mPUT /orders/:orderId/manual-text[2m > [22mshould return 404 for non-existent or[m
[31m[10;105Hrder [32m5[2mms[31m[22m[K[98C[m
[105C[31m     ‚Üí Cannot find module './database'[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Prescription Order Routes[2m > [22mOCR processing integration[2m > [22mshould validate image before processing [32m10[2mm[m
[32m[2m[10;105Hms[22m[K[104C[m
[31m     ‚Üí Cannot find module './ocrService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Order History Endpoints[2m > [22mGET /orders/history[2m > [22mshould return order history with pagination [32m8[2mms[m     
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Order History Endpoints[2m > [22mGET /orders/history[2m > [22mshould return 400 if patientId is missing [32m108[2mms[m     
[31m     ‚Üí expected 404 to be 400 // Object.is equality[54C[m
[31m   √ó Order History Endpoints[2m > [22mGET /orders/history[2m > [22mshould handle pagination correctly [32m7[2mms[m[K[14C
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Order History Endpoints[2m > [22mReceipt Download Endpoints[2m > [22mshould download receipt for delivered order [32m9[m
[32m[10;105H9[2mms[22m[K[103C[m
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Order History Endpoints[2m > [22mReceipt Download Endpoints[2m > [22mshould return 404 if order not found [32m5[2mms[m     
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Order History Endpoints[2m > [22mReceipt Download Endpoints[2m > [22mshould return 403 if order does not belong to[m
[31m[10;105Ho patient [32m5[2mms[31m[22m[K[93C[m
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Order History Endpoints[2m > [22mReceipt Download Endpoints[2m > [22mshould return 400 if order is not delivered [32m5[m
[32m[10;105H5[2mms[22m[K[103C[m
[31m     ‚Üí Cannot find module './database'[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[31m   √ó Order History Endpoints[2m > [22mReceipt Download Endpoints[2m > [22mshould return 400 if patientId is missing [32m31[2mm[m
[32m[2m[10;105Hms[22m[K[104C[m
[31m     ‚Üí expected 404 to be 400 // Object.is equality[54C[m
[105C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/paymentService.test.ts[2m 17/17[22m[K[61C
[33m[1m ‚ùØ [msrc/features/prescriptionOrderRoutes.test.ts[2m 27/27[22m[K[52C
[105C
[2m Test Files [31m[22m[1m10 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m128 failed[m[2m | [32m[22m[1m85 passed[90m[22m (213)[K[65C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m32.38s[K[87C
[105C[?2026l[?2026h[3;1H[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[2;1Hstdout[2m | src/features/notificationRoutes.test.ts[m[K
Using Google Cloud Application Default Credentials
Firebase initialized successfully[33m[1m[7;1H ‚ùØ [msrc/features/notificationRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/whatsappService.test.ts[2m [queued][10;1H Test Files [31m[22m[1m10 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m128 failed[m[2m | [32m[22m[1m85 passed[90m[22m (213)[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m33.57s[K[87C[?2026l
[105C]0;node (vitest 3)[?2026h[3;1H[K[33m[1m
 ‚ùØ [msrc/features/database.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m 0/15[22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/whatsappService.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m10 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m128 failed[m[2m | [32m[22m[1m85 passed[90m[22m (228)[K[m[2m
   Start at [22m00:00:15[K[85C
[2m   Duration [22m33.77s[K[87C[?2026l
[105C[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[5;1H[K
[K
[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[?2026l[H[K[33m[1m
 ‚ùØ [msrc/features/database.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m 1/15[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/whatsappService.test.ts[2m [queued][7;1H Test Files [31m[22m[1m10 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m129 failed[m[2m | [32m[22m[1m85 passed[90m[22m (228)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m34.17s[?2026h
[K[105C[10;1H[K[105C[9;1H[K[105C[7;1H[K
[K[105C[5;1H[K
[K[105C[2;1H[K
[K
[K[105C[?2026l[H[K[33m[1m
 ‚ùØ [msrc/features/database.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m 5/15[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/whatsappService.test.ts[2m [queued][7;1H Test Files [31m[22m[1m10 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m132 failed[m[2m | [32m[22m[1m86 passed[90m[22m (228)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m34.50s[?2026h[90m[Hstdout[2m | src/features/whatsappService.test.ts > WhatsAppService > sendMessage > should send a WhatsApp message successfully[m[K
WhatsApp message sent successfully: {[K
  messaging_product: [32m'whatsapp'[m,[K
  contacts: [ { wa_id: [32m'22912345678' [m} ],[K
  messages: [ { id: [32m'msg_123' [m} ][K
}[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/database.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m 9/15[22m[K[58C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[41C
[33m[1m ‚ùØ [msrc/features/whatsappService.test.ts[2m 1/26[22m[K[61C
[105C
[2m Test Files [31m[22m[1m10 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m134 failed[m[2m | [32m[22m[1m89 passed[90m[22m (254)[K[65C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m34.74s[K[87C[?2026l[?2026h
[105C[8;1H[K
[K
[K[105C[90m[Hstderr[2m | src/features/whatsappService.test.ts > WhatsAppService > sendMessage > should handle network errors[m[K
Error sending WhatsApp message: Error: Network timeout[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\whatsappService.test.ts:100:35[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/database.test.ts[2m [queued][22m[K[64C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m 9/15[22m[K[58C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[41C
[33m[1m ‚ùØ [msrc/features/whatsappService.test.ts[2m 1/26[22m[K[61C
[105C
[2m Test Files [31m[22m[1m10 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m134 failed[m[2m | [32m[22m[1m89 passed[90m[22m (254)[K[65C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m34.74s[K[87C[?2026l
[105C[?2026h[90m[Hstdout[2m | src/features/whatsappService.test.ts > WhatsAppService > sendMessage > should clean phone numbers correctly[m[K
WhatsApp message sent successfully: {[K
  messaging_product: [32m'whatsapp'[m,[K
  contacts: [ { wa_id: [32m'22912345678' [m} ],[K
  messages: [ { id: [32m'msg_123' [m} ][K
}[K
[K[90m
stdout[2m | src/features/whatsappService.test.ts > WhatsAppService > sendMessage > should clean phone numbers correctly[m[K
WhatsApp message sent successfully: {[K[68C
  messaging_product: [32m'whatsapp'[m,[K[73C
  contacts: [ { wa_id: [32m'22912345678' [m} ],[K[64C
  messages: [ { id: [32m'msg_123' [m} ][K[72C
}[104C
[105C
[90mstdout[2m | src/features/whatsappService.test.ts > WhatsAppService > sendMessage > should clean phone number[m
[90m[2m[10;105Hrs correctly[22m[K[94C[m
WhatsApp message sent successfully: {[68C
  messaging_product: [32m'whatsapp'[m,[K[73C
  contacts: [ { wa_id: [32m'22912345678' [m} ],[K[64C
  messages: [ { id: [32m'msg_123' [m} ][K[72C
}[104C
[105C
[90mstdout[2m | src/features/whatsappService.test.ts > WhatsAppService > sendMessage > should clean phone number[m
[90m[2m[10;105Hrs correctly[22m[K[94C[m
WhatsApp message sent successfully: {[68C
  messaging_product: [32m'whatsapp'[m,[K[73C
  contacts: [ { wa_id: [32m'22912345678' [m} ],[K[64C
  messages: [ { id: [32m'msg_123' [m} ][K[72C
}[104C
[105C
[90mstdout[2m | src/features/whatsappService.test.ts > WhatsAppService > sendMessage > should validate phone num[m
[90m[2m[10;105Hmbers[22m[K[101C[m
WhatsApp message sent successfully: {[68C
  messaging_product: [32m'whatsapp'[m,[K[73C
  contacts: [ { wa_id: [32m'22912345678' [m} ],[K[64C
  messages: [ { id: [32m'msg_123' [m} ][K[72C
}[104C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/database.test.ts[2m [queued][22m[K[64C
[33m[1m ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][22m[K[57C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m 13/15[22m[K[57C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[41C
[33m[1m ‚ùØ [msrc/features/whatsappService.test.ts[2m 5/26[22m[K[61C
[105C
[2m Test Files [31m[22m[1m10 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m137 failed[m[2m | [32m[22m[1m94 passed[90m[22m (254)[K[65C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m34.95s[K[87C[?2026l[?2026h
[10;1H                                                                                                         
[105C[90m[Hstderr[2m | src/features/whatsappService.test.ts > WhatsAppService > sendMessage > should handle rate limiting errors[m[K
WhatsApp API error: {[K
  error: { message: [32m'Rate limit exceeded'[m, type: [32m'OAuthException'[m, code: [33m4 [m}[K
}[K
[K[90m
stderr[2m | src/features/whatsappService.test.ts > WhatsAppService > sendTemplateMessage > should send a template message successfully[m[K
Error sending WhatsApp template message: TypeError: parameters.map is not a function[K
    at WhatsAppService.sendTemplateMessage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\whatsappService.ts:153:38[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\whatsappService.test.ts:195:44[K[22C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/whatsappService.test.ts > WhatsAppService > sendTemplateMessage > should handle tem[m
[90m[2m[10;105Hmplate not found errors[22m[K[83C[m
Error sending WhatsApp template message: TypeError: parameters.map is not a function[21C
    at WhatsAppService.sendTemplateMessage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\whatsappService
[10;105He.ts:153:38[90m)[K[94C[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\whatsappService.test.ts:230:44[K[22C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/database.test.ts[2m [queued][22m[K[64C
[33m[1m ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][22m[K[57C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m 13/15[22m[K[57C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[41C
[33m[1m ‚ùØ [msrc/features/whatsappService.test.ts[2m 5/26[22m[K[61C
[105C
[2m Test Files [31m[22m[1m10 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m137 failed[m[2m | [32m[22m[1m94 passed[90m[22m (254)[K[65C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m34.95s[K[87C[?2026l
[105C[?2026h[H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/whatsappService.test.ts > WhatsAppService > isConfigured > should return false when access token is missing[m
WhatsApp API credentials not configured. WhatsApp messaging will not work.[90m[5;1Hstderr[2m | src/features/whatsappService.test.ts > WhatsAppService > isConfigured > should return false when phone number ID is missing[m
WhatsApp API credentials not configured. WhatsApp messaging will not work.[33m[1m[10;1H ‚ùØ [msrc/features/database.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m 15/15[22m[K[57C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[41C
[33m[1m ‚ùØ [msrc/features/whatsappService.test.ts[2m 15/26[22m[K[60C
[105C
[2m Test Files [31m[22m[1m11 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m142 failed[m[2m | [32m[22m[1m101 passed[90m[22m (254)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m35.06s[K[87C[?2026l[?2026h
[H [31m‚ùØ [msrc/features/notificationRoutes.test.ts [2m(15 tests | [31m[22m9 failed[m[2m)[33m[22m 955[2mms[m[K[31m
   √ó Notification Routes[2m > [22mGET /api/notifications/preferences/:patientProfileId[2m > [22mshould return notification preferences for a patient profile [32m92[2mms[m[K[31m
     ‚Üí Value for argument "collectionPath" is not a valid resource path. Path must be a non-empty string.
   √ó Notification Routes[2m > [22mGET /api/notifications/preferences/:patientProfileId[2m > [22mshould return default preferences when none exist [32m8[2mms[m[K[31m
     ‚Üí Value for argument "collectionPath" is not a valid resource path. Path must be a non-empty string.
   √ó Notification Routes[2m > [22mGET /api/notifications/preferences/:patientProfileId[2m > [22mshould return 404 when patient profile not found [32m19[2mms[m[K[31m
     ‚Üí Value for argument "collectionPath" is not a valid resource path. Path must be a non-empty string.
   √ó Notification Routes[2m > [22mPUT /api/notifications/preferences/:patientProfileId[2m > [22mshould update notificat[m
[31m[10;105Htion preferences successfully [32m13[2mms[31m[22m[K[72C[m
[31m     ‚Üí Value for argument "collectionPath" is not a valid resource path. Path must be a non-empty string.[m
   [33m[2m‚úì[m Notification Routes[2m > [22mPUT /api/notifications/preferences/:patientProfileId[2m > [22mshould validate SMS pho
[10;105Hone number when SMS is enabled  [33m329[2mms[m[K[69C
   [32m‚úì [mNotification Routes[2m > [22mPUT /api/notifications/preferences/:patientProfileId[2m > [22mshould validate email a
[10;105Haddress when email is enabled [32m36[2mms[m[K[72C
[31m   √ó Notification Routes[2m > [22mPUT /api/notifications/preferences/:patientProfileId[2m > [22mshould handle service e[m
[31m[10;105Herrors [32m7[2mms[31m[22m[K[96C[m
[31m     ‚Üí Value for argument "collectionPath" is not a valid resource path. Path must be a non-empty string.[m
[31m   √ó Notification Routes[2m > [22mGET /api/notifications/history/:patientProfileId[2m > [22mshould return notification [m
[31m[10;105H history [32m85[2mms[31m[22m[K[93C[m
[31m     ‚Üí expected undefined to deeply equal [ { notificationId: 'notif-1', ‚Ä¶(5) } ][24C[m
   [32m‚úì [mNotification Routes[2m > [22mGET /api/notifications/history/:patientProfileId[2m > [22mshould validate limit param
[10;105Hmeter [32m39[2mms[m[K[96C
[31m   √ó Notification Routes[2m > [22mGET /api/notifications/history/:patientProfileId[2m > [22mshould use default limit wh[m
[31m[10;105Hhen not provided [32m69[2mms[31m[22m[K[85C[m
[31m     ‚Üí expected "spy" to be called with arguments: [ 'patient-123', 50 ][33C[m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[31m   √ó Notification Routes[2m > [22mPOST /api/notifications/:notificationId/status[2m > [22mshould update notification st[m
[31m[10;105Htatus successfully [32m49[2mms[31m[22m[K[83C[m
[31m     ‚Üí expected 200 "OK", got 500 "Internal Server Error"[48C[m
   [32m‚úì [mNotification Routes[2m > [22mPOST /api/notifications/:notificationId/status[2m > [22mshould validate status parame
[10;105Heter [32m47[2mms[m[K[97C
   [32m‚úì [mNotification Routes[2m > [22mPOST /api/notifications/:notificationId/status[2m > [22mshould handle missing status 
[10;105H parameter [32m43[2mms[m[K[91C
   [32m‚úì [mNotification Routes[2m > [22mPOST /api/notifications/:notificationId/status[2m > [22mshould handle service errors 
[32m[10;105H 60[2mms[22m[K[101C[m
[31m   √ó Notification Routes[2m > [22mPOST /api/notifications/:notificationId/status[2m > [22mshould include error message [m
[31m[10;105H when provided [32m46[2mms[31m[22m[K[87C[m
[31m     ‚Üí expected 200 "OK", got 500 "Internal Server Error"[48C[m
[105C
[33m[1m ‚ùØ [msrc/features/database.test.ts[2m [queued][22m[K[64C
[33m[1m ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][22m[K[57C
[33m[1m ‚ùØ [msrc/features/notificationRoutes.test.ts[2m 15/15[22m[K[57C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[41C
[33m[1m ‚ùØ [msrc/features/whatsappService.test.ts[2m 15/26[22m[K[60C
[105C
[2m Test Files [31m[22m[1m11 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m142 failed[m[2m | [32m[22m[1m101 passed[90m[22m (254)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m35.06s[K[87C[?2026l
[105C[?2026h[K[105C[9;1H[K
[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[90m[Hstderr[2m | src/features/whatsappService.test.ts > WhatsAppService > Service Initialization > should handle missing environment variables gracefully[m[K
WhatsApp API credentials not configured. WhatsApp messaging will not work.[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/database.test.ts[2m 0/17[33m[22m[1m
 ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/notificationRoutes.test.ts[2m 15/15[33m[22m[1m
 ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/whatsappService.test.ts[2m 22/26[22m

[2m Test Files [31m[22m[1m11 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m145 failed[m[2m | [32m[22m[1m105 passed[90m[22m (271)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m35.30s[K[87C[?2026l
[105C[?2026h[H [31m‚ùØ [msrc/features/whatsappService.test.ts [2m(26 tests | [31m[22m10 failed[m[2m)[33m[22m 521[2mms[m[K
   [32m‚úì [mWhatsAppService[2m > [22msendMessage[2m > [22mshould send a WhatsApp message successfully [32m51[2mms[m[K
   [32m‚úì [mWhatsAppService[2m > [22msendMessage[2m > [22mshould handle API errors gracefully [32m5[2mms[m[K
   [32m‚úì [mWhatsAppService[2m > [22msendMessage[2m > [22mshould handle network errors [32m93[2mms[m[K
   [32m‚úì [mWhatsAppService[2m > [22msendMessage[2m > [22mshould clean phone numbers correctly [32m23[2mms[m[K[31m
   √ó WhatsAppService[2m > [22msendMessage[2m > [22mshould validate phone numbers [32m64[2mms[m[K[31m
     ‚Üí expected true to be false // Object.is equality[K[m
   [32m‚úì [mWhatsAppService[2m > [22msendMessage[2m > [22mshould handle empty message text [32m6[2mms[m[K
   [32m‚úì [mWhatsAppService[2m > [22msendMessage[2m > [22mshould handle rate limiting errors [32m13[2mms[m[K[31m
   √ó WhatsAppService[2m > [22msendTemplateMessage[2m > [22mshould send a template message successfully [32m33[2mms[m[K[31m
     ‚Üí expected false to be true // Object.is equality[K[51C[m
[31m   √ó WhatsAppService[2m > [22msendTemplateMessage[2m > [22mshould handle template not found errors [32m24[2mms[m[K[16C
[31m     ‚Üí expected 'Network error while sending WhatsApp ‚Ä¶' to be 'Template not found' // Object.is equality[m
   [32m‚úì [mWhatsAppService[2m > [22msendTemplateMessage[2m > [22mshould validate template parameters [32m2[2mms[m[K[21C
   [32m‚úì [mWhatsAppService[2m > [22misConfigured[2m > [22mshould return true when all required config is present [32m2[2mms[m[K[9C
   [32m‚úì [mWhatsAppService[2m > [22misConfigured[2m > [22mshould return false when access token is missing [32m3[2mms[m[K[15C
   [32m‚úì [mWhatsAppService[2m > [22misConfigured[2m > [22mshould return false when phone number ID is missing [32m3[2mms[m[K[12C
[31m   √ó WhatsAppService[2m > [22misConfigured[2m > [22mshould return false when business account ID is missing [32m6[2mms[m        
[31m     ‚Üí expected true to be false // Object.is equality[51C[m
[31m   √ó WhatsAppService[2m > [22mgetBusinessProfile[2m > [22mshould retrieve business profile successfully [32m25[2mms[m[K[11C
[31m     ‚Üí expected { id: 'test-phone-id', ‚Ä¶(4) } to deeply equal { id: 'test-business-id', ‚Ä¶(4) }[11C[m
   [32m‚úì [mWhatsAppService[2m > [22mgetBusinessProfile[2m > [22mshould handle business profile errors [32m4[2mms[m[K[20C
[31m   √ó WhatsAppService[2m > [22mformatPaymentMessage[2m > [22mshould format payment message correctly [32m22[2mms[m[K[15C
[31m     ‚Üí expected 'üíä *PharmaRx Payment Request*\n\nSome‚Ä¶' to contain 'Medication: *Amoxicillin 500mg*'    [m
   [32m‚úì [mWhatsAppService[2m > [22mformatPaymentMessage[2m > [22mshould handle long medication names [32m2[2mms[m[K[20C
[31m   √ó WhatsAppService[2m > [22mformatPaymentMessage[2m > [22mshould format currency correctly [32m9[2mms[m[K[23C
[31m     ‚Üí expected 'üíä *PharmaRx Payment Request*\n\nSome‚Ä¶' to contain 'Amount: *$45.5*'[20C[m
   [32m‚úì [mWhatsAppService[2m > [22mPhone Number Validation and Cleaning[2m > [22mshould accept valid international phone num
[10;105Hmbers [32m9[2mms[m[K[97C
[31m   √ó WhatsAppService[2m > [22mPhone Number Validation and Cleaning[2m > [22mshould reject invalid phone number formats [m
[32m[10;105H 49[2mms[22m[K[101C[m
[31m     ‚Üí expected true to be false // Object.is equality[51C[m
   [32m‚úì [mWhatsAppService[2m > [22mPhone Number Validation and Cleaning[2m > [22mshould handle West African country codes co
[10;105Horrectly [32m7[2mms[m[K[94C
[31m   √ó WhatsAppService[2m > [22mError Message Parsing[2m > [22mshould parse standard WhatsApp API errors [32m15[2mms[m[K[12C
[31m     ‚Üí expected 'WhatsApp API error (N/A)' to be 'User-friendly error message' // Object.is equality     [m
[31m   √ó WhatsAppService[2m > [22mError Message Parsing[2m > [22mshould handle malformed error responses [32m12[2mms[m[K[14C
[31m     ‚Üí expected 'WhatsApp API error (N/A)' to be 'Unknown WhatsApp API error' // Object.is equality      [m
   [32m‚úì [mWhatsAppService[2m > [22mService Initialization[2m > [22mshould initialize with proper configuration [32m2[2mms[m[K[10C
   [32m‚úì [mWhatsAppService[2m > [22mService Initialization[2m > [22mshould handle missing environment variables gracefully [32m18[m
[32m[10;105H8[2mms[22m[K[103C[m
[90mstdout[2m | src/features/database.test.ts > DatabaseService > getDb > should initialize Firebase and return [m
[90m[2m[10;105H Firestore instance[22m[K[87C[m
üîß Initializing Firebase Admin for test environment[54C
üìã Project ID: pharmarx-dev[78C
üß™ Using minimal configuration for Firebase emulators[52C
‚úÖ Firebase Admin initialized successfully[63C
[105C
[90mstdout[2m | src/features/database.test.ts > DatabaseService > getDb > should not reinitialize if already ini[m
[90m[2m[10;105Hitialized[22m[K[97C[m
üîß Initializing Firebase Admin for test environment[54C
üìã Project ID: pharmarx-dev[78C
üß™ Using minimal configuration for Firebase emulators[52C
‚úÖ Firebase Admin initialized successfully[63C
[105C
[90mstdout[2m | src/features/database.test.ts > DatabaseService > getDb > should initialize with development set[m
[90m[2m[10;105Httings[22m[K[100C[m
üîß Initializing Firebase Admin for development environment[47C
üìã Project ID: test-project-dev[74C
üß™ Using minimal configuration for Firebase emulators[52C
‚úÖ Firebase Admin initialized successfully[63C
[105C
[90mstdout[2m | src/features/database.test.ts > DatabaseService > getDb > should initialize with test settings[m  
üîß Initializing Firebase Admin for test environment[54C
üìã Project ID: test-project[78C
üß™ Using minimal configuration for Firebase emulators[52C
‚úÖ Firebase Admin initialized successfully[63C
[105C
[90mstdout[2m | src/features/database.test.ts > DatabaseService > getDb > should use default project ID if not s[m
[90m[2m[10;105Hspecified in development[22m[K[82C[m
üîß Initializing Firebase Admin for development environment[47C
üìã Project ID: pharmarx-dev[78C
üß™ Using minimal configuration for Firebase emulators[52C
‚úÖ Firebase Admin initialized successfully[63C
[105C
[90mstdout[2m | src/features/database.test.ts > DatabaseService > getDb > should initialize with production sett[m
[90m[2m[10;105Htings[22m[K[101C[m
üöÄ Initializing Firebase Admin for production[60C
üîê Using service account credentials[69C
‚úÖ Firebase Admin initialized successfully[63C
[105C
[90mstdout[2m | src/features/database.test.ts > DatabaseService > getDb > should use application default credent[m
[90m[2m[10;105Htials in production if no service account key[22m[K[61C[m
üöÄ Initializing Firebase Admin for production[60C
üîê Using application default credentials[65C
‚úÖ Firebase Admin initialized successfully[63C
[105C
[90mstdout[2m | src/features/database.test.ts > DatabaseService > healthCheck > should return healthy status whe[m
[90m[2m[10;105Hen database is accessible[22m[K[81C[m
üöÄ Initializing Firebase Admin for production[60C
üîê Using application default credentials[65C
‚úÖ Firebase Admin initialized successfully[63C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/database.test.ts[2m 7/17[22m[K[68C
[33m[1m ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][22m[K[57C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[41C
[33m[1m ‚ùØ [msrc/features/whatsappService.test.ts[2m 26/26[22m[K[60C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m12 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m149 failed[m[2m | [32m[22m[1m112 passed[90m[22m (271)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m35.55s[K[87C[?2026l[?2026h
[90m[Hstderr[2m | src/features/database.test.ts > DatabaseService > healthCheck > should return healthy status when database is accessible[m[K
Database health check failed: TypeError: db.collection(...).doc is not a function[K
    at DatabaseService.healthCheck [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.ts:133:48[90m)    [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.test.ts:213:44[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)[K
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)[K[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/database.test.ts[2m 7/17[22m[K[68C
[33m[1m ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][22m[K[57C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[41C
[33m[1m ‚ùØ [msrc/features/whatsappService.test.ts[2m 26/26[22m[K[60C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m12 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m149 failed[m[2m | [32m[22m[1m112 passed[90m[22m (271)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m35.55s[K[87C[?2026l[?2026h
[105C[90m[Hstdout[2m | src/features/database.test.ts > DatabaseService > healthCheck > should return unhealthy status when database is not accessible[m[K
üöÄ Initializing Firebase Admin for production[K
üîê Using application default credentials[K
‚úÖ Firebase Admin initialized successfully[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/database.test.ts[2m 7/17[22m[K[33m[1m
 ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/whatsappService.test.ts[2m 26/26[22m
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m12 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m149 failed[m[2m | [32m[22m[1m112 passed[90m[22m (271)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m35.55s[K[87C[?2026l
[105C[?2026h[90m[Hstderr[2m | src/features/database.test.ts > DatabaseService > healthCheck > should return unhealthy status when database is not accessible[m[K
Database health check failed: TypeError: db.collection(...).doc is not a function[K
    at DatabaseService.healthCheck [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.ts:133:48[90m)    [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.test.ts:234:44[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)[K
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)[K[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/database.test.ts[2m 7/17[22m[K[68C
[33m[1m ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][22m[K[57C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[41C
[33m[1m ‚ùØ [msrc/features/whatsappService.test.ts[2m 26/26[22m[K[60C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m12 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m149 failed[m[2m | [32m[22m[1m112 passed[90m[22m (271)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m35.55s[K[87C[?2026l
[105C[?2026h[K[105C[10;1H[K[105C[90m[Hstderr[2m | src/features/database.test.ts > DatabaseService > healthCheck > should handle database initialization errors[m[K
Database health check failed: Error: Database initialization failed[K
    at DatabaseService.<anonymous> [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.test.ts:245:15[90m)[K[m
    at DatabaseService.mockCall (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/spy/dist/index.js:96:15)[K
    at DatabaseService.getDb (file:///C:/Users/akgte/PharmaRx/node_modules/[4mtinyspy[24m/dist/index.js:47:103) 
    at DatabaseService.healthCheck [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.ts:132:23[90m)    [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.test.ts:248:44
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/database.test.ts[2m 17/17[22m[K[67C
[33m[1m ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][22m[K[57C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[41C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m13 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m156 failed[m[2m | [32m[22m[1m115 passed[90m[22m (271)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m36.42s[K[87C
[105C[?2026l[?2026h[K[105C[8;1H[K
[K
[K[105C[6;1H[K
[K[105C[4;1H[K
[K[105C[2;1H[K
[K[105C[H[K[105C[H [31m‚ùØ [msrc/features/database.test.ts [2m(17 tests | [31m[22m9 failed[m[2m)[33m[22m 439[2mms[m
   [32m‚úì [mDatabaseService[2m > [22mgetInstance[2m > [22mshould return singleton instance [32m16[2mms[m
   [32m‚úì [mDatabaseService[2m > [22mgetDb[2m > [22mshould initialize Firebase and return Firestore instance [32m17[2mms[31m[22m
   √ó DatabaseService[2m > [22mgetDb[2m > [22mshould not reinitialize if already initialized [32m63[2mms[31m[22m
     ‚Üí expected "spy" to be called at least once[m
   [32m‚úì [mDatabaseService[2m > [22mgetDb[2m > [22mshould initialize with development settings [32m39[2mms[m
   [32m‚úì [mDatabaseService[2m > [22mgetDb[2m > [22mshould initialize with test settings [32m16[2mms[m
   [32m‚úì [mDatabaseService[2m > [22mgetDb[2m > [22mshould use default project ID if not specified in development [32m37[2mms[31m[22m
   √ó DatabaseService[2m > [22mgetDb[2m > [22mshould initialize with production settings [32m70[2mms[31m[22m
     ‚Üí expected "spy" to be called with arguments: [ { credential: Anything, ‚Ä¶(1) } ][m

[90mReceived:[96C[m
[90m[105C[m
[90m[1m  1st spy call:[22m[K[90C[m
[90m[105C[m
[90m[2m  [[22m[K[102C[m
[90m[2m    {[22m[K[100C[m
[32m-     "credential": Anything,[76C[m
[31m+     "credential": undefined,[75C[m
[90m[2m      "projectId": "pharmarx-prod",[22m[K[70C[m
[90m[2m    },[22m[K[99C[m
[90m[2m  ][22m[K[102C[m
[90m[105C[m
[90m[105C[m
[90mNumber of calls: [1m1[22m[K[87C[m
[90m[105C[m
[31m   √ó DatabaseService[2m > [22mgetDb[2m > [22mshould use application default credentials in production if no service acc[m
[31m[10;105Hcount key [32m15[2mms[31m[22m[K[92C[m
[31m     ‚Üí expected "spy" to be called with arguments: [ { credential: Anything, ‚Ä¶(1) } ][20C[m
[90m[105C[m
[90mReceived:[96C[m
[90m[105C[m
[90m[1m  1st spy call:[22m[K[90C[m
[90m[105C[m
[90m[2m  [[22m[K[102C[m
[90m[2m    {[22m[K[100C[m
[32m-     "credential": Anything,[76C[m
[31m+     "credential": undefined,[75C[m
[90m[2m      "projectId": "pharmarx-prod",[22m[K[70C[m
[90m[2m    },[22m[K[99C[m
[90m[2m  ][22m[K[102C[m
[90m[105C[m
[90m[105C[m
[90mNumber of calls: [1m1[22m[K[87C[m
[90m[105C[m
[31m   √ó DatabaseService[2m > [22mhealthCheck[2m > [22mshould return healthy status when database is accessible [32m64[2mms[m       
[31m     ‚Üí expected { status: 'unhealthy', ‚Ä¶(2) } to deeply equal { status: 'healthy', connected: true }     [m
[31m   √ó DatabaseService[2m > [22mhealthCheck[2m > [22mshould return unhealthy status when database is not accessible [32m15[2mms[m 
[31m     ‚Üí expected { status: 'unhealthy', ‚Ä¶(2) } to deeply equal { status: 'unhealthy', ‚Ä¶(1) }[14C[m
[31m   √ó DatabaseService[2m > [22mhealthCheck[2m > [22mshould handle database initialization errors [32m22[2mms[m[K[19C
[31m     ‚Üí expected { status: 'unhealthy', ‚Ä¶(2) } to deeply equal { status: 'unhealthy', ‚Ä¶(1) }[14C[m
[31m   √ó DatabaseService[2m > [22mclose[2m > [22mshould close all Firebase apps [32m8[2mms[m[K[40C
[31m     ‚Üí expected "spy" to be called at least once[57C[m
[31m   √ó DatabaseService[2m > [22mclose[2m > [22mshould handle apps array with null values [32m4[2mms[m[K[29C
[31m     ‚Üí expected "spy" to be called at least once[57C[m
   [32m‚úì [mDatabaseService[2m > [22mclose[2m > [22mshould handle empty apps array [32m13[2mms[m[K[39C
   [32m‚úì [mDatabaseService[2m > [22mclose[2m > [22mshould handle app deletion errors gracefully [32m3[2mms[m[K[26C
   [32m‚úì [mDatabaseService[2m > [22merror handling[2m > [22mshould handle malformed service account key [32m10[2mms[m[K[17C
[31m   √ó DatabaseService[2m > [22msingleton behavior[2m > [22mshould maintain singleton pattern across multiple requires [32m5[2mm[m
[32m[2m[10;105Hms[22m[K[104C[m
[31m     ‚Üí Database initialization failed[68C[m
[105C
[33m[1m ‚ùØ [msrc/features/database.test.ts[2m 17/17[22m[K[67C
[33m[1m ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][22m[K[57C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[41C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m13 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m156 failed[m[2m | [32m[22m[1m115 passed[90m[22m (271)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m36.42s[K[87C[?2026l
[105C]0;node (vitest 5)[?2026h[K[105C[10;1H[K[105C[8;1H[K
[K[105C[6;1H[K
[K[105C[5;1H[K[105C[4;1H[K]0;node (vitest 4)[105C[2;1H[K
[K[105C[H[K[105C[?2026l[33m[1m[3;1H ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][7;1H Test Files [31m[22m[1m13 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m156 failed[m[2m | [32m[22m[1m115 passed[90m[22m (271)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m37.53s]0;node (vitest 2)[?2026h[H[K
[K[33m[1m
 ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m 0/18[22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m13 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m156 failed[m[2m | [32m[22m[1m115 passed[90m[22m (289)[K[m[2m
   Start at [22m00:00:15[K[2m
   Duration [22m38.31s[K
[K[105C[?2026l[?2026h[?2026l[H[K
[K[33m[1m
 ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m 0/18[22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m13 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m156 failed[m[2m | [32m[22m[1m115 passed[90m[22m (289)[K[m[2m
   Start at [22m00:00:15[K[2m
   Duration [22m38.43s[K
[K[105C[?2026h[?2026l[H[K
[K[33m[1m
 ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m 10/18[22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m13 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m166 failed[m[2m | [32m[22m[1m115 passed[90m[22m (289)[K[m[2m
   Start at [22m00:00:15[K[2m
   Duration [22m38.65s[K
[K[105C[?2026h[H [31m‚ùØ [msrc/features/inventoryRoutes.test.ts [2m(18 tests | [31m[22m18 failed[m[2m)[33m[22m 308[2mms[m[K[31m
   √ó Inventory Routes[2m > [22mGET /api/inventory/items[2m > [22mshould query inventory items successfully [32m114[2mms[m       [31m
     ‚Üí Cannot find module './inventoryService'[K
Require stack:[K
- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[K
   √ó Inventory Routes[2m > [22mGET /api/inventory/items[2m > [22mshould handle query parameters correctly [32m9[2mms[m[K[31m
     ‚Üí Cannot find module './inventoryService'[K
Require stack:[K
- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[K
   √ó Inventory Routes[2m > [22mGET /api/inventory/items[2m > [22mshould handle service errors [32m14[2mms[m[K[31m
     ‚Üí Cannot find module './inventoryService'[K[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mGET /api/inventory/pharmacies[2m > [22mshould get pharmacy locations successfully [32m10[2mms[m  
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mGET /api/inventory/pharmacies[2m > [22mshould handle service errors [32m9[2mms[m[K[17C
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mPOST /api/inventory/sync[2m > [22mshould sync inventory successfully for pharmacist [32m12[2mms[m
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mPOST /api/inventory/sync[2m > [22mshould deny access to non-pharmacist users [32m10[2mms[m       
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mPOST /api/inventory/sync[2m > [22mshould handle service errors [32m6[2mms[m[K[22C
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mGET /api/inventory/health[2m > [22mshould check health status successfully for pharmacis[m
[31m[10;105Hst [32m10[2mms[31m[22m[K[99C[m
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mGET /api/inventory/health[2m > [22mshould deny access to non-pharmacist users [32m18[2mms[m      
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mGET /api/inventory/config[2m > [22mshould get configuration successfully for pharmacist [m
[32m[10;105H 6[2mms[22m[K[102C[m
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mPOST /api/inventory/config/pharmacy[2m > [22mshould update pharmacy configuration succes[m
[31m[10;105Hssfully for pharmacist [32m6[2mms[31m[22m[K[80C[m
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mPOST /api/inventory/config/pharmacy[2m > [22mshould validate required fields [32m20[2mms[m       
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mPOST /api/inventory/config/pharmacy[2m > [22mshould handle service errors [32m5[2mms[m[K[11C
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mDELETE /api/inventory/config/pharmacy/:pharmacyId[2m > [22mshould remove pharmacy config[m
[31m[10;105Hguration successfully for pharmacist [32m20[2mms[31m[22m[K[65C[m
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mDELETE /api/inventory/config/pharmacy/:pharmacyId[2m > [22mshould handle non-existent ph[m
[31m[10;105Hharmacy [32m5[2mms[31m[22m[K[95C[m
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mGET /api/inventory/config/pharmacy/:pharmacyId[2m > [22mshould get pharmacy configuratio[m
[31m[10;105Hon successfully for pharmacist [32m5[2mms[31m[22m[K[72C[m
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[31m   √ó Inventory Routes[2m > [22mGET /api/inventory/config/pharmacy/:pharmacyId[2m > [22mshould handle non-existent pharm[m
[31m[10;105Hmacy [32m10[2mms[31m[22m[K[97C[m
[31m     ‚Üí Cannot find module './inventoryService'[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[90mstdout[2m | src/features/prescriptionNotificationService.test.ts[m[K[44C
Using Google Cloud Application Default Credentials[55C
Firebase initialized successfully[72C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/inventoryRoutes.test.ts[2m 18/18[22m[K[60C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m 0/10[22m[K[45C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m14 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m174 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m38.75s[K[87C[?2026l
[105C[?2026h[10;1H[K
[K[105C[?2026l[2;1H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m 1/10[22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m14 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m175 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[m[2m
   Start at [22m00:00:15[K[2m
   Duration [22m38.99s[?2026h[7;1H[K
[K
[K
[K
[K[105C[5;1H[K
[K[105C[3;1H[K
[K[105C[2;1H[K[105C[?2026l[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m 3/10[33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][7;1H Test Files [31m[22m[1m14 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m177 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m39.13s[?2026h[2;1H [31m‚ùØ [msrc/features/prescriptionNotificationService.test.ts [2m(10 tests | [31m[22m10 failed[m[2m)[32m[22m 190[2mms[m[K[31m
   √ó PrescriptionNotificationService[2m > [22mnotifyPatientOfPrescription[2m > [22mshould send SMS and email notifications when both are enabled [32m74[2mms[m[K[31m
     ‚Üí Cannot find module './smsService'[K
Require stack:[K
- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionNotificationService.test.ts[K
   √ó PrescriptionNotificationService[2m > [22mnotifyPatientOfPrescription[2m > [22mshould only send SMS notification when email is disabled [32m14[2mms[m[K[31m
     ‚Üí Cannot find module './smsService'[K
Require stack:[K[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionNotificationService.test.ts[18C[m
[31m   √ó PrescriptionNotificationService[2m > [22mnotifyPatientOfPrescription[2m > [22mshould handle SMS sending failure gr[m
[31m[10;105Hracefully [32m10[2mms[31m[22m[K[92C[m
[31m     ‚Üí Cannot find module './smsService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionNotificationService.test.ts[18C[m
[31m   √ó PrescriptionNotificationService[2m > [22mnotifyPatientOfPrescription[2m > [22mshould handle missing notification p[m
[31m[10;105Hpreferences [32m20[2mms[31m[22m[K[90C[m
[31m     ‚Üí Cannot find module './smsService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionNotificationService.test.ts[18C[m
[31m   √ó PrescriptionNotificationService[2m > [22mgetNotificationHistory[2m > [22mshould return notification history for a [m
[31m[10;105H patient [32m7[2mms[31m[22m[K[94C[m
[31m     ‚Üí Cannot find module './smsService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionNotificationService.test.ts[18C[m
[31m   √ó PrescriptionNotificationService[2m > [22mgetNotificationHistory[2m > [22mshould handle errors gracefully [32m7[2mms[m      
[31m     ‚Üí Cannot find module './smsService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionNotificationService.test.ts[18C[m
[31m   √ó PrescriptionNotificationService[2m > [22mupdateNotificationStatus[2m > [22mshould update notification status succe[m
[31m[10;105Hessfully [32m6[2mms[31m[22m[K[94C[m
[31m     ‚Üí Cannot find module './smsService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionNotificationService.test.ts[18C[m
[31m   √ó PrescriptionNotificationService[2m > [22mupdateNotificationStatus[2m > [22mshould handle update errors [32m7[2mms[m        
[31m     ‚Üí Cannot find module './smsService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionNotificationService.test.ts[18C[m
[31m   √ó PrescriptionNotificationService[2m > [22mupdateNotificationPreferences[2m > [22mshould update notification prefere[m
[31m[10;105Hences successfully [32m21[2mms[31m[22m[K[83C[m
[31m     ‚Üí Cannot find module './smsService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionNotificationService.test.ts[18C[m
[31m   √ó PrescriptionNotificationService[2m > [22mupdateNotificationPreferences[2m > [22mshould handle update errors [32m9[2mms[m   
[31m     ‚Üí Cannot find module './smsService'[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionNotificationService.test.ts[18C[m
[105C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/prescriptionNotificationService.test.ts[2m 10/10[22m[K[44C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m39.48s[K[87C[?2026l
[105C[?2026h[K[105C[9;1H[K
[K[105C[?2026l[2;1H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[m[2m
   Start at [22m00:00:15[2m
   Duration [22m39.70s[?2026h[2;1H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[m[2m
   Start at [22m00:00:15[K[2m
   Duration [22m39.95s[K[87C
[105C[?2026l[?2026h[?2026l[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[m[2m
   Start at [22m00:00:15[K[2m
   Duration [22m40.49s[K
[K[105C]0;node (vitest 1)[?2026h[10;1H[K
[K[105C[4;1H[K
[K
[K
[K
[K
[K[105C[?2026l[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][7;1H Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m40.96s]0;node (vitest 6)[?2026h[?2026l[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[m[2m
   Start at [22m00:00:15[K[2m
   Duration [22m41.43s[K
[K[105C[?2026h[K[105C[8;1H[K
[K
[K[105C[5;1H[K
[K
[K[105C[2;1H[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][7;1H Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m41.98s[?2026l[?2026h
[K[105C[10;1H[K[105C[6;1H[K
[K
[K
[K[105C[4;1H[K
[K[105C[?2026l[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][7;1H Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[m[2m
   Start at [22m00:00:15[2m
   Duration [22m42.37s[?2026h[H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[33m[1m[2;1H ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][9;1H Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[m[2m
   Start at [22m00:00:15
[2m   Duration [22m42.68s[K[87C[?2026l
[105C]0;node (vitest 2)[?2026h[10;1H[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[m[2m
   Start at [22m00:00:15
[2m   Duration [22m43.02s[K[87C[?2026l
[105C[?2026h[6;1H[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/doctorPrescriptionService.test.ts[m[K
Using Google Cloud Application Default Credentials[K
Firebase initialized successfully[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m43.55s[K[87C[?2026l
[105C[?2026h[K[105C[90m[Hstderr[2m | src/features/doctorPrescriptionService.test.ts[m[K
Twilio SMS credentials not configured. SMS messaging will not work.[K
WhatsApp API credentials not configured. WhatsApp messaging will not work.[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m43.55s[K[87C
[105C[?2026l[?2026h[10;1H[K
[K[105C[6;1H[K
[K
[K
[K[105C[3;1H[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][9;1H Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[m[2m
   Start at [22m00:00:15
[2m   Duration [22m44.02s[K[87C
[105C[?2026l]0;node (vitest 4)[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m44.13s[K[87C[?2026l
[105C[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m44.48s[K[87C[?2026l
[105C[?2026h[6;1H[K
[K
[K
[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][10;1H Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m[2m
      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m45.01s[K[87C[?2026l
[105C]0;node (vitest 5)[?2026h[90m[Hstdout[2m | src/index.test.ts[m[K
Using Google Cloud Application Default Credentials[K
OCR Service initialized successfully[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m45.55s[K[87C[?2026l
[105C[?2026h[90m[Hstderr[2m | src/index.test.ts[m[K
No explicit Google Cloud credentials found. Falling back to Application Default Credentials (ADC)        
[K
[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m45.55s[K[87C[?2026l
[105C[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[H[K
[K
[K
[K
[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][11;1H Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m45.78s[K[87C
[105C[?2026l[?2026h[2m[H12:01:01 AM[22m [33m[1m[vite][m [33m[2m(ssr)[m [33mwarning: This assignment will throw because "firestore" is an import[K
50 |[K
51 |      (PaymentLinkService as any).mockImplementation(() => mockPaymentLinkService);[K
52 |      (firestore as any) = mockFirestore;[K
   |       ^[K
53 |    });[K
54 |[K[m
[K
  Plugin: [35mvite:esbuild[K[m
  File: [36mC:/Users/akgte/PharmaRx/apps/api/src/features/publicPaymentRoutes.test.ts[K[m
[K[105C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[55C
[33m[1m ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[53C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m46.00s[K[87C
[105C[?2026l[?2026h[K[105C[7;1H[K
[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][11;1H Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m46.58s[K[87C[?2026l
[105C[?2026h[4;1H[K
[K
[K
[K
[K
[K
[K
[K[105C[3;1H[K[105C[H[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][11;1H Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m46.92s[K[87C[?2026l
[105C[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m47.13s[K[87C[?2026l
[105C[?2026h[H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[H(node:20440) MetadataLookupWarning: received unexpected error = All promises were rejected code = UNKNOWN
(Use `node --trace-warnings ...` to show where the warning was created)[33m[1m[4;1H ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m47.59s[K[87C[?2026l
[105C]0;node (vitest 1)[?2026h[K[105C[5;1H[K
[K
[K
[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m

[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m48.12s[K[87C[?2026l
[105C[?2026h[10;1H[K
[K[105C[3;1H[K
[K
[K
[K
[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m

[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m48.57s[K[87C[?2026l
[105C]0;node (vitest 3)[?2026h[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C

[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m49.11s[K[87C
[105C[?2026l[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m49.32s[K[87C[?2026l
[105C[?2026h[7;1H[K
[K
[K
[K
[K[105C[6;1H[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m49.56s[K[87C[?2026l
[105C]0;node (vitest 4)[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[5;1H[K
[K
[K
[K[105C[3;1H[K
[K[105C[H[K
[K[105C[H[K[105C[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m50.11s[K[87C[?2026l
[105C[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/users.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (299)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m50.54s[K[87C[?2026l
[105C[?2026h[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[5;1H[K
[K
[K[105C[4;1H[K[105C[H[K
[K
[K[105C[90m[Hstderr[2m | src/features/users.test.ts > UserService > createUser > should reject invalid user data[m[K
Error creating user: Error: Validation failed: role is required and must be one of: patient, caregiver, doctor, pharmacist, displayName is required and must be a non-empty string, Either email or phoneNumber must be provided
    at UserService.createUser [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.ts:25:15[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:119:32
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[55C
[33m[1m ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[53C
[33m[1m ‚ùØ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ‚ùØ [msrc/features/users.test.ts[2m 0/21[22m[K[71C
[33m[1m ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m0 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m115 passed[90m[22m (320)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m51.07s[K[87C[?2026l
[105C[?2026h[K[105C[90m[Hstdout[2m | src/features/profileRoutes.integration.test.ts[m[K
Using Google Cloud Application Default Credentials[K
OCR Service initialized successfully[K
[K
[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[53C
[33m[1m ‚ùØ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m1 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m136 passed[90m[22m (320)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m51.57s[K[87C[?2026l
[105C[?2026h[5;1H[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/users.test.ts > UserService > createUser > should handle database errors[m[K
Error creating user: Error: Firestore error[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:125:37[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)[90m
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/profileRoutes.integration.test.ts[m[K[50C
No explicit Google Cloud credentials found. Falling back to Application Default Credentials (ADC)        
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > getUserById > should reject invalid uid[m[K[14C
Error getting user: Error: Valid UID is required[57C
    at UserService.getUserById [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.ts:65:15[90m)[K[12C[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:187:32[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > getUserById > should reject invalid uid[m[K[14C
Error getting user: Error: Valid UID is required[57C
    at UserService.getUserById [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.ts:65:15[90m)[K[12C[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:190:32[K[32C
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > getUserById > should handle database errors[m[K[10C
Error getting user: Error: Firestore error[63C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:196:37[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > updateUser > should reject update for non-existent us[m
[90m[2m[10;105Hser[22m[K[103C[m
Error updating user: Error: User not found[63C
    at UserService.updateUser [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.ts:107:15[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > updateUser > should handle database errors[m[K[11C
Error updating user: Error: Firestore error[62C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:251:40[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > deleteUser > should handle database errors[m[K[11C
Error deleting user: Error: Firestore error[62C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:293:40[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > getUsersByRole > should reject invalid role[m[K[10C
Error getting users by role: Error: Invalid user role[52C
    at UserService.getUsersByRole [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.ts:182:15[90m)        [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:338:32[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > getUsersByRole > should handle database errors[m       
Error getting users by role: Error: Firestore error[54C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:343:44[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > userExists > should return false on errors[m[K[11C
Error checking user existence: Error: Database error[53C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:372:62[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[55C
[33m[1m ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[53C
[33m[1m ‚ùØ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m1 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m136 passed[90m[22m (320)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m51.57s[K[87C[?2026l[?2026h
[H [32m‚úì [msrc/features/users.test.ts [2m(21 tests)[33m[22m 431[2mms[m[K
[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m1 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m136 passed[90m[22m (320)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m51.57s[K[87C[?2026l
[105C[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/inventoryService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m1 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m136 passed[90m[22m (320)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m51.85s[K[87C[?2026l
[105C[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/inventoryService.test.ts[2m 0/13[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/userRoutes.test.ts[2m 0/20[22m[K[33m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m1 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m136 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m52.19s[K[87C[?2026l
[105C[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/inventoryService.test.ts[2m 2/13[22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/userRoutes.test.ts[2m 1/20[22m[K[33m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m1 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m139 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m52.40s[K[87C[?2026l
[105C[?2026h[H [32m‚úì [msrc/features/inventoryService.test.ts [2m(13 tests)[32m[22m 240[2mms[m[K
[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/userRoutes.test.ts[2m 4/20[22m[K[33m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m2 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m153 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m52.61s[K[87C[?2026l[?2026h
[H(node:30368) MetadataLookupWarning: received unexpected error = All promises were rejected code = UNKNOWN
(Use `node --trace-warnings ...` to show where the warning was created)[K[90m
stderr[2m | src/features/userRoutes.test.ts > User Routes > POST /users > should handle service errors[m      
Error in POST /users: Error: Service error[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:109:57[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)[K
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)[K[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/userRoutes.test.ts > User Routes > POST /users > should handle unknown errors[m      
Error in POST /users: Unknown error[70C
[105C
[105C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[55C
[33m[1m ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[53C
[33m[1m ‚ùØ [msrc/features/userRoutes.test.ts[2m 4/20[22m[K[66C
[33m[1m ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m2 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m153 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m52.61s[K[87C[?2026l
[105C[?2026h[H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/userRoutes.test.ts > User Routes > GET /users/:uid > should handle service errors[m  
Error in GET /users/:uid: Error: Service error
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:176:58
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)[90m
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/userRoutes.test.ts > User Routes > PUT /users/:uid > should return 404 when user no[m
[90m[2m[10;105Hot found[22m[K[98C[m
Error in PUT /users/:uid: Error: User not found[58C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:222:57[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[55C
[33m[1m ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[53C
[33m[1m ‚ùØ [msrc/features/userRoutes.test.ts[2m 9/20[22m[K[66C
[33m[1m ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m2 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m158 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m52.82s[K[87C[?2026l
[105C]0;node (vitest 3)[?2026h[90m[Hstderr[2m | src/features/userRoutes.test.ts > User Routes > PUT /users/:uid > should handle validation errors[m[K
Error in PUT /users/:uid: Error: Validation failed[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:235:57[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)[K
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)[K
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/userRoutes.test.ts > User Routes > DELETE /users/:uid > should handle service error[m
[90m[2m[10;105Hrs[22m[K[104C[m
Error in DELETE /users/:uid: Error: Service error[56C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:277:57[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[55C
[33m[1m ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[53C
[33m[1m ‚ùØ [msrc/features/userRoutes.test.ts[2m 14/20[22m[K[65C
[33m[1m ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m2 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m163 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m53.03s[K[87C[?2026l
[105C]0;node (vitest 5)[?2026h[90m[Hstderr[2m | src/features/userRoutes.test.ts > User Routes > GET /users/role/:role > should handle service errors[m[K
Error in GET /users/role/:role: Error: Service error[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:336:61[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)[K
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)[K
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[55C
[33m[1m ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[53C
[33m[1m ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m3 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m169 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m53.45s[K[87C[?2026l[?2026h
[9;1H                                                                                                         
                                                                                                         
[105C[H[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/profileRoutes.test.ts[m[K
Using Google Cloud Application Default Credentials
OCR Service initialized successfully[33m[1m[6;1H ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[53C
[33m[1m ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m3 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m169 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m53.45s[K[87C[?2026l
[105C[?2026h[7;1H[K
[K
[K
[K
[K[105C[6;1H[K[105C[90m[Hstderr[2m | src/features/profileRoutes.test.ts[m[K
No explicit Google Cloud credentials found. Falling back to Application Default Credentials (ADC)        
[K[90m
stderr[2m | src/features/userRoutes.test.ts > User Routes > GET /users/:uid/exists > should handle service errors[m[K
Error in GET /users/:uid/exists: Error: Service error
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:382:57
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[10;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[55C
[33m[1m ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[54C
[33m[1m ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[47C
[33m[1m ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[53C
[33m[1m ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[59C
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m3 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m169 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m53.45s[K[87C
[105C[?2026l[?2026h[K[105C[4;1H[K
[K
[K
[K
[K
[K
[K[105C[3;1H[K[105C[H [32m‚úì [msrc/features/userRoutes.test.ts [2m(20 tests)[33m[22m 1136[2mms[m[K
   [33m[2m‚úì[m User Routes[2m > [22mPOST /users[2m > [22mshould create a user successfully  [33m401[2mms[m[K[33m[1m[4;1H ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m
[33m[1m ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m3 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m169 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m53.45s[K[87C[?2026l
[105C]0;node (vitest 4)[?2026h[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K[76C

[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m3 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m169 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m53.87s[K[87C[?2026l
[105C[?2026h[K[105C[10;1H[K[105C[7;1H[K
[K
[K[105C[H[K
[K
[K
[K
[K
[K[105C[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][33m[22m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m

[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m3 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m169 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m54.44s[K[87C[?2026l
[105C]0;node (vitest 1)[?2026h[H[K[33m[1m
 ‚ùØ [msrc/features/doctorPrescriptionService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentLinkService.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/paymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.integration.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/profileRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/publicPaymentRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/features/webhookRoutes.test.ts[2m [queued][22m[K[33m[1m
 ‚ùØ [msrc/index.test.ts[2m [queued][22m[K
[K[105C
[2m Test Files [31m[22m[1m15 failed[m[2m | [32m[22m[1m3 passed[90m[22m (27)[K[68C[m
[2m      Tests [31m[22m[1m184 failed[m[2m | [32m[22m[1m169 passed[90m[22m (353)[K[64C[m
[2m   Start at [22m00:00:15[K[85C
[2m   Duration [22m54.72s[K[87C[?2026l
[105C]0;node (vitest 6)[K[105C[10;1H[K[105C[3;1H[K
[K
[K
[K
[K
[K
[K[105C[H[K
[K[105C[H(node:30244) MetadataLookupWarning: received unexpected error = All promises were rejected code = UNKNOWN
(Use `node --trace-warnings ...` to show where the warning was created)[31m[4;1H‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[41m[1m Failed Suites 9 [31m[49m[22m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[m[41m[1m[6;1H FAIL [m src/index.test.ts[2m [ src/index.test.ts ][41m[22m[1m
 FAIL [m src/features/profileRoutes.test.ts[2m [ src/features/profileRoutes.test.ts ][22m[31m[1m
TypeError[22m: Cannot read properties of undefined (reading 'collection')[m[36m
 [2m‚ùØ[22m ReceiptService.<instance_members_initializer> src/features/receiptService.ts:[2m64:44[m
     [90m62| [m
     [90m63| [35mclass [33mReceiptService [m{
     [90m64|   [35mprivate [mreadonly receiptsCollection [33m= [mdb[33m.[34mcollection[m([32m'receipts'[m)[33m;[K[30C[m
       [90m|[44X[31m[44C^[K[52C[m
     [90m65|   [35mprivate [mreadonly paymentsCollection [33m= [mdb[33m.[34mcollection[m([32m'payments'[m)[33m;[K[30C[m
     [90m66|[K[97C[m
[105C[90m [2m‚ùØ[22m new ReceiptService src/features/receiptService.ts:[2m63:1[m
[105C[90m [2m‚ùØ[22m src/features/receiptService.ts:[2m493:31[m
[105C[90m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.ts:[2m5:1[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/doctorPrescriptionService.test.ts[2m [ src/features/doctorPrescriptionService.test.ts ][22m 
[31m[1mError[22m: [vitest] No "default" export is defined on the "./database" mock. Did you forget to return it from[m
[31m[10;105Hm "vi.mock"?[94C[m
[31mIf you need to partially mock a module, you can use "importOriginal" helper inside:[22C[m
[31m[105C[m
[105Cvi[33m.[34mmock[m([35mimport[m([32m"./database"[m)[33m, [35masync [m(importOriginal) [33m=> [m{
  [35mconst [mactual [33m= [35mawait [34mimportOriginal[m()[K[66C
  [35mreturn [m{[K[95C
    [33m...[mactual[33m,[K[91C[m
    [90m// your mocked methods[K[79C[m
  }[102C
})[103C
[105C
[36m [2m‚ùØ[22m new DoctorPrescriptionService src/features/doctorPrescriptionService.ts:[2m21:15[m[K[25C
[105C     [90m19|   [34mconstructor[m() {
     [90m20|     [35mthis[33m.[mnotificationService [33m= [35mnew [33mPrescriptionNotificationService[m()[33m;[K[27C[m
     [90m21|     [35mthis[33m.[mdb [33m= [mdatabaseService[33m.[34mgetDb[m()[33m;[K[58C[m
       [90m|[15X[31m[15C^[K[81C[m
     [90m22|   [m}[K[93C
     [90m23|[K[97C[m
[105C[90m [2m‚ùØ[22m src/features/doctorPrescriptionService.ts:[2m287:42[m
[90m [2m‚ùØ[22m src/features/doctorPrescriptionService.test.ts:[2m2:1[m[K[52C
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/paymentLinkRoutes.test.ts[2m [ src/features/paymentLinkRoutes.test.ts ][22m[K[17C
[31m[1mError[22m: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure t[m
[31m[10;105Hthere are no top level variables inside, since this call is hoisted to top of the file. Read more: https:/[m
[31m[10;105H//vitest.dev/api/vi.html#vi-mock[74C[m
[105C[36m [2m‚ùØ[22m src/features/paymentLinkRoutes.ts:[2m2:1[m
[105C      [90m1| [35mimport [m{ [33mRouter, Request, Response [m} [35mfrom [32m'express'[33m;[m
      [90m2| [35mimport [m{ authenticateToken } [35mfrom [32m'../middleware/auth'[33m;[K[41C[m
       [90m| [31m^[K[95C[m
      [90m3| [35mimport [m{ validateRequest } [35mfrom [32m'../middleware/validation'[33m;[K[37C[m
      [90m4| [35mimport [m{ [33mPaymentLinkService [m} [35mfrom [32m'./paymentLinkService'[33m;[K[38C[m
[105C
[31m[1mCaused by: ReferenceError[22m: Cannot access 'mockAuthenticateToken' before initialization[K[19C[m
[105C[36m [2m‚ùØ[22m src/features/paymentLinkRoutes.test.ts:[2m22:22[m
[90m [2m‚ùØ[22m src/features/paymentLinkRoutes.ts:[2m2:1[m[K[65C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/paymentLinkService.test.ts[2m [ src/features/paymentLinkService.test.ts ][22m[K[15C
[105C[31m[1mError[22m: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure t[m
[31m[10;105Hthere are no top level variables inside, since this call is hoisted to top of the file. Read more: https:/[m
[31m[10;105H//vitest.dev/api/vi.html#vi-mock[74C[m
[105C[36m [2m‚ùØ[22m src/features/paymentLinkService.ts:[2m1:1[m
[105C      [90m1| [35mimport [m{ firestore } [35mfrom [32m'../config/firebase'[33m;[m
       [90m| [31m^[K[95C[m
      [90m2| [mimport { PaymentLink, PaymentLinkRequest, PaymentLinkResponse, PrescriptionOrderStatus } from '‚Ä¶
      [90m3| [35mimport [m{ [33mWhatsAppService [m} [35mfrom [32m'./whatsappService'[33m;[K[44C[m
[105C
[31m[1mCaused by: ReferenceError[22m: Cannot access 'mockFirestore' before initialization[K[27C[m
[36m [2m‚ùØ[22m src/features/paymentLinkService.test.ts:[2m33:14[m[K[57C
[90m [2m‚ùØ[22m src/features/paymentLinkService.ts:[2m1:1[m[K[64C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/paymentRoutes.test.ts[2m [ src/features/paymentRoutes.test.ts ][22m[K[25C
[105C[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'collection')[m
[36m [2m‚ùØ[22m ReceiptService.<instance_members_initializer> src/features/receiptService.ts:[2m64:44[m[K[20C
     [90m62|[K[97C[m
     [90m63| [35mclass [33mReceiptService [m{[K[74C
     [90m64|   [35mprivate [mreadonly receiptsCollection [33m= [mdb[33m.[34mcollection[m([32m'receipts'[m)[33m;[K[30C[m
       [90m|[44X[31m[44C^[K[52C[m
     [90m65|   [35mprivate [mreadonly paymentsCollection [33m= [mdb[33m.[34mcollection[m([32m'payments'[m)[33m;[K[30C[m
     [90m66|[K[97C[m
[90m [2m‚ùØ[22m new ReceiptService src/features/receiptService.ts:[2m63:1[m[K[48C
[90m [2m‚ùØ[22m src/features/receiptService.ts:[2m493:31[m[K[65C
[90m [2m‚ùØ[22m src/features/paymentService.ts:[2m4:1[m[K[68C
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/profileRoutes.integration.test.ts[2m [ src/features/profileRoutes.integration.test.ts ][22m 
[31m[1mError[22m: Cannot find module './profiles' imported from 'C:/Users/akgte/PharmaRx/apps/api/src/features/profi[m
[31m[10;105HileRoutes.ts'[93C[m
[36m [2m‚ùØ[22m src/features/profileRoutes.ts:[2m3:1[m[K[69C
      [90m1| [35mimport [m{ [33mRouter, Request, Response [m} [35mfrom [32m'express'[33m;[K[44C[m
      [90m2| [35mimport [m{ [33mCreateProfileRequest, UpdateProfileRequest [m} [35mfrom [32m'@pharmarx/shared-types'[33m;[K[12C[m
      [90m3| [35mimport [mprofileService [35mfrom [32m'./profiles'[33m;[K[56C[m
       [90m| [31m^[K[95C[m
      [90m4|[K[97C[m
      [90m5| [35mconst [mrouter [33m= Router[m()[33m;[K[72C[m
[105C
[31m[1mCaused by: Error[22m: Failed to load url ./profiles (resolved id: ./profiles) in C:/Users/akgte/PharmaRx/apps[m
[31m[10;105Hs/api/src/features/profileRoutes.test.ts. Does the file exist?[44C[m
[90m [2m‚ùØ[22m loadAndTransform ../../node_modules/vite/dist/node/chunks/dep-Bg4HVnP5.js:[2m26447:33[m[K[20C
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/publicPaymentRoutes.test.ts[2m [ src/features/publicPaymentRoutes.test.ts ][22m[K[13C
[31m[1mError[22m: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure t[m
[31m[10;105Hthere are no top level variables inside, since this call is hoisted to top of the file. Read more: https:/[m
[31m[10;105H//vitest.dev/api/vi.html#vi-mock[74C[m
[36m [2m‚ùØ[22m src/features/publicPaymentRoutes.ts:[2m2:1[m[K[63C
[105C      [90m1| [35mimport [m{ [33mRouter, Request, Response [m} [35mfrom [32m'express'[33m;[m
      [90m2| [35mimport [m{ validateRequest } [35mfrom [32m'../middleware/validation'[33m;[K[37C[m
       [90m| [31m^[K[95C[m
      [90m3| [35mimport [m{ [33mPaymentLinkService [m} [35mfrom [32m'./paymentLinkService'[33m;[K[38C[m
      [90m4| [mimport { PublicPaymentInfo, PublicPaymentRequest, PublicPaymentResponse, PaymentLinkValidationR‚Ä¶
[105C
[31m[1mCaused by: ReferenceError[22m: Cannot access 'mockValidateRequest' before initialization[K[21C[m
[36m [2m‚ùØ[22m src/features/publicPaymentRoutes.test.ts:[2m18:20[m[K[56C
[90m [2m‚ùØ[22m src/features/publicPaymentRoutes.ts:[2m2:1[m[K[63C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/webhookRoutes.test.ts[2m [ src/features/webhookRoutes.test.ts ][22m[K[25C
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'collection')[K[36C[m
[36m [2m‚ùØ[22m ReceiptService.<instance_members_initializer> src/features/receiptService.ts:[2m64:44[m[K[20C
[105C     [90m62| [m
     [90m63| [35mclass [33mReceiptService [m{[K[74C
     [90m64|   [35mprivate [mreadonly receiptsCollection [33m= [mdb[33m.[34mcollection[m([32m'receipts'[m)[33m;[K[30C[m
       [90m|[44X[31m[44C^[K[52C[m
     [90m65|   [35mprivate [mreadonly paymentsCollection [33m= [mdb[33m.[34mcollection[m([32m'payments'[m)[33m;[K[30C[m
     [90m66|[K[97C[m
[90m [2m‚ùØ[22m new ReceiptService src/features/receiptService.ts:[2m63:1[m[K[48C
[90m [2m‚ùØ[22m src/features/receiptService.ts:[2m493:31[m[K[65C
[90m [2m‚ùØ[22m src/features/paymentService.ts:[2m4:1[m[K[68C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/193]‚éØ[m
[105C
[105C
[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[41m[1m Failed Tests 184 [31m[49m[22m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/register[2m > [22msuccessfully registers a new
[10;105Hw user with email[89C
[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 201[100C[m
[31m+ 500[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m87:31[m[K[65C
[105C     [90m85|[9X[33m[9C.[34msend[m(validRegistrationData)[33m;[m
     [90m86|[K[97C[m
     [90m87|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m201[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
     [90m88|       [34mexpect[m(response[33m.[mbody)[33m.[34mtoEqual[m({[K[59C
     [90m89|[9X[m[9Csuccess[33m: [35mtrue[33m,[K[74C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/register[2m > [22msuccessfully registers a new
[10;105Hw user with phone number[82C
[105C[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 201[100C[m
[31m+ 500[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m135:31[m[K[64C
[105C    [90m133|[9X[33m[9C.[34msend[m(phoneData)[33m;[m
    [90m134|[K[97C[m
    [90m135|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m201[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m136|       [34mexpect[m(mockUserService[33m.[mcreateUser)[33m.[34mtoHaveBeenCalledWith[m([K[34C
    [90m137|[9X[32m[9C'test-uid-123'[33m,[K[73C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/register[2m > [22mreturns 401 with invalid tok
[10;105Hken[103C
[31m[1mAssertionError[22m: expected 500 to be 401 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 401[100C[m
[31m+ 500[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m163:31[m[K[64C
[105C    [90m161|[9X[33m[9C.[34msend[m(validRegistrationData)[33m;[m
    [90m162|[K[97C[m
    [90m163|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m401[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m164|       [34mexpect[m(response[33m.[mbody[33m.[merror)[33m.[34mtoContain[m([32m'Unauthorized'[m)[33m;[K[36C[m
    [90m165|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/register[2m > [22mreturns 403 when token UID d
[10;105Hdoes not match request UID[80C
[31m[1mAssertionError[22m: expected 500 to be 403 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 403[100C[m
[31m+ 500[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m239:31[m[K[64C
[105C    [90m237|[9X[33m[9C.[34msend[m(mismatchedData)[33m;[m
    [90m238|[K[97C[m
    [90m239|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m403[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m240|       [34mexpect[m(response[33m.[mbody[33m.[merror)[33m.[34mtoBe[m([32m'Token UID does not match request UID'[m)[33m;[K[17C[m
    [90m241|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/register[2m > [22mreturns 409 when user alread
[10;105Hdy exists[97C
[31m[1mAssertionError[22m: expected 500 to be 409 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 409[100C[m
[31m+ 500[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m257:31[m[K[64C
    [90m255|[9X[33m[9C.[34msend[m(validRegistrationData)[33m;[K[59C[m
    [90m256|[K[97C[m
    [90m257|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m409[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m258|       [34mexpect[m(response[33m.[mbody[33m.[merror)[33m.[34mtoBe[m([32m'User already exists'[m)[33m;[K[34C[m
    [90m259|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[13/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/register[2m > [22mhandles user service validat
[10;105Htion errors[95C
[31m[1mAssertionError[22m: expected 500 to be 400 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 400[100C[m
[31m+ 500[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m272:31[m[K[64C
[105C    [90m270|[9X[33m[9C.[34msend[m(validRegistrationData)[33m;[m
    [90m271|[K[97C[m
    [90m272|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m400[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m273|       [34mexpect[m(response[33m.[mbody[33m.[merror)[33m.[34mtoContain[m([32m'Validation failed'[m)[33m;[K[31C[m
    [90m274|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[14/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/register[2m > [22mcontinues registration even 
[10;105H if custom claims fail[84C
[105C[31m[1mAssertionError[22m: expected 500 to be 201 // Object.is equality[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 201[100C[m
[31m+ 500[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m305:31[m[K[64C
    [90m303|[9X[33m[9C.[34msend[m(validRegistrationData)[33m;[K[59C[m
    [90m304|[K[97C[m
    [90m305|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m201[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m306|       [34mexpect[m(response[33m.[mbody[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[49C[m
    [90m307|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[15/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mGET /auth/me[2m > [22mreturns current user profile       
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 200[100C[m
[31m+ 500[100C[m
[105C
[105C[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m326:31[m
    [90m324|[9X[33m[9C.[35mset[m([32m'Authorization'[33m, [32m`Bearer [36m${[mmockToken[36m}[32m`[m)[33m;[K[43C[m
    [90m325|[K[97C[m
    [90m326|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m200[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m327|       [34mexpect[m(response[33m.[mbody)[33m.[34mtoEqual[m({[K[59C
    [90m328|[9X[m[9Csuccess[33m: [35mtrue[33m,[K[74C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[16/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mGET /auth/me[2m > [22mreturns 404 when user profile not f
[10;105Hfound[101C
[31m[1mAssertionError[22m: expected 500 to be 404 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 404[100C[m
[31m+ 500[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m349:31[m[K[64C
[105C    [90m347|[9X[33m[9C.[35mset[m([32m'Authorization'[33m, [32m`Bearer [36m${[mmockToken[36m}[32m`[m)[33m;[m
    [90m348|[K[97C[m
    [90m349|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m404[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m350|       [34mexpect[m(response[33m.[mbody[33m.[merror)[33m.[34mtoBe[m([32m'User profile not found'[m)[33m;[K[31C[m
    [90m351|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[17/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPUT /auth/profile[2m > [22msuccessfully updates user prof
[10;105Hfile[102C
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 200[100C[m
[31m+ 400[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m376:31[m[K[64C
[105C    [90m374|[9X[33m[9C.[34msend[m(updateData)[33m;[m
    [90m375|[K[97C[m
    [90m376|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m200[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m377|       [34mexpect[m(response[33m.[mbody)[33m.[34mtoEqual[m({[K[59C
    [90m378|[9X[m[9Csuccess[33m: [35mtrue[33m,[K[74C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[18/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPUT /auth/profile[2m > [22mremoves uid from update data  
[105C[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'test-uid-123', ‚Ä¶(1) ][m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m404:42[m[K[64C
    [90m402|[9X[33m[9C.[34msend[m(updateData)[33m;[K[70C[m
    [90m403|[K[97C[m
    [90m404|       [34mexpect[m(mockUserService[33m.[mupdateUser)[33m.[34mtoHaveBeenCalledWith[m([32m'test-uid-123'[33m, [m{[K[17C
       [90m|[42X[31m[42C^[K[54C[m
    [90m405|[9X[m[9CdisplayName[33m: [32m'Updated Name'[K[61C[m
    [90m406|       [m})[33m;[K[87C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[19/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPUT /auth/profile[2m > [22mreturns 404 when user not foun
[10;105Hnd[104C
[105C[31m[1mAssertionError[22m: expected 400 to be 404 // Object.is equality[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 404[100C[m
[31m+ 400[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m417:31[m[K[64C
    [90m415|[9X[33m[9C.[34msend[m({ displayName[33m: [32m'Updated Name' [m})[33m;[K[49C[m
    [90m416|[K[97C[m
    [90m417|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m404[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m418|     [m})[33m;[K[89C[m
    [90m419|   [m})[33m;[K[91C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[20/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/login[2m > [22msuccessfully returns user profi
[10;105Hile for authenticated user[80C
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 200[100C[m
[31m+ 500[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m437:31[m[K[64C
    [90m435|[9X[33m[9C.[35mset[m([32m'Authorization'[33m, [32m`Bearer [36m${[mmockToken[36m}[32m`[m)[33m;[K[43C[m
    [90m436|[K[97C[m
    [90m437|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m200[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m438|       [34mexpect[m(response[33m.[mbody)[33m.[34mtoEqual[m({[K[59C
    [90m439|[9X[m[9Csuccess[33m: [35mtrue[33m,[K[74C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[21/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/login[2m > [22mreturns 401 when invalid token
[31m[1mAssertionError[22m: expected 500 to be 401 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 401[100C[m
[31m+ 500[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m468:31[m[K[64C
    [90m466|[9X[33m[9C.[35mset[m([32m'Authorization'[33m, [32m'Bearer invalid-token'[m)[33m;[K[42C[m
    [90m467|[K[97C[m
    [90m468|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m401[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m469|       [34mexpect[m(response[33m.[mbody)[33m.[34mtoEqual[m({[K[59C
    [90m470|[9X[m[9Cerror[33m: [32m'Unauthorized - Invalid token'[K[51C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/login[2m > [22mreturns 404 when user profile n
[10;105Hnot found[97C
[31m[1mAssertionError[22m: expected 500 to be 404 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 404[100C[m
[31m+ 500[100C[m
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m481:31[m[K[64C
    [90m479|[9X[33m[9C.[35mset[m([32m'Authorization'[33m, [32m`Bearer [36m${[mmockToken[36m}[32m`[m)[33m;[K[43C[m
    [90m480|[K[97C[m
    [90m481|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m404[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m482|       [34mexpect[m(response[33m.[mbody)[33m.[34mtoEqual[m({[K[59C
    [90m483|[9X[m[9Cerror[33m: [32m'User profile not found. Please contact support.'[K[32C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[23/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/login[2m > [22mhandles database errors gracefu
[10;105Hully[102C
[105C[31m[1mAssertionError[22m: expected { Object (error) } to deeply equal { error: 'Database connection failed' }[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[2m  {[22m[K[102C
[32m-   "error": "Database connection failed",[63C[m
[31m+   "error": "Cannot read properties of undefined (reading 'uid')",[38C[m
[2m  }[22m[K[102C
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m496:29[m[K[64C
    [90m494|[K[97C[m
    [90m495|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m500[m)[33m;[K[56C[m
    [90m496|       [34mexpect[m(response[33m.[mbody)[33m.[34mtoEqual[m({[K[59C
       [90m|[29X[31m[29C^[K[67C[m
    [90m497|[9X[m[9Cerror[33m: [32m'Database connection failed'[K[53C[m
    [90m498|       [m})[33m;[K[87C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[24/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/login[2m > [22mhandles unexpected errors      
[31m[1mAssertionError[22m: expected { Object (error) } to deeply equal { Object (error) }[K[27C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[2m  {[22m[K[102C
[32m-   "error": "Login failed. Please try again.",[58C[m
[31m+   "error": "Cannot read properties of undefined (reading 'uid')",[38C[m
[2m  }[22m[K[102C
[105C
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m509:29[m[K[64C
    [90m507|[K[97C[m
    [90m508|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m500[m)[33m;[K[56C[m
    [90m509|       [34mexpect[m(response[33m.[mbody)[33m.[34mtoEqual[m({[K[59C
       [90m|[29X[31m[29C^[K[67C[m
    [90m510|[9X[m[9Cerror[33m: [32m'Login failed. Please try again.'[K[48C[m
    [90m511|       [m})[33m;[K[87C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[25/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/authRoutes.test.ts[2m > [22mAuth Routes[2m > [22mPOST /auth/login[2m > [22mverifies Firebase token with co
[10;105Horrect parameters[89C
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'mock-firebase-token' ][K[20C[m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[36m [2m‚ùØ[22m src/features/authRoutes.test.ts:[2m529:33[m[K[64C
    [90m527|[9X[33m[9C.[35mset[m([32m'Authorization'[33m, [32m`Bearer [36m${[mmockToken[36m}[32m`[m)[33m;[K[43C[m
    [90m528|[K[97C[m
    [90m529|       [34mexpect[m(mockVerifyIdToken)[33m.[34mtoHaveBeenCalledWith[m(mockToken)[33m;[K[32C[m
       [90m|[33X[31m[33C^[K[63C[m
    [90m530|     [m})[33m;[K[89C[m
    [90m531|   [m})[33m;[K[91C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[26/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould not reinitialize if already initi
[10;105Hialized[99C
[31m[1mAssertionError[22m: expected "spy" to be called at least once[K[48C[m
[36m [2m‚ùØ[22m src/features/database.test.ts:[2m114:31[m[K[66C
[105C    [90m112|       // initializeApp should not be called again[m
    [90m113|       [34mexpect[m(admin[33m.[minitializeApp)[33m.[mnot[33m.[34mtoHaveBeenCalled[m()[33m;[K[39C[m
    [90m114|       [34mexpect[m(admin[33m.[mfirestore)[33m.[34mtoHaveBeenCalled[m()[33m;[K[47C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m115|     [m})[33m;[K[89C[m
    [90m116|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[27/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould initialize with production settin
[10;105Hngs[103C
[105C[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ { credential: Anything, ‚Ä¶(1) } ][m
[90m[105C[m
[90mReceived:[96C[m
[90m[105C[m
[90m[1m  1st spy call:[22m[K[90C[m
[90m[105C[m
[90m[2m  [[22m[K[102C[m
[90m[2m    {[22m[K[100C[m
[32m-     "credential": Anything,[76C[m
[31m+     "credential": undefined,[75C[m
[90m[2m      "projectId": "pharmarx-prod",[22m[K[70C[m
[90m[2m    },[22m[K[99C[m
[90m[2m  ][22m[K[102C[m
[90m[105C[m
[90m[105C[m
[90mNumber of calls: [1m1[22m[K[87C[m
[90m[105C[m
[36m [2m‚ùØ[22m src/features/database.test.ts:[2m173:35[m[K[66C
    [90m171|[K[97C[m
    [90m172|       [34mexpect[m(admin[33m.[mcredential[33m.[mcert)[33m.[34mtoHaveBeenCalled[m()[33m;[K[41C[m
    [90m173|       [34mexpect[m(admin[33m.[minitializeApp)[33m.[34mtoHaveBeenCalledWith[m({[K[40C
       [90m|[35X[31m[35C^[K[61C[m
    [90m174|[9X[m[9Ccredential[33m: [mexpect[33m.[34manything[m()[33m,[K[58C[m
    [90m175|[9X[m[9CprojectId[33m: [32m'pharmarx-prod'[K[62C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[28/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould use application default credentia
[10;105Hals in production if no service account key[63C
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ { credential: Anything, ‚Ä¶(1) } ][K[11C[m
[90m[105C[m
[90mReceived:[96C[m
[90m[105C[m
[90m[1m  1st spy call:[22m[K[90C[m
[90m[105C[m
[90m[2m  [[22m[K[102C[m
[90m[2m    {[22m[K[100C[m
[32m-     "credential": Anything,[76C[m
[31m+     "credential": undefined,[75C[m
[90m[2m      "projectId": "pharmarx-prod",[22m[K[70C[m
[90m[2m    },[22m[K[99C[m
[90m[2m  ][22m[K[102C[m
[90m[105C[m
[90m[105C[m
[90mNumber of calls: [1m1[22m[K[87C[m
[90m[105C[m
[36m [2m‚ùØ[22m src/features/database.test.ts:[2m192:35[m[K[66C
    [90m190|[K[97C[m
    [90m191|       [34mexpect[m(admin[33m.[mcredential[33m.[mapplicationDefault)[33m.[34mtoHaveBeenCalled[m()[33m;[K[27C[m
    [90m192|       [34mexpect[m(admin[33m.[minitializeApp)[33m.[34mtoHaveBeenCalledWith[m({[K[40C
       [90m|[35X[31m[35C^[K[61C[m
    [90m193|[9X[m[9Ccredential[33m: [mexpect[33m.[34manything[m()[33m,[K[58C[m
    [90m194|[9X[m[9CprojectId[33m: [32m'pharmarx-prod'[K[62C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[29/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mhealthCheck[2m > [22mshould return healthy status when 
[10;105H database is accessible[83C
[31m[1mAssertionError[22m: expected { status: 'unhealthy', ‚Ä¶(2) } to deeply equal { status: 'healthy', connected: tr[m
[31m[10;105Hrue }[101C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[2m  {[22m[K[102C
[32m-   "connected": true,[83C[m
[32m-   "status": "healthy",[81C[m
[31m+   "projectId": "unknown",[78C[m
[31m+   "status": "unhealthy",[79C[m
[31m+   "timestamp": 2025-07-30T04:00:50.543Z,[63C[m
[2m  }[22m[K[102C
[105C
[36m [2m‚ùØ[22m src/features/database.test.ts:[2m215:22[m[K[66C
    [90m213|       [35mconst [mresult [33m= [35mawait [mdatabaseService[33m.[34mhealthCheck[m()[33m;[K[39C[m
    [90m214|[K[97C[m
    [90m215|       [34mexpect[m(result)[33m.[34mtoEqual[m({[K[66C
       [90m|[22X[31m[22C^[K[74C[m
    [90m216|[9X[m[9Cstatus[33m: [32m'healthy'[33m,[K[70C[m
    [90m217|[9X[m[9Cconnected[33m: [35mtrue[K[73C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[30/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mhealthCheck[2m > [22mshould return unhealthy status whe
[10;105Hen database is not accessible[77C
[31m[1mAssertionError[22m: expected { status: 'unhealthy', ‚Ä¶(2) } to deeply equal { status: 'unhealthy', ‚Ä¶(1) }     [m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[2m  {[22m[K[102C
[32m-   "connected": false,[82C[m
[31m+   "projectId": "unknown",[78C[m
[2m    "status": "unhealthy",[22m[K[79C
[31m+   "timestamp": 2025-07-30T04:00:50.589Z,[63C[m
[2m  }[22m[K[102C
[105C
[36m [2m‚ùØ[22m src/features/database.test.ts:[2m236:22[m[K[66C
    [90m234|       [35mconst [mresult [33m= [35mawait [mdatabaseService[33m.[34mhealthCheck[m()[33m;[K[39C[m
    [90m235|[K[97C[m
    [90m236|       [34mexpect[m(result)[33m.[34mtoEqual[m({[K[66C
       [90m|[22X[31m[22C^[K[74C[m
    [90m237|[9X[m[9Cstatus[33m: [32m'unhealthy'[33m,[K[68C[m
    [90m238|[9X[m[9Cconnected[33m: [35mfalse[K[72C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[31/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mhealthCheck[2m > [22mshould handle database initializat
[10;105Htion errors[95C
[31m[1mAssertionError[22m: expected { status: 'unhealthy', ‚Ä¶(2) } to deeply equal { status: 'unhealthy', ‚Ä¶(1) }     [m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[2m  {[22m[K[102C
[32m-   "connected": false,[82C[m
[31m+   "projectId": "unknown",[78C[m
[2m    "status": "unhealthy",[22m[K[79C
[31m+   "timestamp": 2025-07-30T04:00:50.619Z,[63C[m
[2m  }[22m[K[102C
[105C
[36m [2m‚ùØ[22m src/features/database.test.ts:[2m250:22[m[K[66C
[105C    [90m248|       [35mconst [mresult [33m= [35mawait [mdatabaseService[33m.[34mhealthCheck[m()[33m;[m
    [90m249|[K[97C[m
    [90m250|       [34mexpect[m(result)[33m.[34mtoEqual[m({[K[66C
       [90m|[22X[31m[22C^[K[74C[m
    [90m251|[9X[m[9Cstatus[33m: [32m'unhealthy'[33m,[K[68C[m
    [90m252|[9X[m[9Cconnected[33m: [35mfalse[K[72C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[32/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mclose[2m > [22mshould close all Firebase apps[K[10C
[105C[31m[1mAssertionError[22m: expected "spy" to be called at least once[m
[36m [2m‚ùØ[22m src/features/database.test.ts:[2m267:31[m[K[66C
[105C    [90m265|       [35mawait [mdatabaseService[33m.[34mclose[m()[33m;[m
    [90m266|[K[97C[m
    [90m267|       [34mexpect[m(mockApp1[33m.[35mdelete[m)[33m.[34mtoHaveBeenCalled[m()[33m;[K[47C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m268|       [34mexpect[m(mockApp2[33m.[35mdelete[m)[33m.[34mtoHaveBeenCalled[m()[33m;[K[47C[m
    [90m269|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[33/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mclose[2m > [22mshould handle apps array with null value
[10;105Hes[104C
[31m[1mAssertionError[22m: expected "spy" to be called at least once[K[48C[m
[36m [2m‚ùØ[22m src/features/database.test.ts:[2m279:30[m[K[66C
[105C    [90m277|       [35mawait [mdatabaseService[33m.[34mclose[m()[33m;[m
    [90m278|[K[97C[m
    [90m279|       [34mexpect[m(mockApp[33m.[35mdelete[m)[33m.[34mtoHaveBeenCalled[m()[33m;[K[48C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m280|       // Should not throw error for null app[K[52C[m
    [90m281|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[34/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22msingleton behavior[2m > [22mshould maintain singleton p
[10;105Hpattern across multiple requires[74C
[31m[1mError[22m: Database initialization failed[K[68C[m
[36m [2m‚ùØ[22m DatabaseService.<anonymous> src/features/database.test.ts:[2m245:15[m[K[38C
    [90m243|       // Mock getDb to throw an error[K[59C[m
    [90m244|       [mvi[33m.[34mspyOn[m(databaseService[33m, [32m'getDb'[m)[33m.[34mmockImplementation[m(() [33m=> [m{[K[29C
    [90m245|[9X[35m[9Cthrow new [33mError[m([32m'Database initialization failed'[m)[33m;[K[38C[m
       [90m|[15X[31m[15C^[K[81C[m
    [90m246|       [m})[33m;[K[87C[m
    [90m247|[K[97C[m
[105C[90m [2m‚ùØ[22m src/features/database.test.ts:[2m323:23[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[35/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/deliveryTrackingRoutes.test.ts[2m > [22mDelivery Tracking Routes[2m > [22mGET /orders/:orderId/deli
[10;105Hivery-tracking[2m > [22mshould handle server errors gracefully[K[51C
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[K[37C[m
[105C
[32m- Expected:[94C[m
false[100C
[105C
[31m+ Received:[94C[m
undefined[96C
[105C
[36m [2m‚ùØ[22m src/features/deliveryTrackingRoutes.test.ts:[2m119:37[m[K[52C
[105C    [90m117|[9X[33m[9C.[34mexpect[m([34m500[m)[33m;[m
    [90m118|[K[97C[m
    [90m119|       [34mexpect[m(response[33m.[mbody[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[48C[m
       [90m|[37X[31m[37C^[K[59C[m
    [90m120|       [34mexpect[m(response[33m.[mbody[33m.[merror)[33m.[34mtoBe[m([32m'Failed to fetch delivery tracking information'[m)[33m;        [m
    [90m121|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[36/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/deliveryTrackingRoutes.test.ts[2m > [22mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/del
[10;105Hlivery-location[2m > [22mshould reject requests with invalid coordinates[K[41C
[31m[1mError[22m: expected 400 "Bad Request", got 200 "OK"[K[58C[m
[105C[36m [2m‚ùØ[22m src/features/deliveryTrackingRoutes.test.ts:[2m186:12[m
    [90m184|[11X[33m[11C.[34mpost[m([32m'/orders/test-order-123/delivery-location'[m)[K[37C
    [90m185|[11X[33m[11C.[34msend[m(update)[K[73C
    [90m186|[11X[33m[11C.[34mexpect[m([34m400[m)[33m;[K[73C[m
       [90m|[12X[31m[12C^[K[84C[m
    [90m187|[K[97C[m
    [90m188|[9X[34m[9Cexpect[m(response[33m.[mbody[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[46C[m
[90m [2m‚ùØ[22m Test._assertStatus ../../node_modules/supertest/lib/test.js:[2m309:14[m[K[36C
[90m [2m‚ùØ[22m ../../node_modules/supertest/lib/test.js:[2m365:13[m[K[55C
[90m [2m‚ùØ[22m Test._assertFunction ../../node_modules/supertest/lib/test.js:[2m342:13[m[K[34C
[90m [2m‚ùØ[22m Test.assert ../../node_modules/supertest/lib/test.js:[2m195:23[m[K[43C
[90m [2m‚ùØ[22m localAssert ../../node_modules/supertest/lib/test.js:[2m138:14[m[K[43C
[90m [2m‚ùØ[22m Server.<anonymous> ../../node_modules/supertest/lib/test.js:[2m152:11[m[K[36C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[37/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/deliveryTrackingRoutes.test.ts[2m > [22mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/del
[10;105Hlivery-location[2m > [22mshould handle extreme but valid coordinate values[K[39C
[31m[1mError[22m: expected 200 "OK", got 400 "Bad Request"[K[58C[m
[36m [2m‚ùØ[22m src/features/deliveryTrackingRoutes.test.ts:[2m204:12[m[K[52C
    [90m202|[11X[33m[11C.[34mpost[m([32m'/orders/test-order-123/delivery-location'[m)[K[37C
    [90m203|[11X[33m[11C.[34msend[m(coords)[K[73C
    [90m204|[11X[33m[11C.[34mexpect[m([34m200[m)[33m;[K[73C[m
       [90m|[12X[31m[12C^[K[84C[m
    [90m205|[K[97C[m
    [90m206|[9X[34m[9Cexpect[m(response[33m.[mbody[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[47C[m
[90m [2m‚ùØ[22m Test._assertStatus ../../node_modules/supertest/lib/test.js:[2m309:14[m[K[36C
[90m [2m‚ùØ[22m ../../node_modules/supertest/lib/test.js:[2m365:13[m[K[55C
[90m [2m‚ùØ[22m Test._assertFunction ../../node_modules/supertest/lib/test.js:[2m342:13[m[K[34C
[90m [2m‚ùØ[22m Test.assert ../../node_modules/supertest/lib/test.js:[2m195:23[m[K]0;node (vitest 2)[43C
[90m [2m‚ùØ[22m localAssert ../../node_modules/supertest/lib/test.js:[2m138:14[m[K[43C
[90m [2m‚ùØ[22m Server.<anonymous> ../../node_modules/supertest/lib/test.js:[2m152:11[m[K[36C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[38/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/deliveryTrackingRoutes.test.ts[2m > [22mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/del
[10;105Hlivery-location[2m > [22mshould handle server errors during location update[K[38C
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[K[37C[m
[105C
[32m- Expected:[94C[m
false[100C
[105C
[31m+ Received:[94C[m
undefined[96C
[105C
[36m [2m‚ùØ[22m src/features/deliveryTrackingRoutes.test.ts:[2m225:37[m[K[52C
    [90m223|[9X[33m[9C.[34mexpect[m([34m500[m)[33m;[K[75C[m
    [90m224|[K[97C[m
    [90m225|       [34mexpect[m(response[33m.[mbody[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[48C[m
       [90m|[37X[31m[37C^[K[59C[m
    [90m226|       [34mexpect[m(response[33m.[mbody[33m.[merror)[33m.[34mtoBe[m([32m'Failed to update delivery location'[m)[33m;[K[19C[m
    [90m227|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/deliveryTrackingRoutes.test.ts[2m > [22mDelivery Tracking Routes[2m > [22mPOST /orders/:orderId/del
[10;105Hlivery-notifications[2m > [22mshould handle server errors during preference update[K[31C
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[K[37C[m
[105C
[32m- Expected:[94C[m
false[100C
[105C
[31m+ Received:[94C[m
undefined[96C
[105C
[36m [2m‚ùØ[22m src/features/deliveryTrackingRoutes.test.ts:[2m373:37[m[K[52C
    [90m371|[9X[33m[9C.[34mexpect[m([34m500[m)[33m;[K[75C[m
    [90m372|[K[97C[m
    [90m373|       [34mexpect[m(response[33m.[mbody[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[48C[m
       [90m|[37X[31m[37C^[K[59C[m
    [90m374|       [34mexpect[m(response[33m.[mbody[33m.[merror)[33m.[34mtoBe[m([32m'Failed to update notification preferences'[m)[33m;[K[12C[m
    [90m375|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[40/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mAuthentication[2m > [22mshou
[10;105Huld return 401 for missing authorization header[59C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mAuthentication[2m > [22mshou
[10;105Huld return 401 for invalid token format[67C
[105C[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mAuthentication[2m > [22mshou
[10;105Huld return 401 for invalid token[74C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mAuthentication[2m > [22mshou
[10;105Huld return 403 for non-doctor role[72C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mGET /api/doctor/patie
[10;105Hents[2m > [22mshould search patients successfully[K[64C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mGET /api/doctor/patie
[10;105Hents[2m > [22mshould return 400 for missing query parameter[K[54C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mGET /api/doctor/patie
[10;105Hents[2m > [22mshould return 400 for invalid search type[K[58C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mGET /api/doctor/patie
[10;105Hents[2m > [22mshould handle service errors[K[71C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mPOST /api/doctor/pres
[10;105Hscriptions[2m > [22mshould submit prescription successfully[K[54C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mPOST /api/doctor/pres
[10;105Hscriptions[2m > [22mshould return 400 for missing patient profile ID[K[45C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mPOST /api/doctor/pres
[10;105Hscriptions[2m > [22mshould return 400 for missing medication details[K[45C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mPOST /api/doctor/pres
[10;105Hscriptions[2m > [22mshould return 400 for invalid refills authorized[K[45C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mPOST /api/doctor/pres
[10;105Hscriptions[2m > [22mshould return 404 for non-existent patient profile[K[43C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mGET /api/doctor/presc
[10;105Hcriptions[2m > [22mshould get prescription history successfully[K[50C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mGET /api/doctor/presc
[10;105Hcriptions[2m > [22mshould return 400 for invalid page parameter[K[50C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mGET /api/doctor/presc
[10;105Hcriptions[2m > [22mshould return 400 for invalid limit parameter[K[49C
[41m[1m FAIL [m src/features/doctorPrescriptionRoutes.test.ts[2m > [22mDoctor Prescription Routes[2m > [22mGET /api/doctor/presc
[10;105Hcriptions[2m > [22mshould use default pagination values[K[58C
[31m[1mTypeError[22m: vi.mocked(...).mockImplementation is not a function[K[43C[m
[36m [2m‚ùØ[22m src/features/doctorPrescriptionRoutes.test.ts:[2m48:55[m[K[51C
[105C     [90m46|       [mverifyIdToken[33m: [mmockVerifyIdToken
     [90m47|     [m}))[33m;[K[88C[m
     [90m48|     [mvi[33m.[34mmocked[m([34mrequire[m([32m'firebase-admin'[m)[33m.[35mdefault[33m.[mauth)[33m.[34mmockImplementation[m(mockAuth)[33m;[K[13C[m
       [90m|[55X[31m[55C^[K[41C[m
     [90m49|[K[97C[m
     [90m50|     // Setup Firestore mock[K[69C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[41/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mGET /api/inventory/items[2m > [22mshould query 
[10;105H inventory items successfully[77C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mGET /api/inventory/items[2m > [22mshould handle
[10;105He query parameters correctly[78C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mGET /api/inventory/items[2m > [22mshould handle
[10;105He service errors[90C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mGET /api/inventory/pharmacies[2m > [22mshould g
[10;105Hget pharmacy locations successfully[71C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mGET /api/inventory/pharmacies[2m > [22mshould h
[10;105Hhandle service errors[85C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mPOST /api/inventory/sync[2m > [22mshould sync i
[10;105Hinventory successfully for pharmacist[69C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mPOST /api/inventory/sync[2m > [22mshould deny a
[10;105Haccess to non-pharmacist users[76C
[105C[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mPOST /api/inventory/sync[2m > [22mshould handle
[10;105He service errors[90C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mGET /api/inventory/health[2m > [22mshould check
[10;105Hk health status successfully for pharmacist[63C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mGET /api/inventory/health[2m > [22mshould deny 
[10;105H access to non-pharmacist users[75C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mGET /api/inventory/config[2m > [22mshould get c
[10;105Hconfiguration successfully for pharmacist[65C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mPOST /api/inventory/config/pharmacy[2m > [22msh
[10;105Hhould update pharmacy configuration successfully for pharmacist[43C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mPOST /api/inventory/config/pharmacy[2m > [22msh
[10;105Hhould validate required fields[76C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mPOST /api/inventory/config/pharmacy[2m > [22msh
[10;105Hhould handle service errors[79C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mDELETE /api/inventory/config/pharmacy/:p
[10;105HpharmacyId[2m > [22mshould remove pharmacy configuration successfully for pharmacist[K[29C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mDELETE /api/inventory/config/pharmacy/:p
[10;105HpharmacyId[2m > [22mshould handle non-existent pharmacy[K[58C
[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mGET /api/inventory/config/pharmacy/:phar
[10;105HrmacyId[2m > [22mshould get pharmacy configuration successfully for pharmacist[K[35C
[105C[41m[1m FAIL [m src/features/inventoryRoutes.test.ts[2m > [22mInventory Routes[2m > [22mGET /api/inventory/config/pharmacy/:phar
[10;105HrmacyId[2m > [22mshould handle non-existent pharmacy[K[61C
[31m[1mError[22m: Cannot find module './inventoryService'[K[59C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\inventoryRoutes.test.ts[34C[m
[36m [2m‚ùØ[22m src/features/inventoryRoutes.test.ts:[2m56:34[m[K[60C
     [90m54|[K[97C[m
     [90m55|     // Get the mocked service instance[K[58C[m
     [90m56|     [35mconst [m{ [33mInventoryService [m} [33m= [34mrequire[m([32m'./inventoryService'[m)[33m;[K[33C[m
       [90m|[34X[31m[34C^[K[62C[m
     [90m57|     [mmockInventoryService [33m= [35mnew [33mInventoryService[m()[33m;[K[46C[m
     [90m58|   [m})[33m;[K[91C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[42/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/notificationRoutes.test.ts[2m > [22mNotification Routes[2m > [22mGET /api/notifications/preferences
[10;105Hs/:patientProfileId[2m > [22mshould return notification preferences for a patient profile[K[24C
[31m[1mError[22m: Value for argument "collectionPath" is not a valid resource path. Path must be a non-empty string.[m
[105C[90m [2m‚ùØ[22m validateResourcePath ../../node_modules/@google-cloud/firestore/build/src/path.js:[2m483:15[m
[90m [2m‚ùØ[22m Firestore.collection ../../node_modules/@google-cloud/firestore/build/src/index.js:[2m725:41[m[K[13C
[36m [2m‚ùØ[22m src/features/notificationRoutes.test.ts:[2m73:21[m[K[57C
     [90m71|[9X[m[9C})[K[86C
     [90m72|       [m}[33m;[K[88C[m
     [90m73|       [mmockFirestore[33m.[34mcollection[m()[33m.[34mdoc[m()[33m.[35mget[33m.[34mmockResolvedValue[m(mockDoc)[33m;[K[26C[m
       [90m|[21X[31m[21C^[K[75C[m
     [90m74|[K[97C[m
     [90m75|       [35mconst [mresponse [33m= [35mawait [34mrequest[m(app)[K[55C
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[43/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/notificationRoutes.test.ts[2m > [22mNotification Routes[2m > [22mGET /api/notifications/preferences
[10;105Hs/:patientProfileId[2m > [22mshould return default preferences when none exist[K[35C
[31m[1mError[22m: Value for argument "collectionPath" is not a valid resource path. Path must be a non-empty string.[m
[90m [2m‚ùØ[22m validateResourcePath ../../node_modules/@google-cloud/firestore/build/src/path.js:[2m483:15[m[K[14C
[90m [2m‚ùØ[22m Firestore.collection ../../node_modules/@google-cloud/firestore/build/src/index.js:[2m725:41[m[K[13C
[36m [2m‚ùØ[22m src/features/notificationRoutes.test.ts:[2m93:21[m[K[57C
     [90m91|[9X[m[9Cdata[33m: [m() [33m=> [m({})[K[72C
     [90m92|       [m}[33m;[K[88C[m
     [90m93|       [mmockFirestore[33m.[34mcollection[m()[33m.[34mdoc[m()[33m.[35mget[33m.[34mmockResolvedValue[m(mockDoc)[33m;[K[26C[m
       [90m|[21X[31m[21C^[K[75C[m
     [90m94|[K[97C[m
     [90m95|       [35mconst [mresponse [33m= [35mawait [34mrequest[m(app)[K[55C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[44/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/notificationRoutes.test.ts[2m > [22mNotification Routes[2m > [22mGET /api/notifications/preferences
[10;105Hs/:patientProfileId[2m > [22mshould return 404 when patient profile not found[K[36C
[31m[1mError[22m: Value for argument "collectionPath" is not a valid resource path. Path must be a non-empty string.[m
[105C[90m [2m‚ùØ[22m validateResourcePath ../../node_modules/@google-cloud/firestore/build/src/path.js:[2m483:15[m
[90m [2m‚ùØ[22m Firestore.collection ../../node_modules/@google-cloud/firestore/build/src/index.js:[2m725:41[m[K[13C
[36m [2m‚ùØ[22m src/features/notificationRoutes.test.ts:[2m111:21[m[K[56C
    [90m109|[9X[m[9Cexists[33m: [35mfalse[K[75C[m
    [90m110|       [m}[33m;[K[88C[m
    [90m111|       [mmockFirestore[33m.[34mcollection[m()[33m.[34mdoc[m()[33m.[35mget[33m.[34mmockResolvedValue[m(mockDoc)[33m;[K[26C[m
       [90m|[21X[31m[21C^[K[75C[m
    [90m112|[K[97C[m
    [90m113|       [35mconst [mresponse [33m= [35mawait [34mrequest[m(app)[K[55C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[45/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/notificationRoutes.test.ts[2m > [22mNotification Routes[2m > [22mPUT /api/notifications/preferences
[10;105Hs/:patientProfileId[2m > [22mshould update notification preferences successfully[K[33C
[31m[1mError[22m: Value for argument "collectionPath" is not a valid resource path. Path must be a non-empty string.[m
[90m [2m‚ùØ[22m validateResourcePath ../../node_modules/@google-cloud/firestore/build/src/path.js:[2m483:15[m[K[14C
[90m [2m‚ùØ[22m Firestore.collection ../../node_modules/@google-cloud/firestore/build/src/index.js:[2m725:41[m[K[13C
[105C[36m [2m‚ùØ[22m src/features/notificationRoutes.test.ts:[2m134:21[m
    [90m132|[9X[m[9C})[K[86C
    [90m133|       [m}[33m;[K[88C[m
    [90m134|       [mmockFirestore[33m.[34mcollection[m()[33m.[34mdoc[m()[33m.[35mget[33m.[34mmockResolvedValue[m(mockDoc)[33m;[K[26C[m
       [90m|[21X[31m[21C^[K[75C[m
    [90m135|[K[97C[m
    [90m136|       [mmockNotificationService[33m.[mupdateNotificationPreferences[33m.[34mmockResolvedValue[m([35mtrue[m)[33m;[K[12C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[46/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/notificationRoutes.test.ts[2m > [22mNotification Routes[2m > [22mPUT /api/notifications/preferences
[10;105Hs/:patientProfileId[2m > [22mshould handle service errors[K[56C
[31m[1mError[22m: Value for argument "collectionPath" is not a valid resource path. Path must be a non-empty string.[m
[90m [2m‚ùØ[22m validateResourcePath ../../node_modules/@google-cloud/firestore/build/src/path.js:[2m483:15[m[K[14C
[105C[90m [2m‚ùØ[22m Firestore.collection ../../node_modules/@google-cloud/firestore/build/src/index.js:[2m725:41[m
[36m [2m‚ùØ[22m src/features/notificationRoutes.test.ts:[2m205:21[m[K[56C
    [90m203|[9X[m[9C})[K[86C
    [90m204|       [m}[33m;[K[88C[m
    [90m205|       [mmockFirestore[33m.[34mcollection[m()[33m.[34mdoc[m()[33m.[35mget[33m.[34mmockResolvedValue[m(mockDoc)[33m;[K[26C[m
       [90m|[21X[31m[21C^[K[75C[m
    [90m206|[K[97C[m
    [90m207|       [mmockNotificationService[33m.[mupdateNotificationPreferences[33m.[34mmockResolvedValue[m([35mfalse[m)[33m;[K[11C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[47/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/notificationRoutes.test.ts[2m > [22mNotification Routes[2m > [22mGET /api/notifications/history/:pa
[10;105HatientProfileId[2m > [22mshould return notification history[K[54C
[31m[1mAssertionError[22m: expected undefined to deeply equal [ { notificationId: 'notif-1', ‚Ä¶(5) } ][K[15C[m
[105C
[32m- Expected:[94C[m
[[104C
  {[102C
    "notificationId": "notif-1",[73C
    "notificationType": "sms",[75C
    "patientProfileId": "patient-123",[67C
    "prescriptionId": "prescription-456",[64C
    "sentAt": 2024-01-15T10:00:00.000Z,[66C
    "status": "sent",[84C
  },[101C
][104C
[105C
[31m+ Received:[94C[m
undefined[96C
[105C
[36m [2m‚ùØ[22m src/features/notificationRoutes.test.ts:[2m244:34[m[K[56C
[105C    [90m242| [m
    [90m243|       [34mexpect[m(response[33m.[mbody[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[49C[m
    [90m244|       [34mexpect[m(response[33m.[mbody[33m.[mdata)[33m.[34mtoEqual[m(mockNotifications)[33m;[K[36C[m
       [90m|[34X[31m[34C^[K[62C[m
    [90m245|       [mexpect(mockNotificationService.getNotificationHistory).toHaveBeenCalledWith('patient-123'‚Ä¶
    [90m246|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[48/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/notificationRoutes.test.ts[2m > [22mNotification Routes[2m > [22mGET /api/notifications/history/:pa
[10;105HatientProfileId[2m > [22mshould use default limit when not provided[K[46C
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'patient-123', 50 ][K[24C[m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[36m [2m‚ùØ[22m src/features/notificationRoutes.test.ts:[2m264:62[m[K[56C
    [90m262|[9X[33m[9C.[34mexpect[m([34m200[m)[33m;[K[75C[m
    [90m263|[K[97C[m
    [90m264|       [mexpect(mockNotificationService.getNotificationHistory).toHaveBeenCalledWith('patient-123'‚Ä¶
       [90m|[62X[31m[62C^[K[34C[m
    [90m265|     [m})[33m;[K[89C[m
    [90m266|   [m})[33m;[K[91C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[49/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/notificationRoutes.test.ts[2m > [22mNotification Routes[2m > [22mPOST /api/notifications/:notificat
[10;105HtionId/status[2m > [22mshould update notification status successfully[K[44C
[31m[1mError[22m: expected 200 "OK", got 500 "Internal Server Error"[K[48C[m
[36m [2m‚ùØ[22m src/features/notificationRoutes.test.ts:[2m277:10[m[K[56C
    [90m275|[11X[m[11Cstatus[33m: [32m'delivered'[K[67C[m
    [90m276|[9X[m[9C})[K[86C
    [90m277|[9X[33m[9C.[34mexpect[m([34m200[m)[33m;[K[75C[m
       [90m|[10X[31m[10C^[K[86C[m
    [90m278|[K[97C[m
    [90m279|       [34mexpect[m(response[33m.[mbody[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[49C[m
[105C[90m [2m‚ùØ[22m Test._assertStatus ../../node_modules/supertest/lib/test.js:[2m309:14[m
[90m [2m‚ùØ[22m ../../node_modules/supertest/lib/test.js:[2m365:13[m[K[55C
[90m [2m‚ùØ[22m Test._assertFunction ../../node_modules/supertest/lib/test.js:[2m342:13[m[K[34C
[90m [2m‚ùØ[22m Test.assert ../../node_modules/supertest/lib/test.js:[2m195:23[m[K[43C
[90m [2m‚ùØ[22m localAssert ../../node_modules/supertest/lib/test.js:[2m138:14[m[K[43C
[90m [2m‚ùØ[22m Server.<anonymous> ../../node_modules/supertest/lib/test.js:[2m152:11[m[K[36C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[50/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/notificationRoutes.test.ts[2m > [22mNotification Routes[2m > [22mPOST /api/notifications/:notificat
[10;105HtionId/status[2m > [22mshould include error message when provided[K[48C
[31m[1mError[22m: expected 200 "OK", got 500 "Internal Server Error"[K[48C[m
[36m [2m‚ùØ[22m src/features/notificationRoutes.test.ts:[2m336:10[m[K[56C
    [90m334|[11X[m[11CerrorMessage[33m: [32m'Message delivery failed'[K[47C[m
    [90m335|[9X[m[9C})[K[86C
    [90m336|[9X[33m[9C.[34mexpect[m([34m200[m)[33m;[K[75C[m
       [90m|[10X[31m[10C^[K[86C[m
    [90m337|[K[97C[m
    [90m338|       [34mexpect[m(mockNotificationService[33m.[mupdateNotificationStatus)[33m.[34mtoHaveBeenCalledWith[m([K[12C
[90m [2m‚ùØ[22m Test._assertStatus ../../node_modules/supertest/lib/test.js:[2m309:14[m[K[36C
[105C[90m [2m‚ùØ[22m ../../node_modules/supertest/lib/test.js:[2m365:13[m
[90m [2m‚ùØ[22m Test._assertFunction ../../node_modules/supertest/lib/test.js:[2m342:13[m[K[34C
[90m [2m‚ùØ[22m Test.assert ../../node_modules/supertest/lib/test.js:[2m195:23[m[K[43C
[90m [2m‚ùØ[22m localAssert ../../node_modules/supertest/lib/test.js:[2m138:14[m[K[43C
[105C[90m [2m‚ùØ[22m Server.<anonymous> ../../node_modules/supertest/lib/test.js:[2m152:11[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[51/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mReal-world prescription text extract
[10;105Htion[2m > [22mshould extract text from prescription image[K[56C
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m97:30[m[K[61C
[105C     [90m95|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mprocessImage[m(request)[33m;[m
     [90m96|[K[97C[m
     [90m97|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
     [90m98|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(prescriptionText)[33m;[K[38C[m
     [90m99|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoContain[m([32m'Amoxicillin 500mg'[m)[33m;[K[30C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[52/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mReal-world prescription text extract
[10;105Htion[2m > [22mshould handle handwritten prescription with lower confidence[K[39C
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m128:30[m[K[60C
    [90m126|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mprocessImage[m(request)[33m;[K[36C[m
    [90m127|[K[97C[m
    [90m128|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m129|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(handwrittenText)[33m;[K[39C[m
    [90m130|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoContain[m([32m'Lisinopril'[m)[33m;[K[37C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[53/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mReal-world prescription text extract
[10;105Htion[2m > [22mshould handle poor quality image with partial text[K[49C
[105C[31m[1mAssertionError[22m: expected false to be true // Object.is equality[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m155:30[m[K[60C
    [90m153|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mprocessImage[m(request)[33m;[K[36C[m
    [90m154|[K[97C[m
    [90m155|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m156|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(partialText)[33m;[K[43C[m
    [90m157|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoContain[m([32m'[UNCLEAR]'[m)[33m;[K[38C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[54/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mGoogle Cloud Vision API error scenar
[10;105Hrios[2m > [22mshould handle QUOTA_EXCEEDED error[K[65C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'Quota exceeded'[K[12C[m
[105C
Expected: [32m"Quota exceeded"[K[79C[m
Received: [31m"OCR failed after 3 attempts. Last error: (intermediate value) is not iterable"[K[16C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m177:28[m[K[60C
    [90m175|[K[97C[m
    [90m176|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m177|       [34mexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'Quota exceeded'[m)[33m;[K[41C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m178|     [m})[33m;[K[89C[m
    [90m179|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[55/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mGoogle Cloud Vision API error scenar
[10;105Hrios[2m > [22mshould handle PERMISSION_DENIED error[K[62C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'permission'[K[16C[m
[105C
Expected: [32m"permission"[K[83C[m
Received: [31m"OCR failed after 3 attempts. Last error: (intermediate value) is not iterable"[K[16C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m195:28[m[K[60C
    [90m193|[K[97C[m
    [90m194|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m195|       [34mexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'permission'[m)[33m;[K[45C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m196|     [m})[33m;[K[89C[m
    [90m197|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[56/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mGoogle Cloud Vision API error scenar
[10;105Hrios[2m > [22mshould handle INVALID_ARGUMENT for unsupported image format[K[40C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'Invalid image format'      [m
[105C
Expected: [32m"Invalid image format"[K[73C[m
Received: [31m"OCR failed after 3 attempts. Last error: (intermediate value) is not iterable"[K[16C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m213:28[m[K[60C
[105C    [90m211| [m
    [90m212|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m213|       [34mexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'Invalid image format'[m)[33m;[K[35C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m214|     [m})[33m;[K[89C[m
    [90m215|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[57/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mGoogle Cloud Vision API error scenar
[10;105Hrios[2m > [22mshould handle network timeout errors[K[63C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'Deadline exceeded'[K[9C[m
[105C
Expected: [32m"Deadline exceeded"[K[76C[m
Received: [31m"OCR failed after 3 attempts. Last error: (intermediate value) is not iterable"[K[16C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m231:28[m[K[60C
    [90m229|[K[97C[m
    [90m230|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m231|       [34mexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'Deadline exceeded'[m)[33m;[K[38C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m232|     [m})[33m;[K[89C[m
    [90m233|   [m})[33m;[K[91C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[58/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mRetry logic with transient failures[2m [22m
[2m[10;105H > [22mshould succeed after transient network error[K[59C
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m257:30[m[K[60C
[105C    [90m255|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mprocessImage[m(request)[33m;[m
    [90m256|[K[97C[m
    [90m257|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m258|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(prescriptionText)[33m;[K[38C[m
    [90m259|       [34mexpect[m(mockTextDetection)[33m.[34mtoHaveBeenCalledTimes[m([34m2[m)[33m;[K[39C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[59/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mRetry logic with transient failures[2m [22m
[2m[10;105H > [22mshould fail after max retries with persistent error[K[52C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'Internal server error'     [m
[105C
Expected: [32m"Internal server error"[K[72C[m
Received: [31m"OCR failed after 3 attempts. Last error: (intermediate value) is not iterable"[K[16C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m279:28[m[K[60C
    [90m277|[K[97C[m
    [90m278|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m279|       [34mexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'Internal server error'[m)[33m;[K[34C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m280|       [34mexpect[m(mockTextDetection)[33m.[34mtoHaveBeenCalledTimes[m([34m3[m)[33m; [90m// maxRetries[K[25C[m
    [90m281|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[60/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mImage format handling[2m > [22mshould proce
[10;105Hess JPEG images successfully[78C
[105C[31m[1mAssertionError[22m: expected false to be true // Object.is equality[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m299:30[m[K[60C
    [90m297|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mprocessImage[m(request)[33m;[K[36C[m
    [90m298|[K[97C[m
    [90m299|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m300|       [34mexpect[m(mockTextDetection)[33m.[34mtoHaveBeenCalledWith[m({[K[42C
    [90m301|[9X[m[9Cimage[33m: [m{ source[33m: [m{ imageUri[33m: [mrequest[33m.[mimageUrl } }[33m,[K[38C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[61/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mImage format handling[2m > [22mshould proce
[10;105Hess PNG images successfully[79C
[105C[31m[1mAssertionError[22m: expected false to be true // Object.is equality[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m320:30[m[K[60C
    [90m318|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mprocessImage[m(request)[33m;[K[36C[m
    [90m319|[K[97C[m
    [90m320|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m321|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(extractedText)[33m;[K[41C[m
    [90m322|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[62/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mImage format handling[2m > [22mshould proce
[10;105Hess PDF documents successfully[76C
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m338:30[m[K[60C
    [90m336|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mprocessImage[m(request)[33m;[K[36C[m
    [90m337|[K[97C[m
    [90m338|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m339|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(extractedText)[33m;[K[41C[m
    [90m340|     [m})[33m;[K[89C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[63/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mPerformance and scalability[2m > [22mshould
[10;105Hd handle large prescription images[72C
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m363:30[m[K[60C
[105C    [90m361|       [35mconst [mduration [33m= Date.[34mnow[m() [33m- [mstartTime[33m;[m
    [90m362|[K[97C[m
    [90m363|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m364|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(largeText)[33m;[K[45C[m
    [90m365|       [34mexpect[m(duration)[33m.[34mtoBeLessThan[m([34m10000[m)[33m; [90m// Should complete within 10 seconds[K[16C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[64/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mPerformance and scalability[2m > [22mshould
[10;105Hd handle concurrent OCR requests[74C
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m392:32[m[K[60C
    [90m390|       [34mexpect[m(results)[33m.[34mtoHaveLength[m([34m3[m)[33m;[K[58C[m
    [90m391|       [mresults[33m.[34mforEach[m((result[33m, [mindex) [33m=> [m{[K[54C
    [90m392|[9X[34m[9Cexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[54C[m
       [90m|[32X[31m[32C^[K[64C[m
    [90m393|[9X[34m[9Cexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(mockTexts[index])[33m;[K[36C[m
    [90m394|       [m})[33m;[K[87C[m
[90m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m391:15[m[K[60C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[65/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mHealth check integration[2m > [22mshould ve
[10;105Herify service connectivity[80C
[31m[1mAssertionError[22m: expected "spy" to be called at least once[K[48C[m
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m408:32[m[K[60C
    [90m406|[K[97C[m
    [90m407|       [34mexpect[m(isHealthy)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[61C[m
    [90m408|       [34mexpect[m(mockGetProjectId)[33m.[34mtoHaveBeenCalled[m()[33m;[K[46C[m
       [90m|[32X[31m[32C^[K[64C[m
    [90m409|     [m})[33m;[K[89C[m
    [90m410|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[66/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mHealth check integration[2m > [22mshould de
[10;105Hetect service unavailability[78C
[105C[31m[1mAssertionError[22m: expected true to be false // Object.is equality[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- false[98C[m
[31m+ true[99C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m416:25[m[K[60C
    [90m414|       [35mconst [misHealthy [33m= [35mawait [mocrService[33m.[34mhealthCheck[m()[33m;[K[41C[m
    [90m415|[K[97C[m
    [90m416|       [34mexpect[m(isHealthy)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[60C[m
       [90m|[25X[31m[25C^[K[71C[m
    [90m417|     [m})[33m;[K[89C[m
    [90m418|   [m})[33m;[K[91C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[67/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mEdge cases and boundary conditions[2m >[22m
[2m[10;105H>
 [22mshould handle images with no text[K[71C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'No text detected'[K[10C[m
[105C
Expected: [32m"No text detected"[K[77C[m
Received: [31m"OCR failed after 3 attempts. Last error: (intermediate value) is not iterable"[K[16C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m434:28[m[K[60C
[105C    [90m432| [m
    [90m433|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m434|       [34mexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'No text detected'[m)[33m;[K[39C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m435|     [m})[33m;[K[89C[m
    [90m436|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[68/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m > [22mOCR Integration Tests[2m > [22mEdge cases and boundary conditions[2m >[22m
[2m[10;105H>
 [22mshould handle corrupted image responses[K[65C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'Empty text extracted'      [m
[105C
Expected: [32m"Empty text extracted"[K[73C[m
Received: [31m"OCR failed after 3 attempts. Last error: (intermediate value) is not iterable"[K[16C[m
[105C
[105C[36m [2m‚ùØ[22m src/features/ocrIntegration.test.ts:[2m450:28[m
    [90m448|[K[97C[m
    [90m449|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m450|       [34mexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'Empty text extracted'[m)[33m;[K[35C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m451|     [m})[33m;[K[89C[m
    [90m452|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[69/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrRoutes.test.ts[2m > [22mOCR Routes[2m > [22merror handling[2m > [22mshould handle invalid JSON in reque
[10;105Hest body[98C
[105C[31m[1mError[22m: expected 400 "Bad Request", got 500 "Internal Server Error"[m
[36m [2m‚ùØ[22m src/features/ocrRoutes.test.ts:[2m430:10[m[K[65C
[105C    [90m428|[9X[33m[9C.[34mpost[m([32m'/api/orders/test/process-ocr'[m)
    [90m429|[9X[33m[9C.[34msend[m([32m'invalid json'[m)[K[67C
    [90m430|[9X[33m[9C.[34mexpect[m([34m400[m)[33m;[K[75C[m
       [90m|[10X[31m[10C^[K[86C[m
    [90m431|     [m})[33m;[K[89C[m
    [90m432|[K[97C[m
[90m [2m‚ùØ[22m Test._assertStatus ../../node_modules/supertest/lib/test.js:[2m309:14[m[K[36C
[90m [2m‚ùØ[22m ../../node_modules/supertest/lib/test.js:[2m365:13[m[K[55C
[90m [2m‚ùØ[22m Test._assertFunction ../../node_modules/supertest/lib/test.js:[2m342:13[m[K[34C
[90m [2m‚ùØ[22m Test.assert ../../node_modules/supertest/lib/test.js:[2m195:23[m[K[43C
[90m [2m‚ùØ[22m localAssert ../../node_modules/supertest/lib/test.js:[2m138:14[m[K[43C
[90m [2m‚ùØ[22m Server.<anonymous> ../../node_modules/supertest/lib/test.js:[2m152:11[m[K[36C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[70/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould successfully extract text fro
[10;105Hom image[98C
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m70:30[m[K[65C
[105C     [90m68|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mprocessImage[m(mockRequest)[33m;[m
     [90m69|[K[97C[m
     [90m70|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
     [90m71|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(mockExtractedText)[33m;[K[37C[m
     [90m72|       [34mexpect[m(result[33m.[merror)[33m.[34mtoBeUndefined[m()[33m;[K[53C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[71/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould handle empty text detection r
[10;105Hresults[99C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to be 'OCR failed after 3 attempts. Las[m
[31m[10;105Hst err‚Ä¶' // Object.is equality[76C[m
[105C
Expected: [32m"OCR failed after 3 attempts. Last error: [7mNo text detected in the imag[27me"[K[23C[m
Received: [31m"OCR failed after 3 attempts. Last error: [7m(intermediate value) is not iterabl[27me"[K[16C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m87:28[m[K[65C
     [90m85|[K[97C[m
     [90m86|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
     [90m87|       [mexpect(result.error).toBe('OCR failed after 3 attempts. Last error: No text detected in t‚Ä¶
       [90m|[28X[31m[28C^[K[68C[m
     [90m88|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBeUndefined[m()[33m;[K[45C[m
     [90m89|     [m})[33m;[K[89C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[72/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould handle empty extracted text  
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to be 'OCR failed after 3 attempts. Las[m
[31m[10;105Hst err‚Ä¶' // Object.is equality[76C[m
[105C
Expected: [32m"OCR failed after 3 attempts. Last error: [7mEmpty text extracted from imag[27me"[K[21C[m
Received: [31m"OCR failed after 3 attempts. Last error: [7m(intermediate value) is not iterabl[27me"[K[16C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m101:28[m[K[64C
     [90m99|[K[97C[m
    [90m100|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m101|       [mexpect(result.error).toBe('OCR failed after 3 attempts. Last error: Empty text extracted ‚Ä¶
       [90m|[28X[31m[28C^[K[68C[m
    [90m102|     [m})[33m;[K[89C[m
    [90m103|[K[97C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[73/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould retry on transient failures  
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m118:30[m[K[64C
    [90m116|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mprocessImage[m(mockRequest)[33m;[K[32C[m
    [90m117|[K[97C[m
    [90m118|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m119|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(mockExtractedText)[33m;[K[37C[m
    [90m120|       [34mexpect[m(mockTextDetection)[33m.[34mtoHaveBeenCalledTimes[m([34m2[m)[33m;[K[39C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[74/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould fail after max retries       
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to be 'OCR failed after 3 attempts. Las[m
[31m[10;105Hst err‚Ä¶' // Object.is equality[76C[m
[105C
Expected: [32m"OCR failed after 3 attempts. Last error: [7mPersistent API error[27m"[K[32C[m
Received: [31m"OCR failed after 3 attempts. Last error: [7m(intermediate value) is not iterable[27m"[K[16C[m
[105C
[105C[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m130:28[m
    [90m128|[K[97C[m
    [90m129|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m130|       [mexpect(result.error).toBe('OCR failed after 3 attempts. Last error: Persistent API error'‚Ä¶
       [90m|[28X[31m[28C^[K[68C[m
    [90m131|       [34mexpect[m(mockTextDetection)[33m.[34mtoHaveBeenCalledTimes[m([34m3[m)[33m;[K[39C[m
    [90m132|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[75/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould handle Vision API errors grac
[10;105Hcefully[99C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'QUOTA_EXCEEDED'[K[12C[m
[105C
Expected: [32m"QUOTA_EXCEEDED"[K[79C[m
Received: [31m"OCR failed after 3 attempts. Last error: (intermediate value) is not iterable"[K[16C[m
[105C
[105C[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m140:28[m
    [90m138|[K[97C[m
    [90m139|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m140|       [34mexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'QUOTA_EXCEEDED'[m)[33m;[K[41C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m141|     [m})[33m;[K[89C[m
    [90m142|   [m})[33m;[K[91C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[76/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mhealthCheck[2m > [22mshould return true when service is he
[10;105Healthy[100C
[31m[1mAssertionError[22m: expected "spy" to be called at least once[K[48C[m
[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m211:32[m[K[64C
    [90m209|[K[97C[m
    [90m210|       [34mexpect[m(result)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[64C[m
    [90m211|       [34mexpect[m(mockGetProjectId)[33m.[34mtoHaveBeenCalled[m()[33m;[K[46C[m
       [90m|[32X[31m[32C^[K[64C[m
    [90m212|     [m})[33m;[K[89C[m
    [90m213|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[77/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mhealthCheck[2m > [22mshould return false when service is u
[10;105Hunhealthy[97C
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- false[98C[m
[31m+ true[99C[m
[105C
[105C[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m219:22[m
    [90m217|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mhealthCheck[m()[33m;[K[44C[m
    [90m218|[K[97C[m
    [90m219|       [34mexpect[m(result)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[63C[m
       [90m|[22X[31m[22C^[K[74C[m
    [90m220|     [m})[33m;[K[89C[m
    [90m221|   [m})[33m;[K[91C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[78/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22merror scenarios[2m > [22mshould handle malformed Vision AP
[10;105HPI responses[94C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'No text detected in the ima[m
[31m[10;105Hage'[102C[m
[105C
Expected: [32m"[7mNo text detected in the imag[27me"[K[64C[m
Received: [31m"[7mOCR failed after 3 attempts. Last error: (intermediate value) is not iterabl[27me"[K[16C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m233:28[m[K[64C
    [90m231|[K[97C[m
    [90m232|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m233|       [34mexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'No text detected in the image'[m)[33m;[K[26C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m234|     [m})[33m;[K[89C[m
    [90m235|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[79/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22merror scenarios[2m > [22mshould handle network timeouts   
[105C[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err‚Ä¶' to contain 'TIMEOUT'[m
[105C
Expected: [32m"TIMEOUT"[K[86C[m
Received: [31m"OCR failed after 3 attempts. Last error: (intermediate value) is not iterable"[K[16C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m256:28[m[K[64C
    [90m254|[K[97C[m
    [90m255|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m256|       [34mexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'TIMEOUT'[m)[33m;[K[48C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m257|     [m})[33m;[K[89C[m
    [90m258|   [m})[33m;[K[91C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[80/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mperformance considerations[2m > [22mshould process image w
[10;105Hwithin reasonable time[84C
[105C[31m[1mAssertionError[22m: expected false to be true // Object.is equality[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m274:30[m[K[64C
[105C    [90m272|       [35mconst [mduration [33m= Date.[34mnow[m() [33m- [mstartTime[33m;[m
    [90m273|[K[97C[m
    [90m274|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m275|       [34mexpect[m(duration)[33m.[34mtoBeLessThan[m([34m5000[m)[33m; [90m// Should finish within 5 seconds[K[20C[m
    [90m276|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[81/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mperformance considerations[2m > [22mshould handle large te
[10;105Hext extraction[92C
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m‚ùØ[22m src/features/ocrService.test.ts:[2m289:30[m[K[64C
[105C    [90m287|       [m})[33m;[m
    [90m288|[K[97C[m
    [90m289|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m290|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(largeText)[33m;[K[45C[m
    [90m291|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[82/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/paymentService.test.ts[2m > [22mPaymentService[2m > [22mprocessPayment[2m > [22mshould validate order exis
[10;105Hsts and is in correct state[79C
[31m[1mAssertionError[22m: promise resolved "{ paymentId: 'mock-doc-id', ‚Ä¶(3) }" instead of rejecting[K[15C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- Error {[96C[m
[32m-   "message": "rejected promise",[71C[m
[31m+ {[102C[m
[31m+   "gatewayResponse": {[81C[m
[31m+     "amount": 4550,[84C[m
[31m+     "created": 1753848044,[77C[m
[31m+     "currency": "usd",[81C[m
[31m+     "id": "ch_5awvfea7axt",[76C[m
[31m+     "payment_method": {[80C[m
[31m+       "card": {[88C[m
[31m+         "brand": "visa",[79C[m
[31m+         "last4": "4242",[79C[m
[31m+       },[95C[m
[31m+     },[97C[m
[31m+     "status": "succeeded",[77C[m
[31m+   },[99C[m
[31m+   "paymentId": "mock-doc-id",[74C[m
[31m+   "status": "succeeded",[79C[m
[31m+   "transactionId": "ch_5awvfea7axt",[67C[m
[2m  }[22m[K[102C
[105C
[105C[36m [2m‚ùØ[22m src/features/paymentService.test.ts:[2m211:75[m
[105C    [90m209|       [m}[33m;[m
    [90m210|[K[97C[m
    [90m211|       [35mawait [34mexpect[m(paymentService[33m.[34mprocessPayment[m(request[33m, [32m'test-user-123'[m))[K[21C
       [90m|[75X[31m[75C^[K[21C[m
    [90m212|[9X[33m[9C.[mrejects[33m.[34mtoThrow[m([32m'Order validation failed: Order not found'[m)[33m;[K[27C[m
    [90m213|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[83/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/paymentService.test.ts[2m > [22mPaymentService[2m > [22mgetPayment[2m > [22mshould return payment when it 
[10;105H exists[99C
[31m[1mAssertionError[22m: expected { orderId: 'test-order-1', ‚Ä¶(2) } to deeply equal { paymentId: 'test-payment-1',[m
[31m[10;105H, ‚Ä¶(3) }[98C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[2m  {[22m[K[102C
[32m-   "amount": 45.5,[86C[m
[31m+   "cost": 45.5,[88C[m
[2m    "orderId": "test-order-1",[22m[K[75C
[32m-   "paymentId": "test-payment-1",[71C[m
[32m-   "status": "succeeded",[79C[m
[31m+   "status": "awaiting_payment",[72C[m
[2m  }[22m[K[102C
[105C
[36m [2m‚ùØ[22m src/features/paymentService.test.ts:[2m269:22[m[K[60C
    [90m267|       [35mconst [mresult [33m= [35mawait [mpaymentService[33m.[34mgetPayment[m([32m'test-payment-1'[m)[33m;[K[25C[m
    [90m268|[K[97C[m
    [90m269|       [34mexpect[m(result)[33m.[34mtoEqual[m(mockPayment)[33m;[K[54C[m
       [90m|[22X[31m[22C^[K[74C[m
    [90m270|     [m})[33m;[K[89C[m
    [90m271|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[84/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/paymentService.test.ts[2m > [22mPaymentService[2m > [22mgetPayment[2m > [22mshould return null when paymen
[10;105Hnt does not exist[89C
[105C[31m[1mAssertionError[22m: expected { orderId: 'test-order-1', ‚Ä¶(2) } to be null[m
[105C
[32m- Expected:[94C[m
null[101C
[105C
[31m+ Received:[94C[m
{[104C
  "cost": 45.5,[90C
  "orderId": "test-order-1",[77C
  "status": "awaiting_payment",[74C
}[104C
[105C
[36m [2m‚ùØ[22m src/features/paymentService.test.ts:[2m285:22[m[K[60C
    [90m283|       [35mconst [mresult [33m= [35mawait [mpaymentService[33m.[34mgetPayment[m([32m'non-existent-payment'[m)[33m;[K[19C[m
    [90m284|[K[97C[m
    [90m285|       [34mexpect[m(result)[33m.[34mtoBeNull[m()[33m;[K[64C[m
       [90m|[22X[31m[22C^[K[74C[m
    [90m286|     [m})[33m;[K[89C[m
    [90m287|   [m})[33m;[K[91C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[85/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/paymentService.test.ts[2m > [22mPaymentService[2m > [22mgetPaymentsForOrder[2m > [22mshould return payment
[10;105Hts for an order[91C
[31m[1mAssertionError[22m: expected [] to deeply equal [ ‚Ä¶(2) ][K[53C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- [[102C[m
[32m-   {[100C[m
[32m-     "amount": 45.5,[84C[m
[32m-     "orderId": "test-order-1",[73C[m
[32m-     "paymentId": "payment-1",[74C[m
[32m-     "status": "succeeded",[77C[m
[32m-   },[99C[m
[32m-   {[100C[m
[32m-     "amount": 45.5,[84C[m
[32m-     "orderId": "test-order-1",[73C[m
[32m-     "paymentId": "payment-2",[74C[m
[32m-     "status": "failed",[80C[m
[32m-   },[99C[m
[32m- ][102C[m
[31m+ [][101C[m
[105C
[36m [2m‚ùØ[22m src/features/paymentService.test.ts:[2m326:22[m[K[60C
    [90m324|       [35mconst [mresult [33m= [35mawait [mpaymentService[33m.[34mgetPaymentsForOrder[m([32m'test-order-1'[m)[33m;[K[18C[m
    [90m325|[K[97C[m
    [90m326|       [34mexpect[m(result)[33m.[34mtoEqual[m(mockPayments)[33m;[K[53C[m
       [90m|[22X[31m[22C^[K[74C[m
    [90m327|       [34mexpect[m(mockWhere)[33m.[34mtoHaveBeenCalledWith[m([32m'orderId'[33m, [32m'=='[33m, [32m'test-order-1'[m)[33m;[K[18C[m
    [90m328|       [34mexpect[m(mockOrderBy)[33m.[34mtoHaveBeenCalledWith[m([32m'createdAt'[33m, [32m'desc'[m)[33m;[K[28C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[86/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/paymentService.test.ts[2m > [22mPaymentService[2m > [22mprocessWebhook[2m > [22mshould process Stripe webh
[10;105Hhook successfully[89C
[31m[1mAssertionError[22m: promise rejected "Error: Payment not found for transaction ‚Ä¶" instead of resolving       [m
[36m [2m‚ùØ[22m src/features/paymentService.test.ts:[2m372:93[m[K[60C
[105C    [90m370|       [m})[33m;[m
    [90m371|[K[97C[m
    [90m372|       [35mawait [34mexpect[m(paymentService[33m.[34mprocessWebhook[m([32m'stripe'[33m, [mstripePayload[33m, [32m'valid-signature'[m))   
       [90m|[93X[31m[93C^   [m
    [90m373|[9X[33m[9C.[mresolves[33m.[mnot[33m.[34mtoThrow[m()[33m;[K[64C[m
    [90m374|     [m})[33m;[K[89C[m
[105C
[31m[1mCaused by: Error[22m: Payment not found for transaction pi_test_123[K[42C[m
[36m [2m‚ùØ[22m PaymentService.updatePaymentStatusFromWebhook src/features/paymentService.ts:[2m546:13[m[K[19C
[90m [2m‚ùØ[22m PaymentService.processStripeWebhook src/features/paymentService.ts:[2m489:9[m[K[30C
[90m [2m‚ùØ[22m PaymentService.processWebhook src/features/paymentService.ts:[2m457:9[m[K[36C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[87/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/paymentService.test.ts[2m > [22mPaymentService[2m > [22mprocessWebhook[2m > [22mshould process PayPal webh
[10;105Hhook successfully[89C
[31m[1mAssertionError[22m: promise rejected "Error: Payment not found for transaction ‚Ä¶" instead of resolving       [m
[36m [2m‚ùØ[22m src/features/paymentService.test.ts:[2m412:93[m[K[60C
    [90m410|       [m})[33m;[K[87C[m
    [90m411|[K[97C[m
    [90m412|       [35mawait [34mexpect[m(paymentService[33m.[34mprocessWebhook[m([32m'paypal'[33m, [mpaypalPayload[33m, [32m'valid-signature'[m))   
       [90m|[93X[31m[93C^   [m
    [90m413|[9X[33m[9C.[mresolves[33m.[mnot[33m.[34mtoThrow[m()[33m;[K[64C[m
    [90m414|     [m})[33m;[K[89C[m
[105C
[105C[31m[1mCaused by: Error[22m: Payment not found for transaction CAPTURE123[m
[36m [2m‚ùØ[22m PaymentService.updatePaymentStatusFromWebhook src/features/paymentService.ts:[2m546:13[m[K[19C
[90m [2m‚ùØ[22m PaymentService.processPayPalWebhook src/features/paymentService.ts:[2m508:9[m[K[30C
[90m [2m‚ùØ[22m PaymentService.processWebhook src/features/paymentService.ts:[2m460:9[m[K[36C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[88/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/paymentService.test.ts[2m > [22mPaymentService[2m > [22mprocessWebhook[2m > [22mshould process MTN webhook
[10;105Hk successfully[92C
[31m[1mAssertionError[22m: promise rejected "Error: Payment not found for transaction ‚Ä¶" instead of resolving       [m
[36m [2m‚ùØ[22m src/features/paymentService.test.ts:[2m450:87[m[K[60C
    [90m448|       [m})[33m;[K[87C[m
    [90m449|[K[97C[m
    [90m450|       [35mawait [34mexpect[m(paymentService[33m.[34mprocessWebhook[m([32m'mtn'[33m, [mmtnPayload[33m, [32m'valid-signature'[m))[K[9C
       [90m|[87X[31m[87C^[K[9C[m
    [90m451|[9X[33m[9C.[mresolves[33m.[mnot[33m.[34mtoThrow[m()[33m;[K[64C[m
    [90m452|     [m})[33m;[K[89C[m
[105C
[31m[1mCaused by: Error[22m: Payment not found for transaction MTN123[K[47C[m
[36m [2m‚ùØ[22m PaymentService.updatePaymentStatusFromWebhook src/features/paymentService.ts:[2m546:13[m[K[19C
[90m [2m‚ùØ[22m PaymentService.processMTNWebhook src/features/paymentService.ts:[2m525:7[m[K[33C
[105C[90m [2m‚ùØ[22m PaymentService.processWebhook src/features/paymentService.ts:[2m463:9[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[89/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionNotificationService.test.ts[2m > [22mPrescriptionNotificationService[2m > [22mnotifyPat
[10;105HtientOfPrescription[2m > [22mshould send SMS and email notifications when both are enabled[K[23C
[41m[1m FAIL [m src/features/prescriptionNotificationService.test.ts[2m > [22mPrescriptionNotificationService[2m > [22mnotifyPat
[10;105HtientOfPrescription[2m > [22mshould only send SMS notification when email is disabled[K[28C
[41m[1m FAIL [m src/features/prescriptionNotificationService.test.ts[2m > [22mPrescriptionNotificationService[2m > [22mnotifyPat
[10;105HtientOfPrescription[2m > [22mshould handle SMS sending failure gracefully[K[40C
[105C[41m[1m FAIL [m src/features/prescriptionNotificationService.test.ts[2m > [22mPrescriptionNotificationService[2m > [22mnotifyPat
[10;105HtientOfPrescription[2m > [22mshould handle missing notification preferences[K[38C
[41m[1m FAIL [m src/features/prescriptionNotificationService.test.ts[2m > [22mPrescriptionNotificationService[2m > [22mgetNotifi
[10;105HicationHistory[2m > [22mshould return notification history for a patient[K[41C
[41m[1m FAIL [m src/features/prescriptionNotificationService.test.ts[2m > [22mPrescriptionNotificationService[2m > [22mgetNotifi
[10;105HicationHistory[2m > [22mshould handle errors gracefully[K[58C
[41m[1m FAIL [m src/features/prescriptionNotificationService.test.ts[2m > [22mPrescriptionNotificationService[2m > [22mupdateNot
[10;105HtificationStatus[2m > [22mshould update notification status successfully[K[41C
[41m[1m FAIL [m src/features/prescriptionNotificationService.test.ts[2m > [22mPrescriptionNotificationService[2m > [22mupdateNot
[10;105HtificationStatus[2m > [22mshould handle update errors[K[60C
[41m[1m FAIL [m src/features/prescriptionNotificationService.test.ts[2m > [22mPrescriptionNotificationService[2m > [22mupdateNot
[10;105HtificationPreferences[2m > [22mshould update notification preferences successfully[K[31C
[41m[1m FAIL [m src/features/prescriptionNotificationService.test.ts[2m > [22mPrescriptionNotificationService[2m > [22mupdateNot
[10;105HtificationPreferences[2m > [22mshould handle update errors[K[55C
[105C[31m[1mError[22m: Cannot find module './smsService'[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionNotificationService.test.ts[18C[m
[36m [2m‚ùØ[22m src/features/prescriptionNotificationService.test.ts:[2m127:28[m[K[43C
[105C    [90m125|     [m
    [90m126|     // Get mocked services[K[70C[m
    [90m127|     [35mconst [m{ [33mSMSService [m} [33m= [34mrequire[m([32m'./smsService'[m)[33m;[K[45C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m128|     [35mconst [m{ [33mWhatsAppService [m} [33m= [34mrequire[m([32m'./whatsappService'[m)[33m;[K[35C[m
    [90m129|     [mmockSMSService [33m= [35mnew [33mSMSService[m()[33m;[K[58C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[90/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mPOST /orders[2m > [22mshould c
[10;105Hcreate prescription order and trigger OCR processing[54C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mPOST /orders[2m > [22mshould r
[10;105Hreturn 400 for missing patient profile ID[65C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mPOST /orders[2m > [22mshould r
[10;105Hreturn 400 for missing image URL[74C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mPOST /orders[2m > [22mshould r
[10;105Hreturn 400 for invalid image URL[74C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mPOST /orders[2m > [22mshould h
[10;105Hhandle database errors during order creation[62C
[105C[31m[1mError[22m: Cannot find module './ocrService'[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m52:17[m[K[52C
[105C     [90m50| [m
     [90m51|     [34mbeforeEach[m(() [33m=> [m{[K[74C
     [90m52|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./ocrService'[m))[33m.[mocrService[33m.[mvalidateImageForOCR[33m.[34mmockReturnValue[m({       
       [90m|[17X[31m[17C^[K[79C[m
     [90m53|[9X[m[9CisValid[33m: [35mtrue[33m,[K[74C[m
     [90m54|[9X[m[9Cerrors[33m: [m[][K[78C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[91/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mGET /orders[2m > [22mshould re
[10;105Heturn orders for valid patient[76C
[31m[1mError[22m: Cannot find module './database'[K[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m186:17[m[K[51C
[105C    [90m184|       [m}[33m;[m
    [90m185|[K[97C[m
    [90m186|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m(mockCollection)[33m;[K[11C[m
       [90m|[17X[31m[17C^[K[79C[m
    [90m187|[K[97C[m
    [90m188|       [35mconst [mresponse [33m= [35mawait [34mrequest[m(app)[K[55C
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[92/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mGET /orders[2m > [22mshould re
[10;105Heturn empty array for patient with no orders[62C
[31m[1mError[22m: Cannot find module './database'[K[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m219:17[m[K[51C
    [90m217|       [m}[33m;[K[88C[m
    [90m218|[K[97C[m
    [90m219|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m(mockCollection)[33m;[K[11C[m
       [90m|[17X[31m[17C^[K[79C[m
    [90m220|[K[97C[m
    [90m221|       [35mconst [mresponse [33m= [35mawait [34mrequest[m(app)[K[55C
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[93/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mGET /orders/:orderId[2m > [22m
[2m[10;105H [22mshould return specific order by ID[71C
[31m[1mError[22m: Cannot find module './database'[K[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m255:17[m[K[51C
[105C    [90m253|       [m}[33m;[m
    [90m254|[K[97C[m
    [90m255|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m256|[9X[m[9Cdoc[33m: [mvi[33m.[34mfn[m(() [33m=> [mmockDocRef)[K[60C
    [90m257|       [m})[33m;[K[87C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[94/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mGET /orders/:orderId[2m > [22m
[2m[10;105H [22mshould return 404 for non-existent order[65C
[31m[1mError[22m: Cannot find module './database'[K[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m274:17[m[K[51C
    [90m272|       [m}[33m;[K[88C[m
    [90m273|[K[97C[m
    [90m274|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m275|[9X[m[9Cdoc[33m: [mvi[33m.[34mfn[m(() [33m=> [mmockDocRef)[K[60C
    [90m276|       [m})[33m;[K[87C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[95/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mPUT /orders/:orderId/st
[10;105Htatus[2m > [22mshould update order status successfully[K[59C
[31m[1mError[22m: Cannot find module './database'[K[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[105C[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m319:17[m
[105C    [90m317|       [m}[33m;[m
    [90m318|[K[97C[m
    [90m319|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m320|[9X[m[9Cdoc[33m: [mvi[33m.[34mfn[m(() [33m=> [mmockDocRef)[K[60C
    [90m321|       [m})[33m;[K[87C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[96/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mPUT /orders/:orderId/ma
[10;105Hanual-text[2m > [22mshould accept manual text entry when OCR failed[K[46C
[105C[31m[1mError[22m: Cannot find module './database'[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[105C[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m388:17[m
    [90m386|       [m}[33m;[K[88C[m
    [90m387|[K[97C[m
    [90m388|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m389|[9X[m[9Cdoc[33m: [mvi[33m.[34mfn[m(() [33m=> [mmockDocRef)[K[60C
    [90m390|       [m})[33m;[K[87C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[97/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mPUT /orders/:orderId/ma
[10;105Hanual-text[2m > [22mshould accept manual text entry when OCR pending[K[45C
[31m[1mError[22m: Cannot find module './database'[K[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m429:17[m[K[51C
    [90m427|       [m}[33m;[K[88C[m
    [90m428|[K[97C[m
    [90m429|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m430|[9X[m[9Cdoc[33m: [mvi[33m.[34mfn[m(() [33m=> [mmockDocRef)[K[60C
    [90m431|       [m})[33m;[K[87C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[98/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mPUT /orders/:orderId/ma
[10;105Hanual-text[2m > [22mshould return 409 if OCR already completed[K[51C
[105C[31m[1mError[22m: Cannot find module './database'[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m457:17[m[K[51C
    [90m455|       [m}[33m;[K[88C[m
    [90m456|[K[97C[m
    [90m457|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m458|[9X[m[9Cdoc[33m: [mvi[33m.[34mfn[m(() [33m=> [mmockDocRef)[K[60C
    [90m459|       [m})[33m;[K[87C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[99/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mPUT /orders/:orderId/ma
[10;105Hanual-text[2m > [22mshould return 404 for non-existent order[K[53C
[105C[31m[1mError[22m: Cannot find module './database'[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m486:17[m[K[51C
    [90m484|       [m}[33m;[K[88C[m
    [90m485|[K[97C[m
    [90m486|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m487|[9X[m[9Cdoc[33m: [mvi[33m.[34mfn[m(() [33m=> [mmockDocRef)[K[60C
    [90m488|       [m})[33m;[K[87C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[100/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mPrescription Order Routes[2m > [22mOCR processing integrat
[10;105Htion[2m > [22mshould validate image before processing[K[60C
[31m[1mError[22m: Cannot find module './ocrService'[K[65C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m507:17[m[K[51C
    [90m505|       [m}[33m;[K[88C[m
    [90m506|[K[97C[m
    [90m507|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./ocrService'[m))[33m.[mocrService[33m.[mvalidateImageForOCR[33m.[34mmockReturnValue[m({       
       [90m|[17X[31m[17C^[K[79C[m
    [90m508|[9X[m[9CisValid[33m: [35mfalse[33m,[K[73C[m
    [90m509|[9X[m[9Cerrors[33m: [m[[32m'Invalid file format'[m][K[57C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[101/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mOrder History Endpoints[2m > [22mGET /orders/history[2m > [22msho
[10;105Hould return order history with pagination[65C
[31m[1mError[22m: Cannot find module './database'[K[67C[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m579:17[m[K[51C
    [90m577|       [35mconst [mmockCount [33m= [mvi[33m.[34mfn[m()[33m;[K[64C[m
    [90m578|[K[97C[m
    [90m579|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m580|[9X[m[9Cwhere[33m: [mmockWhere[33m,[K[71C[m
    [90m581|[9X[m[9CorderBy[33m: [mmockOrderBy[33m,[K[67C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[102/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mOrder History Endpoints[2m > [22mGET /orders/history[2m > [22msho
[10;105Hould return 400 if patientId is missing[67C
[31m[1mAssertionError[22m: expected 404 to be 400 // Object.is equality[K[45C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 400[100C[m
[31m+ 404[100C[m
[105C
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m639:31[m[K[51C
    [90m637|[9X[33m[9C.[34mquery[m({ page[33m: [32m'1'[33m, [mlimit[33m: [32m'10' [m})[33m;[K[53C[m
    [90m638|[K[97C[m
    [90m639|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m400[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m640|       [34mexpect[m(response[33m.[mbody[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[48C[m
    [90m641|       [34mexpect[m(response[33m.[mbody[33m.[merror)[33m.[34mtoBe[m([32m'Patient ID is required'[m)[33m;[K[31C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[103/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mOrder History Endpoints[2m > [22mGET /orders/history[2m > [22msho
[10;105Hould handle pagination correctly[74C
[105C[31m[1mError[22m: Cannot find module './database'[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[105C[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m658:17[m
[105C    [90m656|       [35mconst [mmockCount [33m= [mvi[33m.[34mfn[m()[33m;[m
    [90m657|[K[97C[m
    [90m658|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m659|[9X[m[9Cwhere[33m: [mmockWhere[33m,[K[71C[m
    [90m660|[9X[m[9CorderBy[33m: [mmockOrderBy[33m,[K[67C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[104/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mOrder History Endpoints[2m > [22mReceipt Download Endpoint
[10;105Hts[2m > [22mshould download receipt for delivered order[K[58C
[105C[31m[1mError[22m: Cannot find module './database'[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m747:17[m[K[51C
[105C    [90m745|       [35mconst [mmockLimit [33m= [mvi[33m.[34mfn[m()[33m;[m
    [90m746|[K[97C[m
    [90m747|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m748|[9X[m[9Cdoc[33m: [mvi[33m.[34mfn[m(() [33m=> [mmockDocRef)[33m,[K[59C[m
    [90m749|[9X[m[9Cwhere[33m: [mmockWhere[33m,[K[71C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[105/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mOrder History Endpoints[2m > [22mReceipt Download Endpoint
[10;105Hts[2m > [22mshould return 404 if order not found[K[65C
[105C[31m[1mError[22m: Cannot find module './database'[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[105C[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m782:17[m
[105C    [90m780|       [m}[33m;[m
    [90m781|[K[97C[m
    [90m782|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m783|[9X[m[9Cdoc[33m: [mvi[33m.[34mfn[m(() [33m=> [mmockDocRef)[K[60C
    [90m784|       [m})[33m;[K[87C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[106/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mOrder History Endpoints[2m > [22mReceipt Download Endpoint
[10;105Hts[2m > [22mshould return 403 if order does not belong to patient[K[48C
[105C[31m[1mError[22m: Cannot find module './database'[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[105C[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m808:17[m
[105C    [90m806|       [m}[33m;[m
    [90m807|[K[97C[m
    [90m808|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m809|[9X[m[9Cdoc[33m: [mvi[33m.[34mfn[m(() [33m=> [mmockDocRef)[K[60C
    [90m810|       [m})[33m;[K[87C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[107/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mOrder History Endpoints[2m > [22mReceipt Download Endpoint
[10;105Hts[2m > [22mshould return 400 if order is not delivered[K[58C
[105C[31m[1mError[22m: Cannot find module './database'[m
[31mRequire stack:[91C[m
[31m- C:\Users\akgte\PharmaRx\apps\api\src\features\prescriptionOrderRoutes.test.ts[26C[m
[105C[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m834:17[m
[105C    [90m832|       [m}[33m;[m
    [90m833|[K[97C[m
    [90m834|       [mvi[33m.[34mmocked[m([34mrequire[m([32m'./database'[m))[33m.[mdb[33m.[mcollection[33m.[34mmockReturnValue[m({[K[26C
       [90m|[17X[31m[17C^[K[79C[m
    [90m835|[9X[m[9Cdoc[33m: [mvi[33m.[34mfn[m(() [33m=> [mmockDocRef)[K[60C
    [90m836|       [m})[33m;[K[87C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[108/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m > [22mOrder History Endpoints[2m > [22mReceipt Download Endpoint
[10;105Hts[2m > [22mshould return 400 if patientId is missing[K[60C
[105C[31m[1mAssertionError[22m: expected 404 to be 400 // Object.is equality[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- 400[100C[m
[31m+ 404[100C[m
[105C
[36m [2m‚ùØ[22m src/features/prescriptionOrderRoutes.test.ts:[2m851:31[m[K[51C
[105C    [90m849|[9X[33m[9C.[35mget[m([32m`/orders/[36m${[mmockOrderId[36m}[32m/receipt`[m)[33m;[m
    [90m850|[K[97C[m
    [90m851|       [34mexpect[m(response[33m.[mstatus)[33m.[34mtoBe[m([34m400[m)[33m;[K[56C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m852|       [34mexpect[m(response[33m.[mbody[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[48C[m
    [90m853|       [34mexpect[m(response[33m.[mbody[33m.[merror)[33m.[34mtoBe[m([32m'Patient ID is required'[m)[33m;[K[31C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[109/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/receiptService.test.ts[2m > [22mReceiptService[2m > [22mgenerateReceipt[2m > [22mshould update payment rec
[10;105Hcord with receipt details[81C
[105C[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ ObjectContaining{‚Ä¶} ][m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[105C[36m [2m‚ùØ[22m src/features/receiptService.test.ts:[2m249:26[m
[105C    [90m247|       [35mawait [mreceiptService[33m.[34mgenerateReceipt[m(request)[33m;[m
    [90m248|[K[97C[m
    [90m249|       [34mexpect[m(mockUpdate)[33m.[34mtoHaveBeenCalledWith[m([K[50C
       [90m|[26X[31m[26C^[K[70C[m
    [90m250|[9X[m[9Cexpect[33m.[34mobjectContaining[m({[K[63C
    [90m251|[11X[m[11CreceiptDetails[33m: [mexpect[33m.[34many[m([33mObject[m)[33m,[K[51C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[110/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/receiptService.test.ts[2m > [22mReceiptService[2m > [22mgenerateReceiptNumber[2m > [22mshould increment fr
[10;105Hrom existing receipt numbers[78C
[31m[1mAssertionError[22m: expected 'BJ-2025-000001' to be 'BJ-2024-000006' // Object.is equality[K[19C[m
[105C
Expected: [32m"BJ-202[7m4[27m-00000[7m6[27m"[K[79C[m
Received: [31m"BJ-202[7m5[27m-00000[7m1[27m"[K[79C[m
[105C
[105C[36m [2m‚ùØ[22m src/features/receiptService.test.ts:[2m327:36[m
[105C    [90m325|       [35mconst [mresult [33m= [35mawait [mreceiptService[33m.[34mgenerateReceipt[m(request)[33m;[m
    [90m326|[K[97C[m
    [90m327|       [34mexpect[m(result[33m.[mreceiptNumber)[33m.[34mtoBe[m([32m'BJ-2024-000006'[m)[33m;[K[38C[m
       [90m|[36X[31m[36C^[K[60C[m
    [90m328|     [m})[33m;[K[89C[m
    [90m329|   [m})[33m;[K[91C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[111/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/receiptService.test.ts[2m > [22mReceiptService[2m > [22mgetReceiptByPaymentId[2m > [22mshould return recei
[10;105Hipt when found[92C
[31m[1mAssertionError[22m: expected null to deeply equal { receiptId: 'test-receipt-1', ‚Ä¶(2) }[K[22C[m
[105C
[32m- Expected:[94C[m
{[104C
  "paymentId": "test-payment-1",[73C
  "receiptId": "test-receipt-1",[73C
  "receiptNumber": "BJ-2024-000001",[69C
}[104C
[105C
[31m+ Received:[94C[m
null[101C
[105C
[36m [2m‚ùØ[22m src/features/receiptService.test.ts:[2m356:22[m[K[60C
[105C    [90m354|       [35mconst [mresult [33m= [35mawait [mreceiptService[33m.[34mgetReceiptByPaymentId[m([32m'test-payment-1'[m)[33m;[m
    [90m355|[K[97C[m
    [90m356|       [34mexpect[m(result)[33m.[34mtoEqual[m(mockReceiptData)[33m;[K[50C[m
       [90m|[22X[31m[22C^[K[74C[m
    [90m357|     [m})[33m;[K[89C[m
    [90m358|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[112/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/receiptService.test.ts[2m > [22mReceiptService[2m > [22mgenerateReceiptForPayment[2m > [22mshould throw er
[10;105Hrror when payment not found[79C
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Payment not found' but got 'Order not found[m
[31m[10;105Hd'[104C[m
[105C
Expected: [32m"[7mPayment[27m not found"[K[76C[m
Received: [31m"[7mOrder[27m not found"[K[78C[m
[105C
[36m [2m‚ùØ[22m src/features/receiptService.test.ts:[2m458:7[m[K[61C
    [90m456|       [m})[33m;[K[87C[m
    [90m457|[K[97C[m
    [90m458|       [35mawait [34mexpect[m(receiptService[33m.[34mgenerateReceiptForPayment[m([K[36C
       [90m|       [31m^[K[89C[m
    [90m459|[9X[32m[9C'non-existent-payment'[33m,[K[65C[m
    [90m460|[9X[m[9CmockPharmacyInfo[K[72C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[113/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22msendSMS[2m > [22mshould send SMS successfully
[31m[1mAssertionError[22m: expected undefined to deeply equal { ‚Ä¶(4) }[K[46C[m
[105C
[32m- Expected:[94C[m
{[104C
  "cost": null,[90C
  "messageId": "SM1234567890abcdef",[69C
  "status": "queued",[84C
  "to": "+22912345678",[82C
}[104C
[105C
[31m+ Received:[94C[m
undefined[96C
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m57:27[m[K[65C
[105C     [90m55| [m
     [90m56|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
     [90m57|       [34mexpect[m(result[33m.[mdata)[33m.[34mtoEqual[m({[K[61C
       [90m|[27X[31m[27C^[K[69C[m
     [90m58|[9X[m[9CmessageId[33m: [32m'SM1234567890abcdef'[33m,[K[56C[m
     [90m59|[9X[m[9Cstatus[33m: [32m'queued'[33m,[K[71C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[114/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22msendSMS[2m > [22mshould handle Twilio API errors gracefull
[10;105Hly[104C
[31m[1mAssertionError[22m: expected 'Invalid phone number format' to be 'The To phone number is not a valid ph‚Ä¶' // [m
[31m[10;105H Object.is equality[87C[m
[105C
Expected: [32m"[7mThe To phone number is not a [27mvalid phone number[7m.[27m"[K[45C[m
Received: [31m"[7mIn[27mvalid phone number[7m format[27m"[K[66C[m
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m94:28[m[K[65C
[105C     [90m92| [m
     [90m93|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
     [90m94|       [34mexpect[m(result[33m.[merror)[33m.[34mtoBe[m([32m'The To phone number is not a valid phone number.'[m)[33m;[K[12C[m
       [90m|[28X[31m[28C^[K[68C[m
     [90m95|     [m})[33m;[K[89C[m
     [90m96|[K[97C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[115/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22msendSMS[2m > [22mshould handle network errors[K[13C
[31m[1mAssertionError[22m: expected 'Network error while sending SMS' to be 'Failed to send SMS: Network timeout' //[m
[31m[10;105H/ Object.is equality[86C[m
[105C
Expected: [32m"[7mFailed to[27m send SMS[7m: Network timeout[27m"[K[58C[m
Received: [31m"[7mNetwork error while[27m send[7ming[27m SMS"[K[62C[m
[105C
[105C[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m103:28[m
    [90m101|[K[97C[m
    [90m102|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m103|       [34mexpect[m(result[33m.[merror)[33m.[34mtoBe[m([32m'Failed to send SMS: Network timeout'[m)[33m;[K[25C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m104|     [m})[33m;[K[89C[m
    [90m105|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[116/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22msendSMS[2m > [22mshould clean phone numbers correctly     
[105C[31m[1mAssertionError[22m: expected 'To=+22912345678&From=+15551234567&Bod‚Ä¶' to contain 'To=%2B22912345678'[m
[105C
Expected: [32m"To=[7m%2B[27m22912345678"[K[76C[m
Received: [31m"To=[7m+[27m22912345678[7m&From=+15551234567&Body=Test+message[27m"[K[42C[m
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m132:22[m[K[64C
[105C    [90m130|[9X[35m[9Cconst [mlastCall [33m= [mmockFetch[33m.[mmock[33m.[mcalls[mockFetch[33m.[mmock[33m.[mcalls[33m.[mlength [33m- [34m1[m][33m;[m
    [90m131|[9X[35m[9Cconst [mbody [33m= [34mdecodeURIComponent[m(lastCall[[34m1[m][33m.[mbody)[33m;[K[38C[m
    [90m132|[9X[34m[9Cexpect[m(body)[33m.[34mtoContain[m([32m'To=%2B22912345678'[m)[33m;[K[44C[m
       [90m|[22X[31m[22C^[K[74C[m
    [90m133|       [m}[K[89C
    [90m134|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[117/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22msendSMS[2m > [22mshould validate phone numbers[K[12C
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- false[98C[m
[31m+ true[99C[m
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m147:32[m[K[64C
[105C    [90m145|       [35mfor [m([35mconst [mphoneNumber [35mof [minvalidPhoneNumbers) {
    [90m146|[9X[35m[9Cconst [mresult [33m= [35mawait [msmsService[33m.[34msendSMS[m(phoneNumber[33m, [32m'Test message'[m)[33m;[K[19C[m
    [90m147|[9X[34m[9Cexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[53C[m
       [90m|[32X[31m[32C^[K[64C[m
    [90m148|[9X[34m[9Cexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'Invalid phone number'[m)[33m;[K[33C[m
    [90m149|       [m}[K[89C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[118/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22msendSMS[2m > [22mshould handle empty message text[K[9C
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- false[98C[m
[31m+ true[99C[m
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m155:30[m[K[64C
    [90m153|       [35mconst [mresult [33m= [35mawait [msmsService[33m.[34msendSMS[m([32m'+22912345678'[33m, [32m''[m)[33m;[K[30C[m
    [90m154|[K[97C[m
    [90m155|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m156|       [34mexpect[m(result[33m.[merror)[33m.[34mtoBe[m([32m'Message text cannot be empty'[m)[33m;[K[32C[m
    [90m157|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[119/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22msendSMS[2m > [22mshould handle long messages and calculate
[10;105He segments[96C
[31m[1mAssertionError[22m: expected 'GSM' to be 'GSM-7' // Object.is equality[K[39C[m
[105C
Expected: [32m"GSM[7m-7[27m"[K[88C[m
Received: [31m"GSM"[K[90C[m
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m195:36[m[K[64C
    [90m193|       [35mconst [mmessageInfo [33m= [msmsService[33m.[34mgetMessageInfo[m(longMessage[33m, [32m'+22912345678'[m)[33m;[K[15C[m
    [90m194|       [34mexpect[m(messageInfo[33m.[msegments)[33m.[34mtoBe[m([34m3[m)[33m; [90m// 320 chars = 3 segments[K[27C[m
    [90m195|       [34mexpect[m(messageInfo[33m.[mencoding)[33m.[34mtoBe[m([32m'GSM-7'[m)[33m;[K[47C[m
       [90m|[36X[31m[36C^[K[60C[m
    [90m196|[K[97C[m
    [90m197|       [35mawait [msmsService[33m.[34msendSMS[m([32m'+22912345678'[33m, [mlongMessage)[33m;[K[36C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[120/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22msendBulkSMS[2m > [22mshould send bulk SMS with rate limiti
[10;105Hing[103C
[31m[1mAssertionError[22m: expected undefined to deeply equal { totalSent: 3, totalFailed: +0, ‚Ä¶(1) }[K[15C[m
[105C
[32m- Expected:[94C[m
{[104C
  "results": ArrayContaining [[75C
    ObjectContaining {[83C
      "success": true,[83C
    },[99C
    ObjectContaining {[83C
      "success": true,[83C
    },[99C
    ObjectContaining {[83C
      "success": true,[83C
    },[99C
  ],[101C
  "totalFailed": 0,[86C
  "totalSent": 3,[88C
}[104C
[105C
[31m+ Received:[94C[m
undefined[96C
[105C
[105C[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m220:27[m
    [90m218|[K[97C[m
    [90m219|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
    [90m220|       [34mexpect[m(result[33m.[mdata)[33m.[34mtoEqual[m({[K[61C
       [90m|[27X[31m[27C^[K[69C[m
    [90m221|[9X[m[9CtotalSent[33m: [34m3[33m,[K[75C[m
    [90m222|[9X[m[9CtotalFailed[33m: [34m0[33m,[K[73C[m
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[121/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22msendBulkSMS[2m > [22mshould handle partial failures in bul
[10;105Hlk SMS[100C
[31m[1mAssertionError[22m: expected undefined to deeply equal { totalSent: 2, totalFailed: 1, ‚Ä¶(1) }[K[16C[m
[105C
[32m- Expected:[94C[m
{[104C
  "results": ArrayContaining [[75C
    ObjectContaining {[83C
      "success": true,[83C
    },[99C
    ObjectContaining {[83C
      "error": "Invalid phone number",[67C
      "success": false,[82C
    },[99C
    ObjectContaining {[83C
      "success": true,[83C
    },[99C
  ],[101C
  "totalFailed": 1,[86C
  "totalSent": 2,[88C
}[104C
[105C
[31m+ Received:[94C[m
undefined[96C
[105C
[105C[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m265:27[m
[105C    [90m263| [m
    [90m264|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m; [90m// Overall success even with partial failures[K[10C[m
    [90m265|       [34mexpect[m(result[33m.[mdata)[33m.[34mtoEqual[m({[K[61C
       [90m|[27X[31m[27C^[K[69C[m
    [90m266|[9X[m[9CtotalSent[33m: [34m2[33m,[K[75C[m
    [90m267|[9X[m[9CtotalFailed[33m: [34m1[33m,[K[73C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[122/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22msendBulkSMS[2m > [22mshould respect rate limiting in bulk 
[10;105H SMS[102C
[105C[31m[1mAssertionError[22m: expected 1 to be greater than or equal to 100[m
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m297:25[m[K[64C
    [90m295|[K[97C[m
    [90m296|       // Should take at least 100ms due to rate limiting[K[40C[m
    [90m297|       [34mexpect[m(timeTaken)[33m.[34mtoBeGreaterThanOrEqual[m([34m100[m)[33m;[K[44C[m
       [90m|[25X[31m[25C^[K[71C[m
    [90m298|     [m})[33m;[K[89C[m
    [90m299|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[123/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22msendBulkSMS[2m > [22mshould handle empty recipient list   
[31m[1mAssertionError[22m: expected undefined to be 'No recipients provided' // Object.is equality[K[18C[m
[105C
[32m- Expected:[94C[m
"No recipients provided"[81C
[105C
[31m+ Received:[94C[m
undefined[96C
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m304:28[m[K[64C
    [90m302|[K[97C[m
    [90m303|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m304|       [34mexpect[m(result[33m.[merror)[33m.[34mtoBe[m([32m'No recipients provided'[m)[33m;[K[38C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m305|     [m})[33m;[K[89C[m
    [90m306|   [m})[33m;[K[91C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[124/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mgetMessageStatus[2m > [22mshould retrieve message status s
[10;105Hsuccessfully[94C
[31m[1mAssertionError[22m: expected undefined to deeply equal { ‚Ä¶(7) }[K[46C[m
[105C
[32m- Expected:[94C[m
{[104C
  "cost": -0.0075,[87C
  "dateSent": "2024-12-19T12:00:00Z",[68C
  "errorCode": null,[85C
  "errorMessage": null,[82C
  "messageId": "SM1234567890abcdef",[69C
  "status": "delivered",[81C
  "to": "+22912345678",[82C
}[104C
[105C
[31m+ Received:[94C[m
undefined[96C
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m330:27[m[K[64C
[105C    [90m328| [m
    [90m329|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
    [90m330|       [34mexpect[m(result[33m.[mdata)[33m.[34mtoEqual[m({[K[61C
       [90m|[27X[31m[27C^[K[69C[m
    [90m331|[9X[m[9CmessageId[33m: [32m'SM1234567890abcdef'[33m,[K[56C[m
    [90m332|[9X[m[9Cstatus[33m: [32m'delivered'[33m,[K[68C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[125/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mgetMessageStatus[2m > [22mshould handle failed message sta
[10;105Hatus[102C
[31m[1mAssertionError[22m: expected undefined to be 'failed' // Object.is equality[K[34C[m
[105C
[32m- Expected:[94C[m
"failed"[97C
[105C
[31m+ Received:[94C[m
undefined[96C
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m367:35[m[K[64C
    [90m365|[K[97C[m
    [90m366|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
    [90m367|       [34mexpect[m(result[33m.[mdata[33m?.[mstatus)[33m.[34mtoBe[m([32m'failed'[m)[33m;[K[47C[m
       [90m|[35X[31m[35C^[K[61C[m
    [90m368|       [34mexpect[m(result[33m.[mdata[33m?.[merrorCode)[33m.[34mtoBe[m([34m30008[m)[33m;[K[47C[m
    [90m369|       [34mexpect[m(result[33m.[mdata[33m?.[merrorMessage)[33m.[34mtoBe[m([32m'Unknown error'[m)[33m;[K[34C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[126/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mgetAccountInfo[2m > [22mshould retrieve account informatio
[10;105Hon successfully[91C
[105C[31m[1mAssertionError[22m: expected { sid: 'test-account-sid', ‚Ä¶(5) } to deeply equal { Object (accountSid, friendly[m
[31m[10;105HyName, ...) }[93C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[2m  {[22m[K[102C
[32m-   "accountSid": "test-account-sid",[68C[m
[32m-   "dateCreated": "2024-01-01T00:00:00Z",[63C[m
[32m-   "dateUpdated": "2024-12-19T12:00:00Z",[63C[m
[32m-   "friendlyName": "PharmaRx SMS Account",[62C[m
[31m+   "date_created": "2024-01-01T00:00:00Z",[62C[m
[31m+   "date_updated": "2024-12-19T12:00:00Z",[62C[m
[31m+   "friendly_name": "PharmaRx SMS Account",[61C[m
[31m+   "sid": "test-account-sid",[75C[m
[2m    "status": "active",[22m[K[82C
[2m    "type": "Full",[22m[K[86C
[2m  }[22m[K[102C
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m410:27[m[K[64C
[105C    [90m408| [m
    [90m409|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
    [90m410|       [34mexpect[m(result[33m.[mdata)[33m.[34mtoEqual[m({[K[61C
       [90m|[27X[31m[27C^[K[69C[m
    [90m411|[9X[m[9CaccountSid[33m: [32m'test-account-sid'[33m,[K[57C[m
    [90m412|[9X[m[9CfriendlyName[33m: [32m'PharmaRx SMS Account'[33m,[K[51C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[127/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mformatPaymentMessage[2m > [22mshould format payment messag
[10;105Hge for SMS correctly[86C
[31m[1mTypeError[22m: cost.toFixed is not a function[K[64C[m
[36m [2m‚ùØ[22m SMSService.formatPaymentMessage src/features/smsService.ts:[2m321:82[m[K[37C
[105C    [90m319|   [34mformatPaymentMessage[m(paymentUrl[33m: [mstring[33m, [mmedicationName[33m: [mstring[33m, [mcost[33m: [mnumber)[33m: [mstring {
    [90m320|     [35mreturn [32m`PharmaRx Payment Request\n\n` [33m+[K[53C[m
    [90m321|[12X[m[12C`Someone needs help paying for medication: ${medicationName} ($${cost.toFixed(2)})\n‚Ä¶
       [90m|[82X[31m[82C^[K[14C[m
    [90m322|[12X[32m[12C`Secure payment link: [36m${[mpaymentUrl[36m}[32m\n\n` [33m+[K[43C[m
    [90m323|[12X[32m[12C`Link expires in 48 hours. Thank you for helping!`[33m;[K[34C[m
[105C[90m [2m‚ùØ[22m src/features/smsService.test.ts:[2m479:34[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[128/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mformatPaymentMessage[2m > [22mshould handle long medicatio
[10;105Hon names by truncating[84C
[31m[1mTypeError[22m: cost.toFixed is not a function[K[64C[m
[36m [2m‚ùØ[22m SMSService.formatPaymentMessage src/features/smsService.ts:[2m321:82[m[K[37C
    [90m319|   [34mformatPaymentMessage[m(paymentUrl[33m: [mstring[33m, [mmedicationName[33m: [mstring[33m, [mcost[33m: [mnumber)[33m: [mstring {      
    [90m320|     [35mreturn [32m`PharmaRx Payment Request\n\n` [33m+[K[53C[m
    [90m321|[12X[m[12C`Someone needs help paying for medication: ${medicationName} ($${cost.toFixed(2)})\n‚Ä¶
       [90m|[82X[31m[82C^[K[14C[m
    [90m322|[12X[32m[12C`Secure payment link: [36m${[mpaymentUrl[36m}[32m\n\n` [33m+[K[43C[m
    [90m323|[12X[32m[12C`Link expires in 48 hours. Thank you for helping!`[33m;[K[34C[m
[105C[90m [2m‚ùØ[22m src/features/smsService.test.ts:[2m496:34[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[129/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mformatPaymentMessage[2m > [22mshould format currency corre
[10;105Hectly for different amounts[79C
[31m[1mTypeError[22m: cost.toFixed is not a function[K[64C[m
[36m [2m‚ùØ[22m SMSService.formatPaymentMessage src/features/smsService.ts:[2m321:82[m[K[37C
[105C    [90m319|   [34mformatPaymentMessage[m(paymentUrl[33m: [mstring[33m, [mmedicationName[33m: [mstring[33m, [mcost[33m: [mnumber)[33m: [mstring {
    [90m320|     [35mreturn [32m`PharmaRx Payment Request\n\n` [33m+[K[53C[m
    [90m321|[12X[m[12C`Someone needs help paying for medication: ${medicationName} ($${cost.toFixed(2)})\n‚Ä¶
       [90m|[82X[31m[82C^[K[14C[m
    [90m322|[12X[32m[12C`Secure payment link: [36m${[mpaymentUrl[36m}[32m\n\n` [33m+[K[43C[m
    [90m323|[12X[32m[12C`Link expires in 48 hours. Thank you for helping!`[33m;[K[34C[m
[105C[90m [2m‚ùØ[22m src/features/smsService.test.ts:[2m515:36[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[130/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mgetMessageInfo[2m > [22mshould calculate message segments 
[10;105H correctly[96C
[31m[1mAssertionError[22m: expected 'GSM' to be 'GSM-7' // Object.is equality[K[39C[m
[105C
Expected: [32m"GSM[7m-7[27m"[K[88C[m
Received: [31m"GSM"[K[90C[m
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m538:31[m[K[64C
    [90m536|[9X[35m[9Cconst [minfo [33m= [msmsService[33m.[34mgetMessageInfo[m(testCase[33m.[mmessage[33m, [32m'+22912345678'[m)[33m;[K[15C[m
    [90m537|[9X[34m[9Cexpect[m(info[33m.[msegments)[33m.[34mtoBe[m(testCase[33m.[mexpected[33m.[msegments)[33m;[K[33C[m
    [90m538|[9X[34m[9Cexpect[m(info[33m.[mencoding)[33m.[34mtoBe[m(testCase[33m.[mexpected[33m.[mencoding)[33m;[K[33C[m
       [90m|[31X[31m[31C^[K[65C[m
    [90m539|       [m}[K[89C
    [90m540|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[131/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mgetMessageInfo[2m > [22mshould detect Unicode encoding for
[10;105Hr special characters[86C
[105C[31m[1mAssertionError[22m: expected 'UCS2' to be 'UCS-2' // Object.is equality[m
[105C
Expected: [32m"UCS[7m-[27m2"[K[88C[m
Received: [31m"UCS2"[K[89C[m
[105C
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m546:29[m[K[64C
    [90m544|       [35mconst [minfo [33m= [msmsService[33m.[34mgetMessageInfo[m(unicodeMessage[33m, [32m'+22912345678'[m)[33m;[K[19C[m
    [90m545|[K[97C[m
    [90m546|       [34mexpect[m(info[33m.[mencoding)[33m.[34mtoBe[m([32m'UCS-2'[m)[33m;[K[54C[m
       [90m|[29X[31m[29C^[K[67C[m
    [90m547|       [34mexpect[m(info[33m.[mlength)[33m.[34mtoBe[m(unicodeMessage[33m.[mlength)[33m;[K[42C[m
    [90m548|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[132/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mgetMessageInfo[2m > [22mshould estimate costs based on seg
[10;105Hgments and destination[84C
[31m[1mAssertionError[22m: expected undefined to be close to 0.135, received difference is NaN, but expected 0.0005 [m
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m562:36[m[K[64C
[105C    [90m560|       [35mfor [m([35mconst [mtestCase [35mof [mtestCases) {
    [90m561|[9X[35m[9Cconst [minfo [33m= [msmsService[33m.[34mgetMessageInfo[m(message[33m, [mtestCase[33m.[mphone)[33m;[K[24C[m
    [90m562|[9X[34m[9Cexpect[m(info[33m.[mestimatedCost)[33m.[34mtoBeCloseTo[m(testCase[33m.[mexpectedCostPerSegment [33m* [34m3[33m, [34m3[m)[33m;[K[9C[m
       [90m|[36X[31m[36C^[K[60C[m
    [90m563|       [m}[K[89C
    [90m564|     [m})[33m;[K[89C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[133/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mPhone Number Validation and Cleaning[2m > [22mshould rejec
[10;105Hct invalid phone number formats[75C
[31m[1mTypeError[22m: smsService.validatePhoneNumber is not a function[K[46C[m
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m596:57[m[K[64C
[105C    [90m594| [m
    [90m595|       [35mfor [m([35mconst [mnumber [35mof [minvalidNumbers) {[K[52C
    [90m596|[9X[35m[9Cconst [misValid [33m= [msmsService[[32m'validatePhoneNumber'[m](number)[33m;[K[30C[m
       [90m|[57X[31m[57C^[K[39C[m
    [90m597|[9X[34m[9Cexpect[m(isValid)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[60C[m
    [90m598|       [m}[K[89C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[134/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mError Message Parsing[2m > [22mshould parse standard Twili
[10;105Hio API errors[93C
[31m[1mTypeError[22m: smsService.parseErrorMessage is not a function[K[48C[m
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m633:54[m[K[64C
[105C    [90m631| [m
    [90m632|       [35mfor [m([35mconst [mtestCase [35mof [merrors) {[K[58C
    [90m633|[9X[35m[9Cconst [mparsed [33m= [msmsService[[32m'parseErrorMessage'[m](testCase[33m.[mresponse)[33m;[K[22C[m
       [90m|[54X[31m[54C^[K[42C[m
    [90m634|[9X[34m[9Cexpect[m(parsed)[33m.[34mtoBe[m(testCase[33m.[mexpected)[33m;[K[49C[m
    [90m635|       [m}[K[89C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[135/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/smsService.test.ts[2m > [22mSMSService[2m > [22mError Message Parsing[2m > [22mshould handle malformed err
[10;105Hror responses[93C
[31m[1mTypeError[22m: smsService.parseErrorMessage is not a function[K[48C[m
[36m [2m‚ùØ[22m src/features/smsService.test.ts:[2m647:54[m[K[64C
[105C    [90m645| [m
    [90m646|       [35mfor [m([35mconst [mresponse [35mof [mmalformedResponses) {[K[46C
    [90m647|[9X[35m[9Cconst [mparsed [33m= [msmsService[[32m'parseErrorMessage'[m](response)[33m;[K[31C[m
       [90m|[54X[31m[54C^[K[42C[m
    [90m648|[9X[34m[9Cexpect[m(parsed)[33m.[34mtoBe[m([32m'Unknown SMS service error'[m)[33m;[K[39C[m
    [90m649|       [m}[K[89C
[105C
[105C[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[136/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/whatsappService.test.ts[2m > [22mWhatsAppService[2m > [22msendMessage[2m > [22mshould validate phone numbe
[10;105Hers[103C
[105C[31m[1mAssertionError[22m: expected true to be false // Object.is equality[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- false[98C[m
[31m+ true[99C[m
[105C
[105C[36m [2m‚ùØ[22m src/features/whatsappService.test.ts:[2m148:32[m
[105C    [90m146|       [35mfor [m([35mconst [mphoneNumber [35mof [minvalidPhoneNumbers) {
    [90m147|[9X[35m[9Cconst [mresult [33m= [35mawait [mwhatsappService[33m.[34msendMessage[m(phoneNumber[33m, [32m'Test message'[m)[33m;[K[10C[m
    [90m148|[9X[34m[9Cexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[53C[m
       [90m|[32X[31m[32C^[K[64C[m
    [90m149|[9X[34m[9Cexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'Invalid phone number'[m)[33m;[K[33C[m
    [90m150|       [m}[K[89C
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[137/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/whatsappService.test.ts[2m > [22mWhatsAppService[2m > [22msendTemplateMessage[2m > [22mshould send a templ
[10;105Hlate message successfully[81C
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[105C[36m [2m‚ùØ[22m src/features/whatsappService.test.ts:[2m202:30[m
    [90m200|       [m)[33m;[K[88C[m
    [90m201|[K[97C[m
    [90m202|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m203|       [34mexpect[m(result[33m.[mdata)[33m.[34mtoEqual[m({[K[61C
    [90m204|[9X[m[9CmessageId[33m: [32m'msg_template_123'[33m,[K[58C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[138/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/whatsappService.test.ts[2m > [22mWhatsAppService[2m > [22msendTemplateMessage[2m > [22mshould handle templ
[10;105Hlate not found errors[85C
[105C[31m[1mAssertionError[22m: expected 'Network error while sending WhatsApp ‚Ä¶' to be 'Template not found' // Object.is[m
[31m[10;105Hs equality[96C[m
[105C
Expected: [32m"Template not found"[K[75C[m
Received: [31m"Network error while sending WhatsApp template message"[K[40C[m
[105C
[36m [2m‚ùØ[22m src/features/whatsappService.test.ts:[2m238:28[m[K[59C
    [90m236|[K[97C[m
    [90m237|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m238|       [34mexpect[m(result[33m.[merror)[33m.[34mtoBe[m([32m'Template not found'[m)[33m;[K[42C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m239|     [m})[33m;[K[89C[m
    [90m240|[K[97C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[139/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/whatsappService.test.ts[2m > [22mWhatsAppService[2m > [22misConfigured[2m > [22mshould return false when b
[10;105Hbusiness account ID is missing[76C
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- false[98C[m
[31m+ true[99C[m
[105C
[36m [2m‚ùØ[22m src/features/whatsappService.test.ts:[2m277:46[m[K[59C
    [90m275|       [mwhatsappService [33m= [35mnew [33mWhatsAppService[m()[33m;[K[50C[m
    [90m276|[K[97C[m
    [90m277|       [34mexpect[m(whatsappService[33m.[34misConfigured[m())[33m.[34mtoBe[m([35mfalse[m)[33m;[K[39C[m
       [90m|[46X[31m[46C^[K[50C[m
    [90m278|     [m})[33m;[K[89C[m
    [90m279|   [m})[33m;[K[91C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[140/193]‚éØ[m
[105C
[41m[1m FAIL [m src/features/whatsappService.test.ts[2m > [22mWhatsAppService[2m > [22mgetBusinessProfile[2m > [22mshould retrieve busi
[10;105Hiness profile successfully[80C
[105C[31m[1mAssertionError[22m: expected { id: 'test-phone-id', ‚Ä¶(4) } to deeply equal { id: 'test-business-id', ‚Ä¶(4) }[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[2m  {[22m[K[102C
[2m    "category": "HEALTH",[22m[K[80C
[2m    "description": "Online pharmacy service",[22m[K[60C
[32m-   "id": "test-business-id",[76C[m
[31m+   "id": "test-phone-id",[79C[m
[2m    "name": "PharmaRx",[22m[K[82C
[32m-   "profilePictureUrl": "https://example.com/profile.jpg",[46C[m
[31m+   "profilePictureUrl": undefined,[70C[m
[2m  }[22m[K[102C
[105C
[36m [2m‚ùØ[22m src/features/whatsappService.test.ts:[2m301:27[m[K[59C
[105C    [90m299| [m
    [90m300|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
    [90m301|       [34mexpect[m(result[33m.[mdata)[33m.[34mtoEqual[m({[K[61C
       [90m|[27X[31m[27C^[K[69C[m
    [90m302|[9X[m[9Cid[33m: [32m'test-business-id'[33m,[K[65C[m
    [90m303|[9X[m[9Cname[33m: [32m'PharmaRx'[33m,[K[71C[m
[105C
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[141/193]‚éØ[m
[105C
[105C[41m[1m FAIL [m src/features/whatsappService.test.ts[2m > [22mWhatsAppService[2m > [22mformatPaymentMessage[2m > [22mshould format paym
[10;105Hment message correctly[84C
[31m[1mAssertionError[22m: expected 'üíä *PharmaRx Payment Request*\n\nSome‚Ä¶' to contain 'Medication: *Amoxicillin 50[m
[31m[10;105H00mg*'[100C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- [7mMedication: *Amoxicillin 500mg[27m*[K[72C[m
[31m+ üíä *PharmaRx Payment Request*[74C[m
[31m+[104C[m
[31m+ Someone has requested your help to pay for their medication:[43C[m

[?9001h[?1004h[?25l[2J[m[H]0;npm[?25h]0;npm run test[?25l
> @pharmarx/api@1.0.0 test
> vitest[5;1H[?25h[K]0;C:\WINDOWS\system32\cmd.exe ]0;node (vitest)[?25l[44m[1m
 DEV [m [34mv3.2.4 [90mC:/Users/akgte/PharmaRx/apps/api[m[?2026h[2m[9;1H Test Files [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m746ms[?2026l[?2026h
[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m1.84s[?2026l[?2026h
[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m2.95s[?2026l]0;node (vitest 4)[?2026h
[K]0;node (vitest 5)[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K]0;node (vitest 2)[105C[9;1H[K[105C[8;1H[K[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m3.50s]0;node (vitest 6)[?2026l]0;node (vitest 3)[?2026h
[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m3.93s[?2026l[?2026h[8;1H[K[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[K[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[K[m[2m
   Start at [22m18:43:17[K[2m
   Duration [22m4.46s[K
[K[105C[?2026l[?2026h[K[105C[11;1H[K
[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m4.97s[?2026l[?2026h
[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m5.53s[?2026l[?2026h[8;1H[K[33m[1m
 ❯ [msrc/features/database.test.ts[2m [queued][22m[K
[K[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[K[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[K[m[2m
   Start at [22m18:43:17[K[85C
[2m   Duration [22m5.84s[K[88C[?2026l
[105C[?2026h[6;1H[K[33m[1m
 ❯ [msrc/features/database.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[K[81C[m
[2m      Tests [32m[22m[1m0 passed[90m[22m (0)[K[81C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m6.06s[K[88C[?2026l
[105C[?2026h[2;1H[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/database.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[K[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[K[m[2m
   Start at [22m18:43:17[K[2m
   Duration [22m6.89s[K[88C[?2026l
[105C[?2026h[?2026l[H[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/database.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[K[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[K[m[2m
   Start at [22m18:43:17[K[2m
   Duration [22m7.18s[K
[K[105C[?2026h[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/database.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][9;1H Test Files [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m7.87s[?2026l[?2026h[?2026l[H[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/database.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [32m[22m[1m0 passed[90m[22m (9)[K[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[K[m[2m
   Start at [22m18:43:17[K[2m
   Duration [22m8.59s[K
[K[105C[?2026h[K[105C[12;1H[K[105C[9;1H[K
[K
[K[105C[6;1H[K
[K
[K[105C[5;1H[K[105C[4;1H[K[105C[H[K
[K
[K[105C[33m[1m[2;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/database.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][9;1H Test Files [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (0)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m8.93s[?2026l[?2026h
[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts[m[K
OCR Service initialized successfully[33m[1m[5;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/database.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 0/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][12;1H Test Files [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [32m[22m[1m0 passed[90m[22m (17)[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m9.41s[K[88C
[105C[?2026l[?2026h[9;1H[K
[K
[K
[K
[K[105C[3;1H[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m[K
OCR Service initialized successfully[90m[5;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m
Starting OCR processing for order test-order-123
OCR attempt 1/3 for image: https://example.com/test-image.jpg[33m[1m[11;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/database.test.ts[2m 1/17[33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 0/17[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (9)[K[81C[m
[2m      Tests [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[69C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m10.31s[K[87C[?2026l[?2026h
[105C[2;1H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[H[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m
OCR attempt 1 failed: (intermediate value) is not iterable[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/database.test.ts[2m 1/17[33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 0/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[69C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m10.31s[K[87C
[105C[?2026l[?2026h[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[4;1H[K
[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[90m[Hstdout[2m | src/features/database.test.ts > DatabaseService > getDb > should initialize Firebase and return Firestore instance[m
🔧 Initializing Firebase Admin for test environment
📋 Project ID: pharmarx-dev
🧪 Using minimal configuration for Firebase emulators
✅ Firebase Admin initialized successfully[90m[8;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m
OCR attempt 2/3 for image: https://example.com/test-image.jpg[33m[1m[13;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m
[33m[1m ❯ [msrc/features/database.test.ts[2m 1/17[22m[K[68C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 0/17[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [32m[22m[1m0 passed[90m[22m (9)[K[81C[m
[2m      Tests [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[69C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m10.31s[K[87C
[105C[?2026l[?2026h[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[9;1H[K[105C[7;1H[K
[K[105C[6;1H[K[105C[5;1H[K[105C[3;1H[K
[K[105C[2;1H[K[105C[H[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m
OCR attempt 2 failed: (intermediate value) is not iterable[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/database.test.ts[2m 1/17[33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 0/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[69C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m10.31s[K[87C
[105C[?2026l[?2026h[4;1H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text from image[m[K
OCR attempt 3/3 for image: https://example.com/test-image.jpg[K[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/database.test.ts[2m 17/17[33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 2/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m19 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m12.18s[K[87C[?2026l[?2026h
[12;1H                                                                                                         
[105C[90m[Hstderr[2m | src/features/database.test.ts > DatabaseService > healthCheck > should return healthy status when database is accessible[m[K
Database health check failed: TypeError: db.collection(...).doc is not a function[K
    at DatabaseService.healthCheck [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.ts:133:48[90m)    [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.test.ts:190:44[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)[K
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)[K
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)[90m
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text f[m
[90m[2m[12;105Hfrom image[22m[K[96C[m
OCR attempt 3 failed: (intermediate value) is not iterable[47C
[105C
[90mstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should successfully extract text f[m
[90m[2m[12;105Hfrom image[22m[K[96C[m
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermed
[12;105Hdiate value) is not iterable[78C
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:100:1
[12;105H11[90m)[K[103C[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:29[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:68:22[K[28C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/database.test.ts > DatabaseService > healthCheck > should return unhealthy status w[m
[90m[2m[12;105Hwhen database is not accessible[22m[K[75C[m
Database health check failed: TypeError: db.collection(...).doc is not a function[24C
    at DatabaseService.healthCheck [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.ts:133:48[90m)    [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.test.ts:211:44[K[29C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/database.test.ts > DatabaseService > healthCheck > should handle database initializ[m
[90m[2m[12;105Hzation errors[22m[K[93C[m
Database health check failed: Error: Database initialization failed[38C
    at DatabaseService.<anonymous> [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.test.ts:222:15
[12;105H5[90m)[104C[m
    at DatabaseService.mockCall (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/spy/dist/index.js:9
[12;105H96:15)[100C
    at DatabaseService.getDb (file:///C:/Users/akgte/PharmaRx/node_modules/[4mtinyspy[24m/dist/index.js:47:103) 
    at DatabaseService.healthCheck [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.ts:132:23[90m)    [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\database.test.ts:225:44[K[29C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/database.test.ts[2m 17/17[22m[K[67C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m19 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m12.18s[K[87C[?2026l[?2026h
[H [31m❯ [msrc/features/database.test.ts [2m(17 tests | [31m[22m17 failed[m[2m)[33m[22m 536[2mms[m[K[31m
   × DatabaseService[2m > [22mgetInstance[2m > [22mshould return singleton instance [32m49[2mms[m[K[31m
     → default.disconnect is not a function[K
   × DatabaseService[2m > [22mgetDb[2m > [22mshould initialize Firebase and return Firestore instance [32m25[2mms[m[K[31m
     → default.disconnect is not a function[K
   × DatabaseService[2m > [22mgetDb[2m > [22mshould not reinitialize if already initialized [32m94[2mms[m[K[31m
     → expected "spy" to be called at least once[K
     → default.disconnect is not a function[K
   × DatabaseService[2m > [22mgetDb[2m > [22mshould initialize with development settings [32m15[2mms[m[K[31m
     → expected "spy" to be called with arguments: [ { projectId: 'test-project-dev' } ][K[m
[K[90m
Number of calls: [1m0[m[K
[K[105C
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22mgetDb[2m > [22mshould initialize with test settings [32m8[2mms[m[K[34C
[31m     → expected "spy" to be called with arguments: [ { projectId: 'test-project' } ][21C[m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22mgetDb[2m > [22mshould use default project ID if not specified in development [32m7[2mms[m[K[9C
[31m     → expected "spy" to be called with arguments: [ { projectId: 'pharmarx-dev' } ][21C[m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22mgetDb[2m > [22mshould initialize with production settings [32m6[2mms[m[K[28C
[31m     → expected "spy" to be called at least once[57C[m
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22mgetDb[2m > [22mshould use application default credentials in production if no service acc[m
[31m[12;105Hcount key [32m6[2mms[31m[22m[K[93C[m
[31m     → expected "spy" to be called at least once[57C[m
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22mhealthCheck[2m > [22mshould return healthy status when database is accessible [32m230[2mms[m      
[31m     → expected { status: 'unhealthy', …(2) } to deeply equal { status: 'healthy', connected: true }     [m
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22mhealthCheck[2m > [22mshould return unhealthy status when database is not accessible [32m17[2mms[m 
[31m     → expected { status: 'unhealthy', …(2) } to deeply equal { status: 'unhealthy', …(1) }[14C[m
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22mhealthCheck[2m > [22mshould handle database initialization errors [32m19[2mms[m[K[19C
[31m     → expected { status: 'unhealthy', …(2) } to deeply equal { status: 'unhealthy', …(1) }[14C[m
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22mdisconnect[2m > [22mshould disconnect all Firebase apps [32m12[2mms[m[K[29C
[31m     → default.disconnect is not a function[62C[m
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22mdisconnect[2m > [22mshould handle apps array with null values [32m5[2mms[m[K[24C
[31m     → default.disconnect is not a function[62C[m
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22mdisconnect[2m > [22mshould handle empty apps array [32m5[2mms[m[K[35C
[31m     → default.disconnect is not a function[62C[m
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22mdisconnect[2m > [22mshould handle app deletion errors gracefully [32m5[2mms[m[K[21C
[31m     → default.disconnect is not a function[62C[m
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22merror handling[2m > [22mshould handle malformed service account key [32m10[2mms[m[K[17C
[31m     → default.disconnect is not a function[62C[m
[31m   × DatabaseService[2m > [22msingleton behavior[2m > [22mshould maintain singleton pattern across multiple requires [32m6[2mm[m
[32m[2m[12;105Hms[22m[K[104C[m
[31m     → Database initialization failed[68C[m
[31m     → default.disconnect is not a function[62C[m
[90mstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection[m
[90m[2m[12;105Hn results[22m[K[97C[m
OCR Service initialized successfully[69C
[105C
[90mstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection[m
[90m[2m[12;105Hn results[22m[K[97C[m
Starting OCR processing for order test-order-123[57C
OCR attempt 1/3 for image: https://example.com/test-image.jpg[44C
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/database.test.ts[2m 17/17[22m[K[67C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m19 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m12.18s[K[87C[?2026l[?2026h
[4;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K[47C[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/database.test.ts[2m 17/17[33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 2/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m19 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m12.18s[K[87C[?2026l
[105C[?2026h[7;1H[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m[K
OCR attempt 2/3 for image: https://example.com/test-image.jpg[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/database.test.ts[2m 17/17[33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 2/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m19 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m12.18s[K[87C
[105C[?2026l[?2026h[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/database.test.ts[2m 17/17[22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m19 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m12.18s[K[87C[?2026l
[105C[?2026h[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m[K
OCR attempt 3/3 for image: https://example.com/test-image.jpg[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/database.test.ts[2m 17/17[33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 2/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m19 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m12.18s[K[87C[?2026l
[105C[?2026h[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty text detection results[m[K
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:100:11[90m)[K[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:29[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:84:22[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/database.test.ts[2m 17/17[22m[K[67C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 2/17[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m19 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m12.18s[K[87C[?2026l
[105C[?2026h[5;1H[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
Starting OCR processing for order test-order-123
OCR attempt 1/3 for image: https://example.com/test-image.jpg[33m[1m[9;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/database.test.ts[2m 17/17[33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 2/17[22m
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m19 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m12.18s[K[87C
[105C[?2026l[?2026h[K[105C[3;1H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K]0;node (vitest 5)[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR attempt 1 failed: (intermediate value) is not iterable[K[47C[33m[1m[5;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/database.test.ts[2m 17/17[33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 2/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][12;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [31m[22m[1m19 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m12.18s[K[87C[?2026l
[105C[?2026h[6;1H[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR attempt 2/3 for image: https://example.com/test-image.jpg[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 4/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][11;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[m[2m
   Start at [22m18:43:17
[2m   Duration [22m13.03s[K[87C
[105C[?2026l[?2026h[90m[2;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[m[2m
      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.03s[K[87C[?2026l[?2026h
[9;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[2;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR attempt 3/3 for image: https://example.com/test-image.jpg[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 4/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][12;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.03s[K[87C[?2026l[?2026h
[9;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[5;1H[K
[K
[K
[K[105C[90m[2;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle empty extracted text[m
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:100:11[90m)[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:29[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:98:22
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.03s[K[87C[?2026l[?2026h
[105C[7;1H[K
[K
[K
[K
[K
[K
[K[105C[90m[2;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
Starting OCR processing for order test-order-123[K
OCR attempt 1/3 for image: https://example.com/test-image.jpg[33m[1m[10;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 4/17[22m
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.03s[K[87C
[105C[?2026l[?2026h[11;1H[K
[K
[K[105C[90m[2;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR attempt 1 failed: (intermediate value) is not iterable[K
[K
[K
[K
[K
[K
[K
[K[105C[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 4/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][12;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.03s[K[87C[?2026l[?2026h
[90m[2;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR attempt 2/3 for image: https://example.com/test-image.jpg                                            
                                                                                                         
                                                                                                         [33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m                                                              [33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m                                                          [33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m                                                               [33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 4/17[22m                                                                  [33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m                                                                            
                                                                                                         [2m
 Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)                                                                      [m[2m
      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.03s[K[87C[?2026l[?2026h
[90m[2;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR attempt 2 failed: (intermediate value) is not iterable                                               
                                                                                                         
                                                                                                         [33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m                                                              [33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m                                                          [33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m                                                               [33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 4/17[22m                                                                  [33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m                                                                            
                                                                                                         [2m
 Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)                                                                      [m[2m
      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.03s[K[87C[?2026l[?2026h
[90m[2;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR attempt 3/3 for image: https://example.com/test-image.jpg                                            
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 4/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][12;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.03s[K[87C[?2026l[?2026h
[90m[2;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR attempt 3 failed: (intermediate value) is not iterable                                               
                                                                                                         [90m
stderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should retry on transient failures[m
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable                                                                              
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:100:11[90m)                                                                                                       [m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:29[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:116:22                           
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20            
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.03s[K[87C[?2026l[?2026h
[90m[2;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR Service initialized successfully                                                                     
                                                                                                         [90m
stdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
Starting OCR processing for order test-order-123                                                         
OCR attempt 1/3 for image: https://example.com/test-image.jpg                                            
                                                                                                         
                                                                                                         [33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m                                                              [33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m                                                          [33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m                                                               [33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 4/17[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.03s[K[87C[?2026l[?2026h
[90m[2;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR attempt 1 failed: (intermediate value) is not iterable                                               
                                                                                                         
                                                                                                         [33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m                                                              [33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m                                                          [33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m                                                               [33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 4/17[22m                                                                  [33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m                                                                            
                                                                                                         [2m
 Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)                                                                      [m[2m
      Tests [31m[22m[1m21 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.03s[K[87C
[105C[?2026l[?2026h[3;1H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[2;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR attempt 2/3 for image: https://example.com/test-image.jpg[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 5/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][12;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.37s[K[87C
[105C[?2026l[?2026h[90m[2;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[m[2m
      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.37s[K[87C[?2026l[?2026h
[5;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[2;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR attempt 3/3 for image: https://example.com/test-image.jpg[K
[K[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 5/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][12;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m[2m
      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.37s[K[87C[?2026l[?2026h
[105C[90m[2;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should fail after max retries[m     
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:100:11[90m)[K[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:29[90m)       [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:127:22[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C

[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.37s[K[87C[?2026l[?2026h
[3;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[2;1H[K[105C[90mstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m
OCR Service initialized successfully[90m[6;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m
Starting OCR processing for order test-order-123
OCR attempt 1/3 for image: https://example.com/test-image.jpg[33m[1m[12;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 5/17[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.37s[K[87C
[105C[?2026l[?2026h[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[9;1H[K[105C[7;1H[K
[K[105C[6;1H[K[105C[4;1H[K
[K[105C[3;1H[K[105C[2;1H[K[105C[90mstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m
OCR attempt 1 failed: (intermediate value) is not iterable[33m[1m[7;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 5/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m22 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m13.37s[K[87C
[105C[?2026l]0;node (vitest 6)]0;node (vitest 3)[?2026h[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[9;1H[K[105C[7;1H[K
[K[105C[6;1H[K[105C[3;1H[K
[K
[K[105C[2;1H[K[105C[90mstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m
OCR attempt 2/3 for image: https://example.com/test-image.jpg[33m[1m[7;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 6/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m23 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m14.09s[K[87C
[105C[?2026l[?2026h[K[105C[12;1H[K[105C[10;1H[K
[K[105C[9;1H[K[105C[6;1H[K
[K
[K[105C[2;1H[K
[K
[K
[K[105C[90m[2;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m
OCR attempt 2 failed: (intermediate value) is not iterable[33m[1m[7;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 6/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m23 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m14.09s[K[87C[?2026l
[105C[?2026h[11;1H[K
[K
[K[105C[10;1H[K[105C[7;1H[K
[K
[K[105C[6;1H[K[105C[4;1H[K
[K[105C[90m[2;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m[K
OCR attempt 3/3 for image: https://example.com/test-image.jpg[33m[1m[7;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 6/17[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m23 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m14.09s[K[87C
[105C[?2026l[?2026h[K[105C[8;1H[K
[K
[K
[K
[K[105C[7;1H[K[105C[4;1H[K
[K
[K[105C[90m[2;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[90m[6;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > processImage > should handle Vision API errors gracefully[m
OCR processing failed for order test-order-123: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:100:11[90m)[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:29[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:137:22
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 6/17[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m23 failed[m[2m | [32m[22m[1m0 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m14.09s[K[87C[?2026l
[105C[?2026h[K[105C[10;1H[K
[K
[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[3;1H[K
[K[105C[90m[2;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > validateImageForOCR > should validate correct image URLs[m
OCR Service initialized successfully[90m[6;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > validateImageForOCR > should reject empty or invalid URLs[m
OCR Service initialized successfully[90m[10;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > validateImageForOCR > should reject unsupported file types[m
OCR Service initialized successfully

[90mstdout[2m | src/features/ocrService.test.ts > OCRService > validateImageForOCR > should accept supported fil[m
[90m[2m[12;105Hle types[22m[K[98C[m
OCR Service initialized successfully[69C
[105C
[90mstdout[2m | src/features/ocrService.test.ts > OCRService > healthCheck > should return true when service is [m
[90m[2m[12;105H healthy[22m[K[98C[m
OCR Service initialized successfully[69C
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 8/17[22m[K[66C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m23 failed[m[2m | [32m[22m[1m2 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m14.91s[K[87C[?2026l
[105C[?2026h[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > healthCheck > should return false when service is unhealthy[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
Starting OCR processing for order test-order[K
OCR attempt 1/3 for image: https://example.com/image.jpg[K
[K[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 12/17[22m[K[65C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m25 failed[m[2m | [32m[22m[1m4 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m15.35s[K[87C[?2026l[?2026h
[6;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[4;1H[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[K[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 12/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m25 failed[m[2m | [32m[22m[1m4 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m15.35s[K[87C[?2026l
[105C[?2026h[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[8;1H[K
[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C[2;1H[K[105C[H[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m
OCR attempt 2/3 for image: https://example.com/image.jpg[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 13/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m4 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m15.74s[K[87C
[105C[?2026l[?2026h[11;1H[K
[K
[K[105C[6;1H[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[105C[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 13/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m4 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m15.74s[K[87C[?2026l[?2026h
[8;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR attempt 3/3 for image: https://example.com/image.jpg[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 13/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m4 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m15.74s[K[87C[?2026l[?2026h
[10;1H                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle malformed Vision API responses[m[K
OCR processing failed for order test-order: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:100:11[90m)[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:29[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:227:22
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 13/17[22m[K[65C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m4 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m15.74s[K[87C
[105C[?2026l[?2026h[K[105C[12;1H[K[105C[11;1H[K[105C[10;1H[K[105C[8;1H[K
[K[105C[7;1H[K[105C[4;1H[K
[K
[K[105C[3;1H[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m[K
OCR Service initialized successfully[90m[5;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m
Starting OCR processing for order test-order
OCR attempt 1/3 for image: https://example.com/image.jpg[33m[1m[11;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 13/17[22m[K[65C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m4 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m15.74s[K[87C[?2026l
[105C[?2026h[11;1H[K
[K
[K[105C[10;1H[K[105C[9;1H[K[105C[8;1H[K[105C[7;1H[K[105C[6;1H[K[105C[5;1H[K[105C[4;1H[K[105C[3;1H[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m[K
OCR attempt 1 failed: (intermediate value) is not iterable[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 13/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][13;1H Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m4 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m15.74s[K[87C
[105C[?2026l[?2026h[2;1H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m
OCR attempt 2/3 for image: https://example.com/image.jpg[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 14/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m16.92s[K[87C[?2026l[?2026h
[6;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 14/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m16.92s[K[87C[?2026l[?2026h
[11;1H                                                                                                         
                                                                                                         
[105C[3;1H[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m[K
OCR attempt 3/3 for image: https://example.com/image.jpg[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 14/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m16.92s[K[87C[?2026l
[105C[?2026h[9;1H[K
[K
[K
[K
[K[105C[7;1H[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle null/undefined responses[m[K
OCR processing failed for order test-order: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:100:11[90m)[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:29[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:239:22
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[65C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/users.test.ts[2m [queued][22m[K[67C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m16.92s[K[87C
[105C[?2026l[?2026h[2;1H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR Service initialized successfully[90m[4;1Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m
Starting OCR processing for order test-order
OCR attempt 1/3 for image: https://example.com/image.jpg[33m[1m[9;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 14/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued]]0;node (vitest 4)[22m
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/users.test.ts[2m [queued][22m[K[67C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m16.92s[K[87C[?2026l
[105C[?2026h[12;1H[K
[K[105C[11;1H[K[105C[7;1H[K
[K
[K
[K[105C[3;1H[K
[K
[K
[K[105C[2;1H[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR attempt 1 failed: (intermediate value) is not iterable[33m[1m[5;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 14/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m

[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m16.92s[K[87C[?2026l[?2026h
[12;1H                                                                                                         
[105C[5;1H[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR attempt 2/3 for image: https://example.com/image.jpg[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 14/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m

[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m16.92s[K[87C[?2026l
[105C[?2026h[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR attempt 2 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 14/17[22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m26 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m16.92s[K[87C[?2026l
[105C[?2026h[7;1H[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR attempt 3/3 for image: https://example.com/image.jpg[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 15/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m

[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m27 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m17.68s[K[87C[?2026l[?2026h
[12;1H                                                                                                         
[105C[3;1H[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m 
OCR attempt 3 failed: (intermediate value) is not iterable[K[90m[4;1Hstderr[2m | src/features/ocrService.test.ts > OCRService > error scenarios > should handle network timeouts[m
OCR processing failed for order test-order: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:100:11[90m)[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:29[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:250:22
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[13;1H
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 15/17[22m[K[65C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/users.test.ts[2m [queued][22m[K[67C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m27 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m17.68s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m[K
Starting OCR processing for order perf-test[K
OCR attempt 1/3 for image: https://example.com/image.jpg[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 15/17[22m[K[65C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/users.test.ts[2m [queued][22m[K[67C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m27 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m17.68s[K[87C[?2026l
[105C[?2026h[11;1H[K
[K
[K[105C[H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m
OCR attempt 1 failed: (intermediate value) is not iterable[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 15/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m27 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m17.68s[K[87C
[105C[?2026l[?2026h[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m[K
OCR attempt 2/3 for image: https://example.com/image.jpg[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 15/17[22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m27 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m17.68s[K[87C[?2026l[?2026h
[3;1H                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
                                                                                                         
[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 15/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m27 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m17.68s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m[K
OCR attempt 3/3 for image: https://example.com/image.jpg[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 15/17[22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m27 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m17.68s[K[87C
[105C[?2026l[?2026h[K[105C[7;1H[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 15/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m27 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m17.68s[K[87C[?2026l
[105C[?2026h[8;1H[K
[K
[K
[K
[K
[K[105C[7;1H[K[105C[H[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should process image within reasonable time[m
OCR processing failed for order perf-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:100:11[90m)[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:29[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:268:22
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[33m[1m[12;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 16/17[22m[K[65C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/users.test.ts[2m [queued][22m[K[67C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m28 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m18.32s[K[87C[?2026l
[105C[?2026h[5;1H[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR Service initialized successfully[K
[K[90m
stdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m
Starting OCR processing for order large-text-test
OCR attempt 1/3 for image: https://example.com/large-image.jpg[33m[1m[11;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m
[33m[1m ❯ [msrc/features/ocrService.test.ts[2m 16/17[22m[K[65C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/users.test.ts[2m [queued][22m[K[67C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m28 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m18.43s[K[87C
[105C[?2026l[?2026h[11;1H[K
[K
[K[105C[H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m
OCR attempt 1 failed: (intermediate value) is not iterable[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 16/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m28 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m18.43s[K[87C[?2026l[?2026h
[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR attempt 2/3 for image: https://example.com/large-image.jpg[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 16/17[22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m28 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m18.43s[K[87C
[105C[?2026l[?2026h[6;1H[K
[K
[K
[K
[K
[K
[K
[K[105C[3;1H[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR attempt 2 failed: (intermediate value) is not iterable[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrService.test.ts[2m 16/17[33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m
[105C
[2m Test Files [31m[22m[1m1 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m28 failed[m[2m | [32m[22m[1m5 passed[90m[22m (34)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m18.43s[K[87C[?2026l
[105C[?2026h[4;1H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstdout[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR attempt 3/3 for image: https://example.com/large-image.jpg[K[33m[1m[6;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/users.test.ts[2m 0/21[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m

[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m5 passed[90m[22m (55)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m18.78s[K[87C[?2026l[?2026h
[105C[10;1H[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR attempt 3 failed: (intermediate value) is not iterable[K
[K[90m
stderr[2m | src/features/ocrService.test.ts > OCRService > performance considerations > should handle large text extraction[m[K
OCR processing failed for order large-text-test: Error: OCR failed after 3 attempts. Last error: (intermediate value) is not iterable[K
    at OCRService.extractTextWithRetry [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:100:11[90m)[m
    at OCRService.processImage [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.ts:34:29[90m)[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\ocrService.test.ts:284:22
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/users.test.ts[2m 0/21[22m[K[71C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m5 passed[90m[22m (55)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m18.78s[K[87C[?2026l[?2026h
[10;1H                                                                                                         
                                                                                                         
                                                                                                         
[105C[H[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[H [31m❯ [msrc/features/ocrService.test.ts [2m(17 tests | [31m[22m12 failed[m[2m)[33m[22m 8441[2mms[m[K[31m
   × OCRService[2m > [22mprocessImage[2m > [22mshould successfully extract text from image [33m708[2mms[31m[22m
     → expected false to be true // Object.is equality
   × OCRService[2m > [22mprocessImage[2m > [22mshould handle empty text detection results [33m1139[2mms[31m[22m
     → expected 'OCR failed after 3 attempts. Last err…' to be 'OCR failed after 3 attempts. Last err…' // Object.is equality
   × OCRService[2m > [22mprocessImage[2m > [22mshould handle empty extracted text [33m417[2mms[31m[22m
     → expected 'OCR failed after 3 attempts. Last err…' to be 'OCR failed after 3 attempts. Last err…' // Object.is equality
   × OCRService[2m > [22mprocessImage[2m > [22mshould retry on transient failures [33m438[2mms[31m[22m
     → expected false to be true // Object.is equality
   × OCRService[2m > [22mprocessImage[2m > [22mshould fail after max retries [33m361[2mms[31m[22m
     → expected 'OCR failed after 3 attempts. Last err…' to be 'OCR failed after 3 attempts. Last err…' /[m
[31m[12;105H// Object.is equality[85C[m
[31m   × OCRService[2m > [22mprocessImage[2m > [22mshould handle Vision API errors gracefully [33m369[2mms[m[K[24C
[31m     → expected 'OCR failed after 3 attempts. Last err…' to contain 'QUOTA_EXCEEDED'[21C[m
   [33m[2m✓[m OCRService[2m > [22mvalidateImageForOCR[2m > [22mshould validate correct image URLs  [33m475[2mms[m[K[24C
   [33m[2m✓[m OCRService[2m > [22mvalidateImageForOCR[2m > [22mshould reject empty or invalid URLs  [33m687[2mms[m[K[23C
   [32m✓ [mOCRService[2m > [22mvalidateImageForOCR[2m > [22mshould reject unsupported file types [32m44[2mms[m[K[24C
   [32m✓ [mOCRService[2m > [22mvalidateImageForOCR[2m > [22mshould accept supported file types [32m35[2mms[m[K[26C
[31m   × OCRService[2m > [22mhealthCheck[2m > [22mshould return true when service is healthy [32m26[2mms[m[K[26C
[31m     → expected "spy" to be called at least once[57C[m
[31m   × OCRService[2m > [22mhealthCheck[2m > [22mshould return false when service is unhealthy [33m366[2mms[m[K[22C
[31m     → expected true to be false // Object.is equality[51C[m
[31m   × OCRService[2m > [22merror scenarios[2m > [22mshould handle malformed Vision API responses [33m388[2mms[m[K[19C
[31m     → expected 'OCR failed after 3 attempts. Last err…' to contain 'No text detected in the image'      [m
   [33m[2m✓[m OCRService[2m > [22merror scenarios[2m > [22mshould handle null/undefined responses  [33m437[2mms[m[K[24C
[31m   × OCRService[2m > [22merror scenarios[2m > [22mshould handle network timeouts [33m1112[2mms[m[K[32C
[31m     → expected 'OCR failed after 3 attempts. Last err…' to contain 'TIMEOUT'[28C[m
[31m   × OCRService[2m > [22mperformance considerations[2m > [22mshould process image within reasonable time [33m647[2mms[m[K[9C
[31m     → expected false to be true // Object.is equality[51C[m
[31m   × OCRService[2m > [22mperformance considerations[2m > [22mshould handle large text extraction [33m732[2mms[m[K[17C
[31m     → expected false to be true // Object.is equality[51C[m
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/users.test.ts[2m 0/21[22m[K[71C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m5 passed[90m[22m (55)[K[68C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m18.78s[K[87C[?2026l
[105C[?2026h[90m[Hstderr[2m | src/features/users.test.ts > UserService > createUser > should reject invalid user data[m[K
Error creating user: Error: Validation failed: role is required and must be one of: patient, caregiver, doctor, pharmacist, displayName is required and must be a non-empty string, Either email or phoneNumber must be provided[K
    at UserService.createUser [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.ts:25:15[90m)[K[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:119:32[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)[K
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)[K
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > createUser > should handle database errors[m[K[11C
Error creating user: Error: Firestore error[62C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:125:37[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > getUserById > should reject invalid uid[m[K[14C
Error getting user: Error: Valid UID is required[57C
    at UserService.getUserById [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.ts:65:15[90m)[K[12C[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:187:32[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > getUserById > should reject invalid uid[m[K[14C
Error getting user: Error: Valid UID is required[57C
    at UserService.getUserById [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.ts:65:15[90m)[K[12C[m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:190:32[K[32C
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20[K[12C
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > getUserById > should handle database errors[m[K[10C
Error getting user: Error: Firestore error[63C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:196:37[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > updateUser > should reject update for non-existent us[m
[90m[2m[12;105Hser[22m[K[103C[m
Error updating user: Error: User not found[63C
    at UserService.updateUser [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.ts:107:15[90m)[K[12C[m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > updateUser > should handle database errors[m[K[11C
Error updating user: Error: Firestore error[62C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:251:40[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > deleteUser > should handle database errors[m[K[11C
Error deleting user: Error: Firestore error[62C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:293:40[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C[13;3H  at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > getUsersByRole > should reject invalid role[m[K[10C
Error getting users by role: Error: Invalid user role[52C
    at UserService.getUsersByRole [90m(C:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.ts:182:15[90m)        [m
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:338:32[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/users.test.ts[2m 12/21[22m[K[70C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m0 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m17 passed[90m[22m (55)[K[67C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m19.04s[K[87C[?2026l
[105C[?2026h[K[105C[5;1H[K
[K
[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/users.test.ts > UserService > getUsersByRole > should handle database errors[m       
Error getting users by role: Error: Firestore error[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:343:44[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)[90m
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
[105C
[90mstderr[2m | src/features/users.test.ts > UserService > userExists > should return false on errors[m[K[11C
Error checking user existence: Error: Database error[53C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\users.test.ts:372:62[K[32C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m 0/20[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m1 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m26 passed[90m[22m (75)[K[67C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m19.27s[K[87C
[105C[?2026l[?2026h[11;1H[K
[K
[K[105C[H [32m✓ [msrc/features/users.test.ts [2m(21 tests)[33m[22m 482[2mms[m[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m 0/20[22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m1 passed[90m[22m (9)[K[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m26 passed[90m[22m (75)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m19.27s[?2026l
[105C[?2026h[K[105C[H[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K
[K[105C[?2026l[33m[1m[2;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/userRoutes.test.ts[2m 1/20[33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][9;1H Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m1 passed[90m[22m (9)[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m27 passed[90m[22m (75)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m19.71s[?2026h[8;1H[K
[K
[K
[K
[K
[K[105C[90m[Hstderr[2m | src/features/userRoutes.test.ts > User Routes > POST /users > should handle service errors[m      
Error in POST /users: Error: Service error[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:109:57[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)[K
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)[90m
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
[105C
[90mstderr[2m | src/features/userRoutes.test.ts > User Routes > POST /users > should handle unknown errors[m      
Error in POST /users: Unknown error[70C
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m 4/20[22m[K[66C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m1 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m30 passed[90m[22m (75)[K[67C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m19.93s[K[87C[?2026l
[105C[?2026h[90m[Hstderr[2m | src/features/userRoutes.test.ts > User Routes > GET /users/:uid > should handle service errors[m  
Error in GET /users/:uid: Error: Service error[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:176:58[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)[K
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)[K
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) [90m
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[K[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/userRoutes.test.ts > User Routes > PUT /users/:uid > should return 404 when user no[m
[90m[2m[12;105Hot found[22m[K[98C[m
Error in PUT /users/:uid: Error: User not found[58C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:222:57[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/userRoutes.test.ts > User Routes > PUT /users/:uid > should handle validation error[m
[90m[2m[12;105Hrs[22m[K[104C[m
Error in PUT /users/:uid: Error: Validation failed[55C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:235:57[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m 10/20[22m[K[65C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m1 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m36 passed[90m[22m (75)[K[67C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m20.15s[K[87C[?2026l
[105C]0;node (vitest 1)]0;node (vitest 5)[?2026h[90m[Hstderr[2m | src/features/userRoutes.test.ts > User Routes > DELETE /users/:uid > should handle service errors[m[K
Error in DELETE /users/:uid: Error: Service error[K
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:277:57[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K
    at new Promise (<anonymous>)[K
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)[K
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) [90m
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[K[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[90mstderr[2m | src/features/userRoutes.test.ts > User Routes > GET /users/role/:role > should handle service er[m
[90m[2m[12;105Hrrors[22m[K[101C[m
Error in GET /users/role/:role: Error: Service error[53C
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:336:61[K[27C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26[K[12C
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20[K[11C
    at new Promise (<anonymous>)[73C
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:18
[12;105H863:10)[99C
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12) 
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[31C[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m 13/20[22m[K[65C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m1 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m39 passed[90m[22m (75)[K[67C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m20.26s[K[87C[?2026l
[105C[?2026h[K[105C[6;1H[K
[K
[K
[K
[K
[K
[K[105C[3;1H[K
[K
[K[105C[90m[Hstderr[2m | src/features/userRoutes.test.ts > User Routes > GET /users/:uid/exists > should handle service errors[m[K
Error in GET /users/:uid/exists: Error: Service error
    at [90mC:\Users\akgte\PharmaRx\apps\api\[msrc\features\userRoutes.test.ts:382:57
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)[90m
    at processTicksAndRejections (node:internal/process/task_queues:105:5)[m
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)]0;node (vitest 3)
    at runSuite (file:///C:/Users/akgte/PharmaRx/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8) 
[105C
[105C
[33m[1m ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[62C
[33m[1m ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[58C
[33m[1m ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[63C
[33m[1m ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[49C
[33m[1m ❯ [msrc/features/userRoutes.test.ts[2m 17/20[22m[K[65C
[33m[1m ❯ [msrc/index.test.ts[2m [queued][22m[K[76C
[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m1 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m43 passed[90m[22m (75)[K[67C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m20.47s[K[87C[?2026l
[105C[?2026h[11;1H[K
[K
[K[105C[7;1H[K
[K
[K
[K[105C[3;1H[K
[K
[K
[K[105C[H [32m✓ [msrc/features/userRoutes.test.ts [2m(20 tests)[33m[22m 1104[2mms[m[K
   [33m[2m✓[m User Routes[2m > [22mPOST /users[2m > [22mshould create a user successfully  [33m341[2mms[m[K[33m[1m[4;1H ❯ [msrc/features/authRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][33m[22m[1m
 ❯ [msrc/index.test.ts[2m [queued][10;1H Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m46 passed[90m[22m (75)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m20.70s[?2026l
[105C[?2026h[8;1H[K
[K
[K
[K
[K
[K[105C[?2026l[2;1H[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K[2m[9;1H Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m46 passed[90m[22m (75)[m[2m
   Start at [22m18:43:17[2m
   Duration [22m21.21s[?2026h[?2026l[2;1H[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[K[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m46 passed[90m[22m (75)[K[m[2m
   Start at [22m18:43:17[K[2m
   Duration [22m21.75s[K
[K[105C]0;node (vitest 6)[?2026h[?2026l[2;1H[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[K[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m46 passed[90m[22m (75)[K[m[2m
   Start at [22m18:43:17[K[2m
   Duration [22m22.22s[K
[K[105C[?2026h[?2026l[2;1H[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[K[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m46 passed[90m[22m (75)[K[m[2m
   Start at [22m18:43:17[K[2m
   Duration [22m22.77s[K
[K[105C[?2026h[12;1H[K
[K[105C[11;1H[K[105C[2;1H[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[K[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m46 passed[90m[22m (75)[K[m[2m
   Start at [22m18:43:17[2m
   Duration [22m23.19s[?2026l[?2026h[?2026l[2;1H[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m [queued][22m[K
[K[2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[K[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m46 passed[90m[22m (75)[K[m[2m
   Start at [22m18:43:17[K[2m
   Duration [22m23.73s[K
[K[105C[?2026h[90m[2;1Hstdout[2m | src/index.test.ts[m[K
Using Google Cloud Application Default Credentials[K
OCR Service initialized successfully[K
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m 0/3[22m[K
[K[2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m46 passed[90m[22m (78)[K[67C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m23.94s[K[87C[?2026l[?2026h
[90m[2;1Hstderr[2m | src/index.test.ts[m                                                                               
No explicit Google Cloud credentials found. Falling back to Application Default Credentials (ADC)        
                                                                                                         
                                                                                                         [33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m                                                              [33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m                                                          [33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m                                                               [33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m                                                 [33m[1m
 ❯ [msrc/index.test.ts[2m 0/3[22m                                                                                 
                                                                                                         [2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)                                                                      [m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m46 passed[90m[22m (78)[K[67C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m23.94s[K[87C[?2026l
[105C[?2026h[?2026l[2;1H[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m 0/3[22m[K
[K[2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[K[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m46 passed[90m[22m (78)[K[m[2m
   Start at [22m18:43:17[K[2m
   Duration [22m24.16s[K
[K[105C[?2026h[2;1H::ffff:127.0.0.1 - - [28/Jul/2025:22:43:42 +0000] "GET /health HTTP/1.1" 200 75 "-" "-"[K
::ffff:127.0.0.1 - - [28/Jul/2025:22:43:42 +0000] "GET /api HTTP/1.1" 200 37 "-" "-"[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m 2/3[22m[K
[K[2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[K[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m48 passed[90m[22m (78)[K[m[2m
   Start at [22m18:43:17[K[85C
[2m   Duration [22m24.49s[K[87C[?2026l
[105C[?2026h[?2026l[2;1H[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m 2/3[22m[K
[K[2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[K[m[2m
      Tests [31m[22m[1m29 failed[m[2m | [32m[22m[1m48 passed[90m[22m (78)[K[m[2m
   Start at [22m18:43:17[K[2m
   Duration [22m24.82s[K
[K[105C[?2026h[2;1H(node:4372) MetadataLookupWarning: received unexpected error = All promises were rejected code = UNKNOWN 
(Use `node --trace-warnings ...` to show where the warning was created)[K[90m
stderr[2m | src/index.test.ts > API Server > should return 404 for unknown routes[m[K[90m
undefined[K[m
[K
[K[33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m[K[33m[1m
 ❯ [msrc/index.test.ts[2m 3/3[22m[K
[K[105C
[2m Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)[K[70C[m
[2m      Tests [31m[22m[1m30 failed[m[2m | [32m[22m[1m48 passed[90m[22m (78)[K[67C[m
[2m   Start at [22m18:43:17[K[85C
[2m   Duration [22m24.93s[K[87C[?2026l[?2026h
[2;1H::ffff:127.0.0.1 - - [28/Jul/2025:22:43:42 +0000] "GET /unknown-route HTTP/1.1" 500 1215 "-" "-"         
                                                                                                         [33m[1m
 ❯ [msrc/features/authRoutes.test.ts[2m [queued][22m                                                              [33m[1m
 ❯ [msrc/features/ocrIntegration.test.ts[2m [queued][22m                                                          [33m[1m
 ❯ [msrc/features/ocrRoutes.test.ts[2m [queued][22m                                                               [33m[1m
 ❯ [msrc/features/prescriptionOrderRoutes.test.ts[2m [queued][22m                                                 [33m[1m
 ❯ [msrc/index.test.ts[2m 3/3[22m                                                                                 
                                                                                                         [2m
 Test Files [31m[22m[1m2 failed[m[2m | [32m[22m[1m2 passed[90m[22m (9)                                                                      [m[2m
      Tests [31m[22m[1m30 failed[m[2m | [32m[22m[1m48 passed[90m[22m (78)                                                                   [m[2m
   Start at [22m18:43:17                                                                                     [2m
   Duration [22m24.93s[K[87C[?2026l
[105C[K[105C[2;1H [31m❯ [msrc/index.test.ts [2m(3 tests | [31m[22m1 failed[m[2m)[33m[22m 971[2mms[m[K
   [33m[2m✓[m API Server[2m > [22mshould respond to health check  [33m305[2mms[m[K
   [32m✓ [mAPI Server[2m > [22mshould respond to API endpoint [32m147[2mms[m[K[31m
   × API Server[2m > [22mshould return 404 for unknown routes [33m504[2mms[m[K[31m
     → expected 404 "Not Found", got 500 "Internal Server Error"[K[m
[K
[K
[K
[K
[K
[K[105C[31m[8;1H⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[39m[41m[1m Failed Suites 4 [31m[49m[22m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[m[41m[1m[10;1H FAIL [m src/features/authRoutes.test.ts[2m [ src/features/authRoutes.test.ts ][22m[31m[1m
Error[22m: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock[m
[105C[36m [2m❯[22m src/features/authRoutes.ts:[2m4:1[m
[105C      [90m2| [35mimport [m{ [33mUserRole, CreateUserInput [m} [35mfrom [32m'@pharmarx/shared-types'[33m;[m
      [90m3| [35mimport [muserService [35mfrom [32m'./users'[33m;[K[62C[m
      [90m4| [35mimport [madmin [35mfrom [32m'firebase-admin'[33m;[K[61C[m
       [90m| [31m^[K[95C[m
      [90m5|[K[97C[m
      [90m6| [35mconst [mrouter [33m= Router[m()[33m;[K[72C[m
[105C
[105C[31m[1mCaused by: ReferenceError[22m: Cannot access 'mockInitializeApp' before initialization[m
[105C[36m [2m❯[22m src/features/authRoutes.test.ts:[2m16:20[m
[105C[90m [2m❯[22m src/features/authRoutes.ts:[2m4:1[m
[105C
[105C[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/48]⎯[m
[105C
[105C[41m[1m FAIL [m src/features/ocrIntegration.test.ts[2m [ src/features/ocrIntegration.test.ts ][22m
[105C[31m[1mReferenceError[22m: mockTextDetection is not defined[m
[105C[36m [2m❯[22m fn.<anonymous> src/features/ocrIntegration.test.ts:[2m15:22[m
[105C     [90m13|   [mvi[33m.[34mmock[m([32m'@google-cloud/vision'[33m, [m() [33m=> [m({
     [90m14|     [33mImageAnnotatorClient: [mvi[33m.[34mfn[m()[33m.[34mmockImplementation[m(() [33m=> [m({[K[35C
     [90m15|       [mtextDetection[33m: [mmockTextDetection[33m,[K[57C[m
       [90m|[22X[31m[22C^[K[74C[m
     [90m16|       [mgetProjectId[33m: [mmockGetProjectId[K[60C
     [90m17|     [m}))[K[89C
[105C[90m [2m❯[22m new OCRService src/features/ocrService.ts:[2m20:19[m
[105C[90m [2m❯[22m src/features/ocrService.ts:[2m164:27[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/48]⎯[m
[105C
[105C[41m[1m FAIL [m src/features/ocrRoutes.test.ts[2m [ src/features/ocrRoutes.test.ts ][22m
[105C[31m[1mError[22m: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure t[m
[31m[12;105Hthere are no top level variables inside, since this call is hoisted to top of the file. Read more: https:/[m
[31m[12;105H//vitest.dev/api/vi.html#vi-mock[74C[m
[105C[36m [2m❯[22m src/features/ocrRoutes.ts:[2m2:1[m
[105C      [90m1| [35mimport [m{ [33mRequest, Response, Router [m} [35mfrom [32m'express'[33m;[m
      [90m2| [35mimport [m{ ocrService } [35mfrom [32m'./ocrService'[33m;[K[54C[m
       [90m| [31m^[K[95C[m
      [90m3| [35mimport [m{ [33mOCRProcessingRequest, OCRStatusResponse, ApiResponse [m} [35mfrom [32m'@pharmarx/shared-types'[33m;  [m
      [90m4| [35mimport [m{ db } [35mfrom [32m'./database'[33m;[K[64C[m
[105C
[31m[1mCaused by: ReferenceError[22m: Cannot access 'mockOcrService' before initialization[K[26C[m
[105C[36m [2m❯[22m src/features/ocrRoutes.test.ts:[2m19:15[m
[90m [2m❯[22m src/features/ocrRoutes.ts:[2m2:1[m[K[73C
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/48]⎯[m
[105C
[41m[1m FAIL [m src/features/prescriptionOrderRoutes.test.ts[2m [ src/features/prescriptionOrderRoutes.test.ts ][22m     
[31m[1mError[22m: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure t[m
[31m[12;105Hthere are no top level variables inside, since this call is hoisted to top of the file. Read more: https:/[m
[31m[12;105H//vitest.dev/api/vi.html#vi-mock[74C[m
[36m [2m❯[22m src/features/prescriptionOrderRoutes.ts:[2m3:1[m[K[59C
[105C      [90m1| [35mimport [m{ [33mRequest, Response, Router [m} [35mfrom [32m'express'[33m;[m
      [90m2| [mimport { PrescriptionOrder, CreatePrescriptionOrderInput, PrescriptionOrderStatus, ApiResponse …
      [90m3| [35mimport [m{ db } [35mfrom [32m'./database'[33m;[K[64C[m
       [90m| [31m^[K[95C[m
      [90m4| [35mimport [m{ ocrService } [35mfrom [32m'./ocrService'[33m;[K[54C[m
      [90m5| [35mimport [madmin [35mfrom [32m'firebase-admin'[33m;[K[61C[m
[105C
[31m[1mCaused by: ReferenceError[22m: Cannot access 'mockDb' before initialization[K[34C[m
[36m [2m❯[22m src/features/prescriptionOrderRoutes.test.ts:[2m30:7[m[K[53C
[90m [2m❯[22m src/features/prescriptionOrderRoutes.ts:[2m3:1[m[K[59C
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/48]⎯[m
[105C
[105C
[31m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[39m[41m[1m Failed Tests 30 [31m[49m[22m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[m
[105C
[105C[41m[1m FAIL [m src/index.test.ts[2m > [22mAPI Server[2m > [22mshould return 404 for unknown routes
[31m[1mError[22m: expected 404 "Not Found", got 500 "Internal Server Error"[K[41C[m
[36m [2m❯[22m src/index.test.ts:[2m31:8[m[K[80C
[105C     [90m29|     [35mconst [mresponse [33m= [35mawait [34mrequest[m(app)
     [90m30|       [33m.[35mget[m([32m'/unknown-route'[m)[K[68C
     [90m31|       [33m.[34mexpect[m([34m404[m)[K[78C
       [90m|        [31m^[K[88C[m
     [90m32|[K[97C[m
     [90m33|     [34mexpect[m(response[33m.[mbody)[33m.[34mtoEqual[m({[K[61C
[90m [2m❯[22m Test._assertStatus ../../node_modules/supertest/lib/test.js:[2m309:14[m[K[36C
[90m [2m❯[22m ../../node_modules/supertest/lib/test.js:[2m365:13[m[K[55C
[90m [2m❯[22m Test._assertFunction ../../node_modules/supertest/lib/test.js:[2m342:13[m[K[34C
[90m [2m❯[22m Test.assert ../../node_modules/supertest/lib/test.js:[2m195:23[m[K[43C
[90m [2m❯[22m localAssert ../../node_modules/supertest/lib/test.js:[2m138:14[m[K[43C
[90m [2m❯[22m Server.<anonymous> ../../node_modules/supertest/lib/test.js:[2m152:11[m[K[36C
[105C
[105C[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetInstance[2m > [22mshould return singleton instance  
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould initialize Firebase and return Fi
[12;105Hirestore instance[89C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould not reinitialize if already initi
[12;105Hialized[99C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould initialize with development setti
[12;105Hings[102C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould initialize with test settings    
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould use default project ID if not spe
[12;105Hecified in development[84C
[105C[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould initialize with production settin
[12;105Hngs[103C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould use application default credentia
[12;105Hals in production if no service account key[63C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mhealthCheck[2m > [22mshould return healthy status when 
[12;105H database is accessible[83C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mhealthCheck[2m > [22mshould return unhealthy status whe
[12;105Hen database is not accessible[77C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mhealthCheck[2m > [22mshould handle database initializat
[12;105Htion errors[95C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mdisconnect[2m > [22mshould disconnect all Firebase apps
[105C[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mdisconnect[2m > [22mshould handle apps array with null 
[12;105H values[99C
[105C[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mdisconnect[2m > [22mshould handle empty apps array
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mdisconnect[2m > [22mshould handle app deletion errors g
[12;105Hgracefully[96C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22merror handling[2m > [22mshould handle malformed service
[12;105He account key[93C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22msingleton behavior[2m > [22mshould maintain singleton p
[12;105Hpattern across multiple requires[74C
[31m[1mTypeError[22m: default.disconnect is not a function[K[58C[m
[36m [2m❯[22m src/features/database.test.ts:[2m57:27[m[K[67C
[105C     [90m55|   [34mafterEach[m([35masync [m() [33m=> [m{
     [90m56|     // Clean up any initialized Firebase apps[K[51C[m
     [90m57|     [35mawait [mdatabaseService[33m.[34mdisconnect[m()[33m;[K[57C[m
       [90m|[27X[31m[27C^[K[69C[m
     [90m58|   [m})[33m;[K[91C[m
     [90m59|[K[97C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould not reinitialize if already initi
[12;105Hialized[99C
[105C[31m[1mAssertionError[22m: expected "spy" to be called at least once[m
[36m [2m❯[22m src/features/database.test.ts:[2m91:31[m[K[67C
     [90m89|       // initializeApp should not be called again[K[47C[m
     [90m90|       [34mexpect[m(admin[33m.[minitializeApp)[33m.[mnot[33m.[34mtoHaveBeenCalled[m()[33m;[K[39C[m
     [90m91|       [34mexpect[m(admin[33m.[mfirestore)[33m.[34mtoHaveBeenCalled[m()[33m;[K[47C[m
       [90m|[31X[31m[31C^[K[65C[m
     [90m92|     [m})[33m;[K[89C[m
     [90m93|[K[97C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould initialize with development setti
[12;105Hings[102C
[105C[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ { projectId: 'test-project-dev' } ][m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[36m [2m❯[22m src/features/database.test.ts:[2m100:35[m[K[66C
     [90m98|       [mdatabaseService[33m.[34mgetDb[m()[33m;[K[66C[m
     [90m99|[K[97C[m
    [90m100|       [34mexpect[m(admin[33m.[minitializeApp)[33m.[34mtoHaveBeenCalledWith[m({[K[40C
       [90m|[35X[31m[35C^[K[61C[m
    [90m101|[9X[m[9CprojectId[33m: [32m'test-project-dev'[K[59C[m
    [90m102|       [m})[33m;[K[87C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould initialize with test settings    
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ { projectId: 'test-project' } ][K[12C[m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[36m [2m❯[22m src/features/database.test.ts:[2m115:35[m[K[66C
[105C    [90m113|       [mdatabaseService[33m.[34mgetDb[m()[33m;[m
    [90m114|[K[97C[m
    [90m115|       [34mexpect[m(admin[33m.[minitializeApp)[33m.[34mtoHaveBeenCalledWith[m({[K[40C
       [90m|[35X[31m[35C^[K[61C[m
    [90m116|[9X[m[9CprojectId[33m: [32m'test-project'[K[63C[m
    [90m117|       [m})[33m;[K[87C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould use default project ID if not spe
[12;105Hecified in development[84C
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ { projectId: 'pharmarx-dev' } ][K[12C[m
[90m[105C[m
[90mNumber of calls: [1m0[22m[K[87C[m
[90m[105C[m
[36m [2m❯[22m src/features/database.test.ts:[2m130:35[m[K[66C
    [90m128|       [mdatabaseService[33m.[34mgetDb[m()[33m;[K[66C[m
    [90m129|[K[97C[m
    [90m130|       [34mexpect[m(admin[33m.[minitializeApp)[33m.[34mtoHaveBeenCalledWith[m({[K[40C
       [90m|[35X[31m[35C^[K[61C[m
    [90m131|[9X[m[9CprojectId[33m: [32m'pharmarx-dev'[K[63C[m
    [90m132|       [m})[33m;[K[87C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould initialize with production settin
[12;105Hngs[103C
[105C[31m[1mAssertionError[22m: expected "spy" to be called at least once[m
[36m [2m❯[22m src/features/database.test.ts:[2m149:37[m[K[66C
    [90m147|       [mdatabaseService[33m.[34mgetDb[m()[33m;[K[66C[m
    [90m148|[K[97C[m
    [90m149|       [34mexpect[m(admin[33m.[mcredential[33m.[mcert)[33m.[34mtoHaveBeenCalled[m()[33m;[K[41C[m
       [90m|[37X[31m[37C^[K[59C[m
    [90m150|       [34mexpect[m(admin[33m.[minitializeApp)[33m.[34mtoHaveBeenCalledWith[m({[K[40C
    [90m151|[9X[m[9Ccredential[33m: [mexpect[33m.[34manything[m()[33m,[K[58C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mgetDb[2m > [22mshould use application default credentia
[12;105Hals in production if no service account key[63C
[31m[1mAssertionError[22m: expected "spy" to be called at least once[K[48C[m
[36m [2m❯[22m src/features/database.test.ts:[2m168:51[m[K[66C
    [90m166|       [mdatabaseService[33m.[34mgetDb[m()[33m;[K[66C[m
    [90m167|[K[97C[m
    [90m168|       [34mexpect[m(admin[33m.[mcredential[33m.[mapplicationDefault)[33m.[34mtoHaveBeenCalled[m()[33m;[K[27C[m
       [90m|[51X[31m[51C^[K[45C[m
    [90m169|       [34mexpect[m(admin[33m.[minitializeApp)[33m.[34mtoHaveBeenCalledWith[m({[K[40C
    [90m170|[9X[m[9Ccredential[33m: [mexpect[33m.[34manything[m()[33m,[K[58C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mhealthCheck[2m > [22mshould return healthy status when 
[12;105H database is accessible[83C
[105C[31m[1mAssertionError[22m: expected { status: 'unhealthy', …(2) } to deeply equal { status: 'healthy', connected: tr[m
[31m[12;105Hrue }[101C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[2m  {[22m[K[102C
[32m-   "connected": true,[83C[m
[32m-   "status": "healthy",[81C[m
[31m+   "projectId": "unknown",[78C[m
[31m+   "status": "unhealthy",[79C[m
[31m+   "timestamp": 2025-07-28T22:43:28.233Z,[63C[m
[2m  }[22m[K[102C
[105C
[36m [2m❯[22m src/features/database.test.ts:[2m192:22[m[K[66C
    [90m190|       [35mconst [mresult [33m= [35mawait [mdatabaseService[33m.[34mhealthCheck[m()[33m;[K[39C[m
    [90m191|[K[97C[m
    [90m192|       [34mexpect[m(result)[33m.[34mtoEqual[m({[K[66C
       [90m|[22X[31m[22C^[K[74C[m
    [90m193|[9X[m[9Cstatus[33m: [32m'healthy'[33m,[K[70C[m
    [90m194|[9X[m[9Cconnected[33m: [35mtrue[K[73C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mhealthCheck[2m > [22mshould return unhealthy status whe
[12;105Hen database is not accessible[77C
[31m[1mAssertionError[22m: expected { status: 'unhealthy', …(2) } to deeply equal { status: 'unhealthy', …(1) }     [m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[2m  {[22m[K[102C
[32m-   "connected": false,[82C[m
[31m+   "projectId": "unknown",[78C[m
[2m    "status": "unhealthy",[22m[K[79C
[31m+   "timestamp": 2025-07-28T22:43:28.396Z,[63C[m
[2m  }[22m[K[102C
[105C
[36m [2m❯[22m src/features/database.test.ts:[2m213:22[m[K[66C
[105C    [90m211|       [35mconst [mresult [33m= [35mawait [mdatabaseService[33m.[34mhealthCheck[m()[33m;[m
    [90m212|[K[97C[m
    [90m213|       [34mexpect[m(result)[33m.[34mtoEqual[m({[K[66C
       [90m|[22X[31m[22C^[K[74C[m
    [90m214|[9X[m[9Cstatus[33m: [32m'unhealthy'[33m,[K[68C[m
    [90m215|[9X[m[9Cconnected[33m: [35mfalse[K[72C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mhealthCheck[2m > [22mshould handle database initializat
[12;105Htion errors[95C
[31m[1mAssertionError[22m: expected { status: 'unhealthy', …(2) } to deeply equal { status: 'unhealthy', …(1) }     [m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[2m  {[22m[K[102C
[32m-   "connected": false,[82C[m
[31m+   "projectId": "unknown",[78C[m
[2m    "status": "unhealthy",[22m[K[79C
[31m+   "timestamp": 2025-07-28T22:43:28.417Z,[63C[m
[2m  }[22m[K[102C
[105C
[36m [2m❯[22m src/features/database.test.ts:[2m227:22[m[K[66C
    [90m225|       [35mconst [mresult [33m= [35mawait [mdatabaseService[33m.[34mhealthCheck[m()[33m;[K[39C[m
    [90m226|[K[97C[m
    [90m227|       [34mexpect[m(result)[33m.[34mtoEqual[m({[K[66C
       [90m|[22X[31m[22C^[K[74C[m
    [90m228|[9X[m[9Cstatus[33m: [32m'unhealthy'[33m,[K[68C[m
    [90m229|[9X[m[9Cconnected[33m: [35mfalse[K[72C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/48]⎯[m
[105C
[105C[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mdisconnect[2m > [22mshould disconnect all Firebase apps
[105C[31m[1mTypeError[22m: default.disconnect is not a function[m
[105C[36m [2m❯[22m src/features/database.test.ts:[2m242:29[m
[105C    [90m240|       [m(admin [35mas [many)[33m.[mapps [33m= [m[mockApp1[33m, [mmockApp2][33m;[m
    [90m241|[K[97C[m
    [90m242|       [35mawait [mdatabaseService[33m.[34mdisconnect[m()[33m;[K[55C[m
       [90m|[29X[31m[29C^[K[67C[m
    [90m243|[K[97C[m
    [90m244|       [34mexpect[m(mockApp1[33m.[35mdelete[m)[33m.[34mtoHaveBeenCalled[m()[33m;[K[47C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mdisconnect[2m > [22mshould handle apps array with null 
[12;105H values[99C
[105C[31m[1mTypeError[22m: default.disconnect is not a function[m
[36m [2m❯[22m src/features/database.test.ts:[2m254:29[m[K[66C
    [90m252|       [m(admin [35mas [many)[33m.[mapps [33m= [m[mockApp[33m, [35mnull[m][33m;[K[52C[m
    [90m253|[K[97C[m
    [90m254|       [35mawait [mdatabaseService[33m.[34mdisconnect[m()[33m;[K[55C[m
       [90m|[29X[31m[29C^[K[67C[m
    [90m255|[K[97C[m
    [90m256|       [34mexpect[m(mockApp[33m.[35mdelete[m)[33m.[34mtoHaveBeenCalled[m()[33m;[K[48C[m
[105C
[105C[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mdisconnect[2m > [22mshould handle empty apps array     
[31m[1mTypeError[22m: default.disconnect is not a function[K[58C[m
[36m [2m❯[22m src/features/database.test.ts:[2m263:36[m[K[66C
    [90m261|       [m(admin [35mas [many)[33m.[mapps [33m= [m[][33m;[K[65C[m
    [90m262|[K[97C[m
    [90m263|       [35mawait [34mexpect[m(databaseService[33m.[34mdisconnect[m())[33m.[mresolves[33m.[34mtoBeUndefined[m()[33m;[K[22C[m
       [90m|[36X[31m[36C^[K[60C[m
    [90m264|     [m})[33m;[K[89C[m
    [90m265|[K[97C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22mdisconnect[2m > [22mshould handle app deletion errors g
[12;105Hgracefully[96C
[31m[1mTypeError[22m: default.disconnect is not a function[K[58C[m
[36m [2m❯[22m src/features/database.test.ts:[2m274:36[m[K[66C
[105C    [90m272|       [m
    [90m273|       // Should not throw error even if app deletion fails[K[38C[m
    [90m274|       [35mawait [34mexpect[m(databaseService[33m.[34mdisconnect[m())[33m.[mresolves[33m.[34mtoBeUndefined[m()[33m;[K[22C[m
       [90m|[36X[31m[36C^[K[60C[m
    [90m275|     [m})[33m;[K[89C[m
    [90m276|   [m})[33m;[K[91C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/48]⎯[m
[105C
[41m[1m FAIL [m src/features/database.test.ts[2m > [22mDatabaseService[2m > [22msingleton behavior[2m > [22mshould maintain singleton p
[12;105Hpattern across multiple requires[74C
[31m[1mError[22m: Database initialization failed[K[68C[m
[36m [2m❯[22m DatabaseService.<anonymous> src/features/database.test.ts:[2m222:15[m[K[38C
[105C    [90m220|       // Mock getDb to throw an error[m
    [90m221|       [mvi[33m.[34mspyOn[m(databaseService[33m, [32m'getDb'[m)[33m.[34mmockImplementation[m(() [33m=> [m{[K[29C
    [90m222|[9X[35m[9Cthrow new [33mError[m([32m'Database initialization failed'[m)[33m;[K[38C[m
       [90m|[15X[31m[15C^[K[81C[m
    [90m223|       [m})[33m;[K[87C[m
    [90m224|[K[97C[m
[90m [2m❯[22m src/features/database.test.ts:[2m300:23[m[K[66C
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[20/48]⎯[m
[105C
[105C[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould successfully extract text fro
[12;105Hom image[98C
[105C[31m[1mAssertionError[22m: expected false to be true // Object.is equality[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[36m [2m❯[22m src/features/ocrService.test.ts:[2m70:30[m[K[65C
[105C     [90m68|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mprocessImage[m(mockRequest)[33m;[m
     [90m69|[K[97C[m
     [90m70|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
     [90m71|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(mockExtractedText)[33m;[K[37C[m
     [90m72|       [34mexpect[m(result[33m.[merror)[33m.[34mtoBeUndefined[m()[33m;[K[53C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[21/48]⎯[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould handle empty text detection r
[12;105Hresults[99C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err…' to be 'OCR failed after 3 attempts. Las[m
[31m[12;105Hst err…' // Object.is equality[76C[m
[105C
Expected: [32m"OCR failed after 3 attempts. Last error: [7mNo text detected in the imag[27me"[K[23C[m
Received: [31m"OCR failed after 3 attempts. Last error: [7m(intermediate value) is not iterabl[27me"[K[16C[m
[105C
[36m [2m❯[22m src/features/ocrService.test.ts:[2m87:28[m[K[65C
[105C     [90m85| [m
     [90m86|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
     [90m87|       [mexpect(result.error).toBe('OCR failed after 3 attempts. Last error: No text detected in t…
       [90m|[28X[31m[28C^[K[68C[m
     [90m88|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBeUndefined[m()[33m;[K[45C[m
     [90m89|     [m})[33m;[K[89C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[22/48]⎯[m
[105C
[105C[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould handle empty extracted text
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err…' to be 'OCR failed after 3 attempts. Las[m
[31m[12;105Hst err…' // Object.is equality[76C[m
[105C
Expected: [32m"OCR failed after 3 attempts. Last error: [7mEmpty text extracted from imag[27me"[K[21C[m
Received: [31m"OCR failed after 3 attempts. Last error: [7m(intermediate value) is not iterabl[27me"[K[16C[m
[105C
[105C[36m [2m❯[22m src/features/ocrService.test.ts:[2m101:28[m
     [90m99|[K[97C[m
    [90m100|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m101|       [mexpect(result.error).toBe('OCR failed after 3 attempts. Last error: Empty text extracted …
       [90m|[28X[31m[28C^[K[68C[m
    [90m102|     [m})[33m;[K[89C[m
    [90m103|[K[97C[m
[105C
[105C[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[23/48]⎯[m
[105C
[105C[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould retry on transient failures
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[K[42C[m
[105C
[32m- Expected[95C[m
[31m+ Received[95C[m
[105C
[32m- true[99C[m
[31m+ false[98C[m
[105C
[105C[36m [2m❯[22m src/features/ocrService.test.ts:[2m118:30[m
    [90m116|       [35mconst [mresult [33m= [35mawait [mocrService[33m.[34mprocessImage[m(mockRequest)[33m;[K[32C[m
    [90m117|[K[97C[m
    [90m118|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mtrue[m)[33m;[K[56C[m
       [90m|[30X[31m[30C^[K[66C[m
    [90m119|       [34mexpect[m(result[33m.[mextractedText)[33m.[34mtoBe[m(mockExtractedText)[33m;[K[37C[m
    [90m120|       [34mexpect[m(mockTextDetection)[33m.[34mtoHaveBeenCalledTimes[m([34m2[m)[33m;[K[39C[m
[105C
[105C[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[24/48]⎯[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould fail after max retries       
[105C[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err…' to be 'OCR failed after 3 attempts. Las[m
[31m[12;105Hst err…' // Object.is equality[76C[m
]0;node (vitest 2)[105C
Expected: [32m"OCR failed after 3 attempts. Last error: [7mPersistent API error[27m"[K[32C[m
Received: [31m"OCR failed after 3 attempts. Last error: [7m(intermediate value) is not iterable[27m"[K[16C[m
[105C
[36m [2m❯[22m src/features/ocrService.test.ts:[2m130:28[m[K[64C
[105C    [90m128| [m
    [90m129|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m130|       [mexpect(result.error).toBe('OCR failed after 3 attempts. Last error: Persistent API error'…
       [90m|[28X[31m[28C^[K[68C[m
    [90m131|       [34mexpect[m(mockTextDetection)[33m.[34mtoHaveBeenCalledTimes[m([34m3[m)[33m;[K[39C[m
    [90m132|     [m})[33m;[K[89C[m
[105C
[105C[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[25/48]⎯[m
[105C
[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mprocessImage[2m > [22mshould handle Vision API errors grac
[12;105Hcefully[99C
[31m[1mAssertionError[22m: expected 'OCR failed after 3 attempts. Last err…' to contain 'QUOTA_EXCEEDED'[K[12C[m
[105C
Expected: [32m"QUOTA_EXCEEDED"[K[79C[m
Received: [31m"OCR failed after 3 attempts. Last error: (intermediate value) is not iterable"[K[16C[m
[105C
[36m [2m❯[22m src/features/ocrService.test.ts:[2m140:28[m[K[64C
    [90m138|[K[97C[m
    [90m139|       [34mexpect[m(result[33m.[msuccess)[33m.[34mtoBe[m([35mfalse[m)[33m;[K[55C[m
    [90m140|       [34mexpect[m(result[33m.[merror)[33m.[34mtoContain[m([32m'QUOTA_EXCEEDED'[m)[33m;[K[41C[m
       [90m|[28X[31m[28C^[K[68C[m
    [90m141|     [m})[33m;[K[89C[m
    [90m142|   [m})[33m;[K[91C[m
[105C
[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[26/48]⎯[m
[105C
[105C[41m[1m FAIL [m src/features/ocrService.test.ts[2m > [22mOCRService[2m > [22mhealthCheck[2m > [22mshould return true when service is he
[12;105Healthy[100C
# Story 1.1: Project Scaffolding & Setup

## Status
Done

## Scope

## Story
**As a** Developer,
**I want** a new Monorepo project initialized with the basic folder structure,
**so that** we have a clean foundation.

## Acceptance Criteria
1. Git repo created
2. Monorepo structure setup
3. Placeholder serverless backend and web frontend created
4. Test frameworks installed

## Tasks / Subtasks
- [x] Task 1: Initialize Turborepo monorepo structure (AC: 1, 2)
  - [x] Initialize git repository if not already done
  - [x] Install Turborepo globally or add as dev dependency
  - [x] Create turbo.json configuration file
  - [x] Set up root package.json with workspace configuration
  - [x] Create root tsconfig.json
- [x] Task 2: Create backend application structure (AC: 3)
  - [x] Create apps/api directory with proper folder structure
  - [x] Set up apps/api/package.json with Express.js and TypeScript dependencies
  - [x] Create apps/api/src/index.ts as main entry point
  - [x] Create apps/api/src/features/ and middleware/ directories
  - [x] Configure TypeScript compilation for backend
- [x] Task 3: Create frontend application structure (AC: 3)
  - [x] Create apps/web directory with Vite + React structure
  - [x] Set up apps/web/package.json with React, TypeScript, Vite dependencies
  - [x] Create apps/web/src/main.tsx as application entry point
  - [x] Create apps/web/src/components/ and features/ directories
  - [x] Configure Vite build configuration
  - [x] Set up Tailwind CSS configuration
- [x] Task 4: Set up shared packages (AC: 2)
  - [x] Create packages/shared-types directory and package.json
  - [x] Create packages/shared-types/index.ts for shared TypeScript interfaces
  - [x] Create packages/eslint-config directory
  - [x] Create packages/tsconfig directory with base configurations
- [x] Task 5: Configure testing frameworks (AC: 4)
  - [x] Install Vitest for both frontend and backend testing
  - [x] Install Playwright for E2E testing
  - [x] Create test configuration files for Vitest
  - [x] Create basic test setup files
- [x] Task 6: Set up infrastructure directory (AC: 2)
  - [x] Create infra/terraform directory
  - [x] Add placeholder Terraform configuration files
- [x] Task 7: Configure development environment
  - [x] Set up development scripts in root package.json
  - [x] Configure Turborepo development and build pipelines
  - [x] Test monorepo build and development processes

## Dev Notes

### Previous Story Insights
This is the first story in the project, so no previous insights to reference.

### Project Structure Requirements
[Source: architecture/project-structure.md]
The definitive folder structure must follow this exact layout:
```
pharmc-monorepo/
├── apps/
│   ├── api/                # The Express.js backend for GCP Cloud Functions
│   │   ├── src/
│   │   │   ├── features/
│   │   │   ├── middleware/
│   │   │   └── index.ts
│   │   └── package.json
│   └── web/                # The React (Vite) frontend application
│       ├── src/
│       │   ├── components/
│       │   ├── features/
│       │   └── main.tsx
│       └── package.json
│
├── packages/
│   ├── shared-types/       # Shared TypeScript interfaces (User, Order)
│   │   └── index.ts
│   ├── eslint-config/
│   └── tsconfig/
│
├── infra/
│   └── terraform/          # Our Terraform (IaC) files for Google Cloud
│
├── package.json
├── turbo.json
└── tsconfig.json
```

### Technology Stack Requirements
[Source: architecture/tech-stack.md]
Required technologies and versions that must be installed:
- **Frontend Framework**: React (~18.3) with Vite for build tooling
- **Frontend Language**: TypeScript (~5.4)
- **UI Styling**: Tailwind CSS (~3.4)
- **State Management**: Zustand (~4.5) for global UI state
- **Server State**: TanStack Query (~5.35) for data fetching
- **Backend Language**: TypeScript (~5.4) with Node.js (~20.x)
- **Backend Framework**: Express.js (~4.19) for Google Cloud Functions
- **Testing**: Vitest (~1.6) for unit/integration tests
- **E2E Testing**: Playwright (~1.44) for end-to-end testing
- **Monorepo Tool**: Turborepo (~2.0)

### Architecture Context
[Source: architecture/overview.md]
The system will be serverless and hosted entirely on Google Cloud Platform using:
- Google Cloud Functions for backend
- Firebase Hosting for frontend deployment
- Firestore for database
- Firebase Authentication for user management
- Google Cloud Storage for file storage
- Google Cloud Vision API for OCR processing

### Deployment Configuration
[Source: architecture/deployment.md]
Environment setup requirements:
- Development: Frontend on localhost:5173, Backend on localhost:3001
- The Express.js API will be deployed as a single Google Cloud Function
- Firebase Hosting will serve the React web app with global CDN
- GitHub Actions will be used for CI/CD automation

### Testing Requirements
[Source: architecture/deployment.md]
Testing strategy requirements:
- Unit and Integration tests using Vitest for all code
- Playwright for critical E2E flows
- All tests must be configured and ready to run after scaffolding

### Coding Standards
[Source: architecture/deployment.md]
Critical standards to implement:
- Use shared TypeScript types from packages/shared-types directory for consistency
- All API endpoints will require token validation middleware
- Follow TypeScript strict mode configuration

## Testing
### Testing Standards
[Source: architecture/deployment.md and tech-stack.md]
- **Test Framework**: Vitest (~1.6) for unit and integration tests
- **E2E Framework**: Playwright (~1.44) for end-to-end testing
- **Test Location**: Tests should be co-located with source files or in dedicated __tests__ directories
- **Coverage**: All business logic must have unit test coverage
- **Integration**: API endpoints must have integration tests
- **E2E**: Critical user flows must have Playwright E2E tests
- **Test Scripts**: Configure npm scripts for running tests in development and CI environments

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| [Current Date] | 1.0 | Initial story creation | Scrum Master Bob |

## Dev Agent Record
*This section was populated by the development agent during implementation.*

### Agent Model Used
Claude Sonnet 4 - Full Stack Developer Agent (James)

### Debug Log References
- Fixed TypeScript project reference issues for shared-types package
- Resolved ESLint configuration missing files for both frontend and backend
- Addressed packageManager field requirement for Turborepo
- Updated dependency versions to latest compatible versions

### Completion Notes List
- Successfully created complete monorepo structure with Turborepo
- Implemented Express.js API backend with proper TypeScript configuration
- Built React + Vite frontend with Tailwind CSS and modern tooling
- Set up shared packages for types, ESLint config, and TypeScript configs
- Configured Vitest for unit testing and Playwright for E2E testing
- Added infrastructure directory with Terraform placeholders for GCP
- Verified build process and test frameworks work correctly
- All acceptance criteria have been met

### File List
**New Files Created:**
- `package.json` (root workspace configuration)
- `turbo.json` (Turborepo configuration)
- `tsconfig.json` (root TypeScript configuration)
- `playwright.config.ts` (E2E testing configuration)
- `e2e/example.spec.ts` (sample E2E test)

**Backend (apps/api/):**
- `package.json`, `tsconfig.json`, `vitest.config.ts`, `.eslintrc.js`
- `src/index.ts` (main Express server)
- `src/index.test.ts` (API tests)
- `src/features/` and `src/middleware/` directories

**Frontend (apps/web/):**
- `package.json`, `tsconfig.json`, `vite.config.ts`, `vitest.config.ts`, `.eslintrc.cjs`
- `tailwind.config.js`, `postcss.config.js`, `index.html`
- `src/main.tsx`, `src/App.tsx`, `src/App.test.tsx`, `src/index.css`, `src/test-setup.ts`
- `src/components/` and `src/features/` directories

**Shared Packages:**
- `packages/shared-types/` (TypeScript interfaces)
- `packages/eslint-config/` (shared ESLint configuration)  
- `packages/tsconfig/` (shared TypeScript configurations)

**Infrastructure:**
- `infra/terraform/main.tf`, `variables.tf`, `outputs.tf` (GCP infrastructure)

## QA Results

### Review Date: December 15, 2024
### Reviewed By: Quinn (Senior Developer QA)

### Code Quality Assessment
The implementation demonstrates solid foundational work with proper monorepo structure, clean separation of concerns, and appropriate technology choices. The codebase follows modern TypeScript and React patterns with good test coverage. All acceptance criteria have been successfully implemented with proper configuration files and build processes.

### Refactoring Performed
- **File**: `packages/shared-types/src/index.ts`
  - **Change**: Removed circular export and added `ApiError` interface
  - **Why**: Circular export was problematic and error handling types were missing
  - **How**: Provides proper error handling structure and eliminates build issues

- **File**: `apps/web/src/App.tsx`
  - **Change**: Fixed Tailwind CSS color class from `to-light-blue-500` to `to-blue-500`
  - **Why**: `light-blue-500` is deprecated in Tailwind v3.4
  - **How**: Ensures proper styling and removes deprecated class usage

- **File**: `apps/api/src/index.ts`
  - **Change**: Added environment variable support to health endpoint
  - **Why**: Health checks should provide environment context for debugging
  - **How**: Improves observability and deployment verification

- **File**: `apps/api/src/index.ts`
  - **Change**: Cleaned up unused parameter in error handler
  - **Why**: Resolved linter warnings for unused `next` parameter
  - **How**: Maintains Express middleware signature while eliminating linter errors

- **File**: `apps/api/src/index.test.ts`
  - **Change**: Updated test assertions to match new health endpoint response
  - **Why**: Tests must match actual implementation behavior
  - **How**: Ensures test reliability and proper verification of health endpoint

### Compliance Check
- Coding Standards: ✓ TypeScript strict mode, proper ESLint configuration
- Project Structure: ✓ Follows exact monorepo structure specified in requirements
- Testing Strategy: ✓ Vitest and Playwright properly configured with meaningful tests
- All ACs Met: ✓ Git repo, monorepo structure, backend/frontend apps, test frameworks all implemented

### Security Review
✓ Express security middleware (Helmet, CORS) properly configured
✓ Input validation middleware setup with express.json() and urlencoded()
✓ Error handling middleware prevents information leakage

### Performance Considerations
✓ Vite build optimization configured for production
✓ React StrictMode enabled for development debugging
✓ TanStack Query setup for efficient data fetching
✓ Turborepo caching configured for build performance

### Architecture Validation
✓ Serverless-ready Express.js structure for Google Cloud Functions
✓ Shared types package for consistent data contracts
✓ Proper separation between apps and packages
✓ Infrastructure directory prepared for Terraform deployment

### Final Status
✓ **Approved - Ready for Done**

**Summary**: Excellent foundational implementation that meets all requirements. The refactoring improvements enhance maintainability, fix deprecated dependencies, and improve observability. The project is well-structured for the planned Google Cloud Platform deployment and ready for feature development. 